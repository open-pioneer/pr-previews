var Ct=Object.defineProperty;var rt=t=>{throw TypeError(t)};var It=(t,e,i)=>e in t?Ct(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var J=(t,e,i)=>It(t,typeof e!="symbol"?e+"":e,i),Q=(t,e,i)=>e.has(t)||rt("Cannot "+i);var n=(t,e,i)=>(Q(t,e,"read from private field"),i?i.call(t):e.get(t)),u=(t,e,i)=>e.has(t)?rt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),s=(t,e,i,r)=>(Q(t,e,"write to private field"),r?r.call(t,i):e.set(t,i),i),f=(t,e,i)=>(Q(t,e,"access private method"),i);import{r as v,j as p,z as qt,aC as Ft,aa as jt,aD as Rt,c as Nt}from"./BMJNq4QBB6Gl.js";import{u as Dt,a as Ot}from"./RDYnvDkk14QY.js";import{B as Tt}from"./C1GzxK2M0NsL.js";const pe=v.forwardRef(function(e,i){const{direction:r,align:a,justify:c,wrap:$,basis:wt,grow:xt,shrink:kt,inline:Et,...At}=e;return p.jsx(qt.div,{ref:i,...At,css:{display:Et?"inline-flex":"flex",flexDirection:r,alignItems:a,justifyContent:c,flexWrap:$,flexBasis:wt,flexGrow:xt,flexShrink:kt,...e.css}})});var Lt=Symbol.for("preact-signals");function Z(){if(E>1)E--;else{for(var t,e=!1;R!==void 0;){var i=R;for(R=void 0,K++;i!==void 0;){var r=i.o;if(i.o=void 0,i.f&=-3,!(8&i.f)&&at(i))try{i.c()}catch(a){e||(t=a,e=!0)}i=r}}if(K=0,E--,e)throw t}}var o=void 0;function tt(t){var e=o;o=void 0;try{return t()}finally{o=e}}var R=void 0,E=0,K=0,B=0;function ut(t){if(o!==void 0){var e=t.n;if(e===void 0||e.t!==o)return e={i:0,S:t,p:o.s,n:void 0,t:o,e:void 0,x:void 0,r:e},o.s!==void 0&&(o.s.n=e),o.s=e,t.n=e,32&o.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=o.s,e.n=void 0,o.s.n=e,o.s=e),e}}function h(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}h.prototype.brand=Lt;h.prototype.h=function(){return!0};h.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)};h.prototype.U=function(t){if(this.t!==void 0){var e=t.e,i=t.x;e!==void 0&&(e.x=i,t.e=void 0),i!==void 0&&(i.e=e,t.x=void 0),t===this.t&&(this.t=i)}};h.prototype.subscribe=function(t){var e=this;return it(function(){var i=e.value,r=o;o=void 0;try{t(i)}finally{o=r}})};h.prototype.valueOf=function(){return this.value};h.prototype.toString=function(){return this.value+""};h.prototype.toJSON=function(){return this.value};h.prototype.peek=function(){var t=o;o=void 0;try{return this.value}finally{o=t}};Object.defineProperty(h.prototype,"value",{get:function(){var t=ut(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(K>100)throw new Error("Cycle detected");this.v=t,this.i++,B++,E++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Z()}}}});function Ut(t){return new h(t)}function at(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function ht(t){for(var e=t.s;e!==void 0;e=e.n){var i=e.S.n;if(i!==void 0&&(e.r=i),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function ct(t){for(var e=t.s,i=void 0;e!==void 0;){var r=e.p;e.i===-1?(e.S.U(e),r!==void 0&&(r.n=e.n),e.n!==void 0&&(e.n.p=r)):i=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=r}t.s=i}function j(t){h.call(this,void 0),this.x=t,this.s=void 0,this.g=B-1,this.f=4}(j.prototype=new h).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===B))return!0;if(this.g=B,this.f|=1,this.i>0&&!at(this))return this.f&=-2,!0;var t=o;try{ht(this),o=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(i){this.v=i,this.f|=16,this.i++}return o=t,ct(this),this.f&=-2,!0};j.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}h.prototype.S.call(this,t)};j.prototype.U=function(t){if(this.t!==void 0&&(h.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};j.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};Object.defineProperty(j.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=ut(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function ft(t){return new j(t)}function lt(t){var e=t.u;if(t.u=void 0,typeof e=="function"){E++;var i=o;o=void 0;try{e()}catch(r){throw t.f&=-2,t.f|=8,et(t),r}finally{o=i,Z()}}}function et(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,lt(t)}function Mt(t){if(o!==this)throw new Error("Out-of-order effect");ct(this),o=t,this.f&=-2,8&this.f&&et(this),Z()}function P(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}P.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}};P.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,lt(this),ht(this),E++;var t=o;return o=this,Mt.bind(this,t)};P.prototype.N=function(){2&this.f||(this.f|=2,this.o=R,R=this)};P.prototype.d=function(){this.f|=8,1&this.f||et(this)};function it(t){var e=new P(t);try{e.c()}catch(i){throw e.d(),i}return e.d.bind(e)}function Pt(t){let e;return{destroy:it(function(){this[Wt]=t.bind(void 0),e=this[_t].bind(this)}),start:e}}var Wt="N",_t="S";function ye(t,e){return new Gt(t,e?.equal)}function Bt(t,e){return new Ht(t,e?.equal)}function dt(t){return tt(t)}var k=Symbol("signal"),N=Symbol("equals"),vt=class{[k];constructor(t){this[k]=t}get value(){return this[k].value}set value(t){throw new Error("Cannot update a readonly reactive object.")}trigger(){throw new Error("Cannot trigger this reactive object.")}peek(){return this[k].peek()}toJSON(){return this.value}toString(){return`Reactive[value=${Jt(this[k].value)}]`}},Ht=class extends vt{[N];constructor(t,e){const i=ft(e?$t(t,e):t);super(i),this[N]=e}},Gt=class extends vt{[N];constructor(t,e){super(Ut(t)),this[N]=e}get value(){return super.value}set value(t){tt(()=>this[N]?.(this.value,t))||(this[k].value=t)}};function $t(t,e){let i=!0,r;return function(){const c=t();return tt(()=>((i||!e(r,c))&&(r=c,i=!1),r))}}function Jt(t){return typeof t=="string"?JSON.stringify(t):String(t)}function pt(t,e){return t===e?!0:t.length===e.length&&t.every((i,r)=>i===e[r])}function yt(t,e,i,r){const a=ft(e),c=r?.immediate??!1,$=r?.equal??zt;return new Qt(t,i,a,$,c)}var D,O,T,w,L,A,C,y,b,gt,W,st,Qt=(st=class{constructor(t,e,i,r,a){u(this,b);u(this,D);u(this,O);u(this,T);u(this,w,!0);u(this,L);u(this,A);u(this,C,!1);u(this,y);J(this,"destroy",()=>{s(this,C,!0),n(this,y)?.destroy(),s(this,y,void 0),f(this,b,W).call(this)});s(this,D,e),s(this,O,a),s(this,T,r),s(this,y,t(()=>{const c=i.value;dt(()=>{f(this,b,gt).call(this,c)})})),n(this,C)&&(n(this,y).destroy(),s(this,y,void 0))}},D=new WeakMap,O=new WeakMap,T=new WeakMap,w=new WeakMap,L=new WeakMap,A=new WeakMap,C=new WeakMap,y=new WeakMap,b=new WeakSet,gt=function(t){const e=n(this,L),i=n(this,w)&&n(this,O)||!n(this,w)&&!n(this,T).call(this,e,t);if((i||n(this,w))&&(s(this,L,t),s(this,w,!1)),i){f(this,b,W).call(this);const r=n(this,D).call(this,t,e,this);typeof r=="function"&&s(this,A,r)}n(this,C)&&f(this,b,W).call(this)},W=function(){const t=n(this,A);s(this,A,void 0);try{t?.()}catch(e){throw this.destroy(),e}},st);function zt(t,e){return t===e}function Kt(t){let e=!1,i;const r={destroy(){e||(e=!0,i?.())}};return i=it(()=>t(r)),e&&i(),r}function Yt(t,e,i){return yt(Kt,t,e,{equal:pt,...i})}var Y;typeof globalThis.reportError=="function"?Y=globalThis.reportError:Y=t=>console.error(t);function mt(t){Y(new Error("Error in effect or watch callback",{cause:t}))}var Vt=class{queue=[];channel=new MessageChannel;constructor(){this.channel.port2.start()}enqueue(t){const e={fn:t,destroyed:!1};return this.queue.push(e),this.queue.length===1&&this.scheduleIteration(),{destroy(){e.destroyed||(e.destroyed=!0)}}}messageHandler=()=>this.runIteration();scheduleIteration(){const t=this.channel;t.port2.addEventListener("message",this.messageHandler),t.port1.postMessage("")}runIteration(){this.channel.port2.removeEventListener("message",this.messageHandler);const t=this.queue;this.queue=[];for(const e of t)if(!e.destroyed)try{e.fn()}catch(i){mt(i)}}};function Xt(t){const e=new Zt(t);return{destroy:e.destroy.bind(e)}}var U,I,x,g,m,M,q,l,V,X,_,H,ot,Zt=(ot=class{constructor(t){u(this,l);u(this,U);u(this,I);u(this,x);u(this,g);u(this,m,!1);u(this,M,!0);u(this,q,!1);J(this,"destroy",()=>{if(!n(this,m)){s(this,m,!0);try{f(this,l,_).call(this)}finally{n(this,x)?.destroy(),s(this,x,void 0),n(this,g)?.destroy(),s(this,g,void 0)}}});u(this,H,()=>{if(!n(this,m)){if(n(this,q))throw new Error("Cycle detected");n(this,g)||s(this,g,ie(()=>{try{f(this,l,V).call(this)}finally{s(this,g,void 0)}}))}});s(this,U,t),s(this,x,Pt(n(this,H))),f(this,l,V).call(this),s(this,M,!1)}},U=new WeakMap,I=new WeakMap,x=new WeakMap,g=new WeakMap,m=new WeakMap,M=new WeakMap,q=new WeakMap,l=new WeakSet,V=function(){const t=n(this,x);if(!t)return;s(this,q,!0);const e=t.start();try{if(n(this,M))try{f(this,l,X).call(this)}catch(i){throw this.destroy(),i}else try{f(this,l,X).call(this)}catch(i){mt(i)}}finally{e(),s(this,q,!1)}n(this,m)&&f(this,l,_).call(this)},X=function(){if(!n(this,m)){f(this,l,_).call(this);const t=n(this,U).call(this,this);typeof t=="function"&&s(this,I,t)}},_=function(){const t=n(this,I);s(this,I,void 0);try{t&&dt(t)}catch(e){throw this.destroy(),e}},H=new WeakMap,ot);function te(t,e,i){return yt(Xt,t,e,{equal:pt,...i})}var ee=new Vt;function ie(t){return ee.enqueue(t)}const z=Nt("authentication:AuthService");var S,d,F,G,St;class ge{constructor(e){u(this,G);u(this,S);u(this,d);u(this,F);s(this,S,e.references.plugin),s(this,F,Yt(()=>[n(this,S).getAuthState()],([i])=>{f(this,G,St).call(this,i)},{immediate:!1})),z.debug(`Constructed with initial auth state '${this.getAuthState().kind}'`,this.getAuthState())}destroy(){n(this,d)?.reject(Ft()),s(this,d,void 0),s(this,F,jt(n(this,F)))}getAuthState(){return n(this,S).getAuthState()}getSessionInfo(){return this.getAuthState().kind!=="pending"?Promise.resolve(nt(this.getAuthState())):(n(this,d)||s(this,d,Rt()),n(this,d).promise)}getLoginBehavior(){return n(this,S).getLoginBehavior()}logout(){z.debug("Triggering logout"),n(this,S).logout()}}S=new WeakMap,d=new WeakMap,F=new WeakMap,G=new WeakSet,St=function(e){e.kind!=="pending"&&n(this,d)&&(n(this,d).resolve(nt(e)),s(this,d,void 0)),z.debug(`Auth state changed to '${e.kind}'`,e)};function nt(t){return t.kind==="authenticated"?t.sessionInfo:void 0}const bt="@open-pioneer/authentication",re=Dt.bind(void 0,bt),ne=Ot.bind(void 0,bt);function se(t,e){const i=v.useRef(t);i.current=t;const r=ae(e);return v.useMemo(()=>Bt(()=>i.current()),[r])}function oe(t){const e=v.useCallback(()=>t.peek(),[t]),i=v.useCallback(a=>{const c=te(()=>[t.value],a);return()=>c.destroy()},[t]),r=v.useSyncExternalStore(i,e);return v.useDebugValue(r),r}function ue(t,e){const i=se(t,e),r=oe(i);return v.useDebugValue(r),r}function ae(t){const e=v.useRef();return(e.current==null||!he(e.current,t))&&(e.current=t??[]),e.current}function he(t,e){return t===e?!0:t.length===(e?.length??0)&&t.every((i,r)=>i===e[r])}function ce(t){return ue(()=>t.getAuthState(),[t])}const me=t=>{const e=re("authentication.AuthService"),i=ce(e),r=ne(),a=v.useMemo(()=>{if(i.kind==="not-authenticated")return e.getLoginBehavior()},[e,i.kind]);switch(v.useEffect(()=>{i.kind==="not-authenticated"&&a?.kind==="effect"&&a.login()},[a,i.kind]),i.kind){case"pending":return null;case"not-authenticated":{if(!a||a.kind!=="fallback")return null;const c=a.Fallback;return t.renderFallback?p.jsx(p.Fragment,{children:t.renderFallback(c)}):p.jsx(c,{...t.fallbackProps})}case"error":return t.renderErrorFallback?t.renderErrorFallback(i.error):t.errorFallback?p.jsx(t.errorFallback,{error:i.error}):p.jsx(Tt,{className:"authentication-error",children:r.formatMessage({id:"auth-error"})});case"authenticated":return p.jsx(p.Fragment,{children:t.children})}};export{ge as A,me as F,pe as a,ye as r,ce as u};
