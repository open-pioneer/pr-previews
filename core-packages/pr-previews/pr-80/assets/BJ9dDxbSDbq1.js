var fe=l=>{throw TypeError(l)};var re=(l,e,d)=>e.has(l)||fe("Cannot "+d);var g=(l,e,d)=>(re(l,e,"read from private field"),d?d.call(l):e.get(l)),_=(l,e,d)=>e.has(l)?fe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,d),A=(l,e,d,k)=>(re(l,e,"write to private field"),k?k.call(l,d):e.set(l,d),d),K=(l,e,d)=>(re(l,e,"access private method"),d);import{_ as Pe,c as je,af as Me,a as Oe,j as h,H as pe,V as he,b as Ke}from"./Bs9hMHdnnuo8.js";import{r as Ne,A as He,u as Fe,F as De}from"./7KZ26sgGcabp.js";import{H as qe}from"./D9P_Rg5nQjuh.js";import{N as ze,a as Ve}from"./CKbTRv8umRSV.js";import{_ as me}from"./CmsKOCeNyeyo.js";import{u as Je}from"./Bw3hPMsT3dEm.js";import{B as we}from"./D81pzpZNadYY.js";import{C as Ye}from"./BQxKBnW6zu4Z.js";import{F as Be}from"./BcvUivSxwpXW.js";import{T as N}from"./Dm8pB8eElP_h.js";import{B as ke}from"./ponVpkCf_hvV.js";import{L as Ge,a as ne}from"./BcvWScpUy6oc.js";import"./CPd4HcPX6nKY.js";import"./TQEv3cHoPjvN.js";import"./CVxv47bR6ZLg.js";import"./eJLSQeh_i3ZN.js";import"./D85m25U970zE.js";import"./Ncldg1sX4HDD.js";const{withContext:We}=Pe({key:"code"}),H=We("code");class Xe{authService;constructor(e){this.authService=e.references.authService}beforeRequest({target:e,options:d}){const k=this.authService.getAuthState(),I=((k.kind=="authenticated"?k.sessionInfo:void 0)?.attributes?.keycloak).token;e.protocol==="https:"&&e.hostname==="ogc-api.nrw.de"&&I&&d.headers.set("Authorization",I)}}function ye(l){if(!(this instanceof ye))throw new Error("The 'Keycloak' constructor must be invoked with 'new'.");if(typeof l!="string"&&!ie(l))throw new Error("The 'Keycloak' constructor must be provided with a configuration object, or a URL to a JSON configuration file.");if(ie(l)){const t="oidcProvider"in l?["clientId"]:["url","realm","clientId"];for(const r of t)if(!l[r])throw new Error(`The configuration object is missing the required '${r}' property.`)}var e=this,d,k=[],y,m={enable:!0,callbackList:[],interval:5};e.didInitialize=!1;var I=!0,L=de(console.info),W=de(console.warn);globalThis.isSecureContext||W(`[KEYCLOAK] Keycloak JS must be used in a 'secure context' to function properly as it relies on browser APIs that are otherwise not available.
Continuing to run your application insecurely will lead to unexpected behavior and breakage.

For more information see: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`),e.init=function(t={}){if(e.didInitialize)throw new Error("A 'Keycloak' instance can only be initialized once.");e.didInitialize=!0,e.authenticated=!1,y=Re();var r=["default","cordova","cordova-native"];if(r.indexOf(t.adapter)>-1?d=Q(t.adapter):typeof t.adapter=="object"?d=t.adapter:window.Cordova||window.cordova?d=Q("cordova"):d=Q(),typeof t.useNonce<"u"&&(I=t.useNonce),typeof t.checkLoginIframe<"u"&&(m.enable=t.checkLoginIframe),t.checkLoginIframeInterval&&(m.interval=t.checkLoginIframeInterval),t.onLoad==="login-required"&&(e.loginRequired=!0),t.responseMode)if(t.responseMode==="query"||t.responseMode==="fragment")e.responseMode=t.responseMode;else throw"Invalid value for responseMode";if(t.flow){switch(t.flow){case"standard":e.responseType="code";break;case"implicit":e.responseType="id_token token";break;case"hybrid":e.responseType="code id_token token";break;default:throw"Invalid value for flow"}e.flow=t.flow}if(t.timeSkew!=null&&(e.timeSkew=t.timeSkew),t.redirectUri&&(e.redirectUri=t.redirectUri),t.silentCheckSsoRedirectUri&&(e.silentCheckSsoRedirectUri=t.silentCheckSsoRedirectUri),typeof t.silentCheckSsoFallback=="boolean"?e.silentCheckSsoFallback=t.silentCheckSsoFallback:e.silentCheckSsoFallback=!0,typeof t.pkceMethod<"u"){if(t.pkceMethod!=="S256"&&t.pkceMethod!==!1)throw new TypeError(`Invalid value for pkceMethod', expected 'S256' or false but got ${t.pkceMethod}.`);e.pkceMethod=t.pkceMethod}else e.pkceMethod="S256";typeof t.enableLogging=="boolean"?e.enableLogging=t.enableLogging:e.enableLogging=!1,t.logoutMethod==="POST"?e.logoutMethod="POST":e.logoutMethod="GET",typeof t.scope=="string"&&(e.scope=t.scope),typeof t.acrValues=="string"&&(e.acrValues=t.acrValues),typeof t.messageReceiveTimeout=="number"&&t.messageReceiveTimeout>0?e.messageReceiveTimeout=t.messageReceiveTimeout:e.messageReceiveTimeout=1e4,e.responseMode||(e.responseMode="fragment"),e.responseType||(e.responseType="code",e.flow="standard");var s=w(),a=w();a.promise.then(function(){e.onReady&&e.onReady(e.authenticated),s.setSuccess(e.authenticated)}).catch(function(o){s.setError(o)});var i=Ee();function c(){var o=function(f){f||(p.prompt="none"),t.locale&&(p.locale=t.locale),e.login(p).then(function(){a.setSuccess()}).catch(function(v){a.setError(v)})},u=async function(){var f=document.createElement("iframe"),v=await e.createLoginUrl({prompt:"none",redirectUri:e.silentCheckSsoRedirectUri});f.setAttribute("src",v),f.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),f.setAttribute("title","keycloak-silent-check-sso"),f.style.display="none",document.body.appendChild(f);var S=function(E){if(!(E.origin!==window.location.origin||f.contentWindow!==E.source)){var U=P(E.data);R(U,a),document.body.removeChild(f),window.removeEventListener("message",S)}};window.addEventListener("message",S)},p={};switch(t.onLoad){case"check-sso":m.enable?X().then(function(){G().then(function(f){f?a.setSuccess():e.silentCheckSsoRedirectUri?u():o(!1)}).catch(function(f){a.setError(f)})}):e.silentCheckSsoRedirectUri?u():o(!1);break;case"login-required":o(!0);break;default:throw"Invalid value for onLoad"}}function n(){var o=P(window.location.href);if(o&&window.history.replaceState(window.history.state,null,o.newUrl),o&&o.valid)return X().then(function(){R(o,a)}).catch(function(u){a.setError(u)});t.token&&t.refreshToken?(B(t.token,t.refreshToken,t.idToken),m.enable?X().then(function(){G().then(function(u){u?(e.onAuthSuccess&&e.onAuthSuccess(),a.setSuccess(),$()):a.setSuccess()}).catch(function(u){a.setError(u)})}):e.updateToken(-1).then(function(){e.onAuthSuccess&&e.onAuthSuccess(),a.setSuccess()}).catch(function(u){e.onAuthError&&e.onAuthError(),t.onLoad?c():a.setError(u)})):t.onLoad?c():a.setSuccess()}return i.then(function(){Le().then(n).catch(function(o){s.setError(o)})}),i.catch(function(o){s.setError(o)}),s.promise},e.login=function(t){return d.login(t)};function Se(t){if(typeof crypto>"u"||typeof crypto.getRandomValues>"u")throw new Error("Web Crypto API is not available.");return crypto.getRandomValues(new Uint8Array(t))}function Ie(t){return _e(t,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}function _e(t,r){for(var s=Se(t),a=new Array(t),i=0;i<t;i++)a[i]=r.charCodeAt(s[i]%r.length);return String.fromCharCode.apply(null,a)}async function Ue(t,r){if(t!=="S256")throw new TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${t}'.`);const s=new Uint8Array(await Qe(r));return $e(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}function Ae(t){var r={id_token:{acr:t}};return JSON.stringify(r)}e.createLoginUrl=async function(t){var r=le(),s=le(),a=d.redirectUri(t),i={state:r,nonce:s,redirectUri:encodeURIComponent(a),loginOptions:t};t&&t.prompt&&(i.prompt=t.prompt);var c;t&&t.action=="register"?c=e.endpoints.register():c=e.endpoints.authorize();var n=t&&t.scope||e.scope;n?n.indexOf("openid")===-1&&(n="openid "+n):n="openid";var o=c+"?client_id="+encodeURIComponent(e.clientId)+"&redirect_uri="+encodeURIComponent(a)+"&state="+encodeURIComponent(r)+"&response_mode="+encodeURIComponent(e.responseMode)+"&response_type="+encodeURIComponent(e.responseType)+"&scope="+encodeURIComponent(n);if(I&&(o=o+"&nonce="+encodeURIComponent(s)),t&&t.prompt&&(o+="&prompt="+encodeURIComponent(t.prompt)),t&&typeof t.maxAge=="number"&&(o+="&max_age="+encodeURIComponent(t.maxAge)),t&&t.loginHint&&(o+="&login_hint="+encodeURIComponent(t.loginHint)),t&&t.idpHint&&(o+="&kc_idp_hint="+encodeURIComponent(t.idpHint)),t&&t.action&&t.action!="register"&&(o+="&kc_action="+encodeURIComponent(t.action)),t&&t.locale&&(o+="&ui_locales="+encodeURIComponent(t.locale)),t&&t.acr){var u=Ae(t.acr);o+="&claims="+encodeURIComponent(u)}if((t&&t.acrValues||e.acrValues)&&(o+="&acr_values="+encodeURIComponent(t.acrValues||e.acrValues)),e.pkceMethod)try{const p=Ie(96),f=await Ue(e.pkceMethod,p);i.pkceCodeVerifier=p,o+="&code_challenge="+f,o+="&code_challenge_method="+e.pkceMethod}catch(p){throw new Error("Failed to generate PKCE challenge.",{cause:p})}return y.add(i),o},e.logout=function(t){return d.logout(t)},e.createLogoutUrl=function(t){if((t?.logoutMethod??e.logoutMethod)==="POST")return e.endpoints.logout();var s=e.endpoints.logout()+"?client_id="+encodeURIComponent(e.clientId)+"&post_logout_redirect_uri="+encodeURIComponent(d.redirectUri(t,!1));return e.idToken&&(s+="&id_token_hint="+encodeURIComponent(e.idToken)),s},e.register=function(t){return d.register(t)},e.createRegisterUrl=async function(t){return t||(t={}),t.action="register",await e.createLoginUrl(t)},e.createAccountUrl=function(t){var r=T(),s=void 0;return typeof r<"u"&&(s=r+"/account?referrer="+encodeURIComponent(e.clientId)+"&referrer_uri="+encodeURIComponent(d.redirectUri(t))),s},e.accountManagement=function(){return d.accountManagement()},e.hasRealmRole=function(t){var r=e.realmAccess;return!!r&&r.roles.indexOf(t)>=0},e.hasResourceRole=function(t,r){if(!e.resourceAccess)return!1;var s=e.resourceAccess[r||e.clientId];return!!s&&s.roles.indexOf(t)>=0},e.loadUserProfile=function(){var t=T()+"/account",r=new XMLHttpRequest;r.open("GET",t,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+e.token);var s=w();return r.onreadystatechange=function(){r.readyState==4&&(r.status==200?(e.profile=JSON.parse(r.responseText),s.setSuccess(e.profile)):s.setError())},r.send(),s.promise},e.loadUserInfo=function(){var t=e.endpoints.userinfo(),r=new XMLHttpRequest;r.open("GET",t,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+e.token);var s=w();return r.onreadystatechange=function(){r.readyState==4&&(r.status==200?(e.userInfo=JSON.parse(r.responseText),s.setSuccess(e.userInfo)):s.setError())},r.send(),s.promise},e.isTokenExpired=function(t){if(!e.tokenParsed||!e.refreshToken&&e.flow!="implicit")throw"Not authenticated";if(e.timeSkew==null)return L("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var r=e.tokenParsed.exp-Math.ceil(new Date().getTime()/1e3)+e.timeSkew;if(t){if(isNaN(t))throw"Invalid minValidity";r-=t}return r<0},e.updateToken=function(t){var r=w();if(!e.refreshToken)return r.setError(),r.promise;t=t||5;var s=function(){var i=!1;if(t==-1?(i=!0,L("[KEYCLOAK] Refreshing token: forced refresh")):(!e.tokenParsed||e.isTokenExpired(t))&&(i=!0,L("[KEYCLOAK] Refreshing token: token expired")),!i)r.setSuccess(!1);else{var c="grant_type=refresh_token&refresh_token="+e.refreshToken,n=e.endpoints.token();if(k.push(r),k.length==1){var o=new XMLHttpRequest;o.open("POST",n,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.withCredentials=!0,c+="&client_id="+encodeURIComponent(e.clientId);var u=new Date().getTime();o.onreadystatechange=function(){if(o.readyState==4)if(o.status==200){L("[KEYCLOAK] Token refreshed"),u=(u+new Date().getTime())/2;var p=JSON.parse(o.responseText);B(p.access_token,p.refresh_token,p.id_token,u),e.onAuthRefreshSuccess&&e.onAuthRefreshSuccess();for(var f=k.pop();f!=null;f=k.pop())f.setSuccess(!0)}else{W("[KEYCLOAK] Failed to refresh token"),o.status==400&&e.clearToken(),e.onAuthRefreshError&&e.onAuthRefreshError();for(var f=k.pop();f!=null;f=k.pop())f.setError("Failed to refresh token: An unexpected HTTP error occurred while attempting to refresh the token.")}},o.send(c)}}};if(m.enable){var a=G();a.then(function(){s()}).catch(function(i){r.setError(i)})}else s();return r.promise},e.clearToken=function(){e.token&&(B(null,null,null),e.onAuthLogout&&e.onAuthLogout(),e.loginRequired&&e.login())};function T(){if(typeof e.authServerUrl<"u")return e.authServerUrl.charAt(e.authServerUrl.length-1)=="/"?e.authServerUrl+"realms/"+encodeURIComponent(e.realm):e.authServerUrl+"/realms/"+encodeURIComponent(e.realm)}function Te(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}function R(t,r){var s=t.code,a=t.error,i=t.prompt,c=new Date().getTime();if(t.kc_action_status&&e.onActionUpdate&&e.onActionUpdate(t.kc_action_status,t.kc_action),a){if(i!="none")if(t.error_description&&t.error_description==="authentication_expired")e.login(t.loginOptions);else{var n={error:a,error_description:t.error_description};e.onAuthError&&e.onAuthError(n),r&&r.setError(n)}else r&&r.setSuccess();return}else e.flow!="standard"&&(t.access_token||t.id_token)&&f(t.access_token,null,t.id_token,!0);if(e.flow!="implicit"&&s){var o="code="+s+"&grant_type=authorization_code",u=e.endpoints.token(),p=new XMLHttpRequest;p.open("POST",u,!0),p.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o+="&client_id="+encodeURIComponent(e.clientId),o+="&redirect_uri="+t.redirectUri,t.pkceCodeVerifier&&(o+="&code_verifier="+t.pkceCodeVerifier),p.withCredentials=!0,p.onreadystatechange=function(){if(p.readyState==4)if(p.status==200){var v=JSON.parse(p.responseText);f(v.access_token,v.refresh_token,v.id_token,e.flow==="standard"),$()}else e.onAuthError&&e.onAuthError(),r&&r.setError()},p.send(o)}function f(v,S,E,U){c=(c+new Date().getTime())/2,B(v,S,E,c),I&&e.idTokenParsed&&e.idTokenParsed.nonce!=t.storedNonce?(L("[KEYCLOAK] Invalid nonce, clearing token"),e.clearToken(),r&&r.setError()):U&&(e.onAuthSuccess&&e.onAuthSuccess(),r&&r.setSuccess())}}function Ee(){var t=w(),r;typeof l=="string"&&(r=l);function s(n){n?e.endpoints={authorize:function(){return n.authorization_endpoint},token:function(){return n.token_endpoint},logout:function(){if(!n.end_session_endpoint)throw"Not supported by the OIDC server";return n.end_session_endpoint},checkSessionIframe:function(){if(!n.check_session_iframe)throw"Not supported by the OIDC server";return n.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!n.userinfo_endpoint)throw"Not supported by the OIDC server";return n.userinfo_endpoint}}:e.endpoints={authorize:function(){return T()+"/protocol/openid-connect/auth"},token:function(){return T()+"/protocol/openid-connect/token"},logout:function(){return T()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){return T()+"/protocol/openid-connect/login-status-iframe.html"},thirdPartyCookiesIframe:function(){return T()+"/protocol/openid-connect/3p-cookies/step1.html"},register:function(){return T()+"/protocol/openid-connect/registrations"},userinfo:function(){return T()+"/protocol/openid-connect/userinfo"}}}if(r){var a=new XMLHttpRequest;a.open("GET",r,!0),a.setRequestHeader("Accept","application/json"),a.onreadystatechange=function(){if(a.readyState==4)if(a.status==200||ce(a)){var n=JSON.parse(a.responseText);e.authServerUrl=n["auth-server-url"],e.realm=n.realm,e.clientId=n.resource,s(null),t.setSuccess()}else t.setError()},a.send()}else{e.clientId=l.clientId;var i=l.oidcProvider;if(!i)e.authServerUrl=l.url,e.realm=l.realm,s(null),t.setSuccess();else if(typeof i=="string"){var c;i.charAt(i.length-1)=="/"?c=i+".well-known/openid-configuration":c=i+"/.well-known/openid-configuration";var a=new XMLHttpRequest;a.open("GET",c,!0),a.setRequestHeader("Accept","application/json"),a.onreadystatechange=function(){if(a.readyState==4)if(a.status==200||ce(a)){var o=JSON.parse(a.responseText);s(o),t.setSuccess()}else t.setError()},a.send()}else s(i),t.setSuccess()}return t.promise}function ce(t){return t.status==0&&t.responseText&&t.responseURL.startsWith("file:")}function B(t,r,s,a){if(e.tokenTimeoutHandle&&(clearTimeout(e.tokenTimeoutHandle),e.tokenTimeoutHandle=null),r?(e.refreshToken=r,e.refreshTokenParsed=oe(r)):(delete e.refreshToken,delete e.refreshTokenParsed),s?(e.idToken=s,e.idTokenParsed=oe(s)):(delete e.idToken,delete e.idTokenParsed),t){if(e.token=t,e.tokenParsed=oe(t),e.sessionId=e.tokenParsed.sid,e.authenticated=!0,e.subject=e.tokenParsed.sub,e.realmAccess=e.tokenParsed.realm_access,e.resourceAccess=e.tokenParsed.resource_access,a&&(e.timeSkew=Math.floor(a/1e3)-e.tokenParsed.iat),e.timeSkew!=null&&(L("[KEYCLOAK] Estimated time difference between browser and server is "+e.timeSkew+" seconds"),e.onTokenExpired)){var i=(e.tokenParsed.exp-new Date().getTime()/1e3+e.timeSkew)*1e3;L("[KEYCLOAK] Token expires in "+Math.round(i/1e3)+" s"),i<=0?e.onTokenExpired():e.tokenTimeoutHandle=setTimeout(e.onTokenExpired,i)}}else delete e.token,delete e.tokenParsed,delete e.subject,delete e.realmAccess,delete e.resourceAccess,e.authenticated=!1}function le(){if(typeof crypto>"u"||typeof crypto.randomUUID>"u")throw new Error("Web Crypto API is not available.");return crypto.randomUUID()}function P(t){var r=Ce(t);if(r){var s=y.get(r.state);return s&&(r.valid=!0,r.redirectUri=s.redirectUri,r.storedNonce=s.nonce,r.prompt=s.prompt,r.pkceCodeVerifier=s.pkceCodeVerifier,r.loginOptions=s.loginOptions),r}}function Ce(t){var r;switch(e.flow){case"standard":r=["code","state","session_state","kc_action_status","kc_action","iss"];break;case"implicit":r=["access_token","token_type","id_token","state","session_state","expires_in","kc_action_status","kc_action","iss"];break;case"hybrid":r=["access_token","token_type","id_token","code","state","session_state","expires_in","kc_action_status","kc_action","iss"];break}r.push("error"),r.push("error_description"),r.push("error_uri");var s=t.indexOf("?"),a=t.indexOf("#"),i,c;if(e.responseMode==="query"&&s!==-1?(i=t.substring(0,s),c=ue(t.substring(s+1,a!==-1?a:t.length),r),c.paramsString!==""&&(i+="?"+c.paramsString),a!==-1&&(i+=t.substring(a))):e.responseMode==="fragment"&&a!==-1&&(i=t.substring(0,a),c=ue(t.substring(a+1),r),c.paramsString!==""&&(i+="#"+c.paramsString)),c&&c.oauthParams){if(e.flow==="standard"||e.flow==="hybrid"){if((c.oauthParams.code||c.oauthParams.error)&&c.oauthParams.state)return c.oauthParams.newUrl=i,c.oauthParams}else if(e.flow==="implicit"&&(c.oauthParams.access_token||c.oauthParams.error)&&c.oauthParams.state)return c.oauthParams.newUrl=i,c.oauthParams}}function ue(t,r){for(var s=t.split("&"),a={paramsString:"",oauthParams:{}},i=0;i<s.length;i++){var c=s[i].indexOf("="),n=s[i].slice(0,c);r.indexOf(n)!==-1?a.oauthParams[n]=s[i].slice(c+1):(a.paramsString!==""&&(a.paramsString+="&"),a.paramsString+=s[i])}return a}function w(){var t={setSuccess:function(r){t.resolve(r)},setError:function(r){t.reject(r)}};return t.promise=new Promise(function(r,s){t.resolve=r,t.reject=s}),t}function xe(t,r,s){var a=null,i=new Promise(function(c,n){a=setTimeout(function(){n({error:s})},r)});return Promise.race([t,i]).finally(function(){clearTimeout(a)})}function X(){var t=w();if(!m.enable||m.iframe)return t.setSuccess(),t.promise;var r=document.createElement("iframe");m.iframe=r,r.onload=function(){var i=e.endpoints.authorize();i.charAt(0)==="/"?m.iframeOrigin=Te():m.iframeOrigin=i.substring(0,i.indexOf("/",8)),t.setSuccess()};var s=e.endpoints.checkSessionIframe();r.setAttribute("src",s),r.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),r.setAttribute("title","keycloak-session-iframe"),r.style.display="none",document.body.appendChild(r);var a=function(i){if(!(i.origin!==m.iframeOrigin||m.iframe.contentWindow!==i.source)&&(i.data=="unchanged"||i.data=="changed"||i.data=="error")){i.data!="unchanged"&&e.clearToken();for(var c=m.callbackList.splice(0,m.callbackList.length),n=c.length-1;n>=0;--n){var o=c[n];i.data=="error"?o.setError():o.setSuccess(i.data=="unchanged")}}};return window.addEventListener("message",a,!1),t.promise}function $(){m.enable&&e.token&&setTimeout(function(){G().then(function(t){t&&$()})},m.interval*1e3)}function G(){var t=w();if(m.iframe&&m.iframeOrigin){var r=e.clientId+" "+(e.sessionId?e.sessionId:"");m.callbackList.push(t);var s=m.iframeOrigin;m.callbackList.length==1&&m.iframe.contentWindow.postMessage(r,s)}else t.setSuccess();return t.promise}function Le(){var t=w();if((m.enable||e.silentCheckSsoRedirectUri)&&typeof e.endpoints.thirdPartyCookiesIframe=="function"){var r=document.createElement("iframe");r.setAttribute("src",e.endpoints.thirdPartyCookiesIframe()),r.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),r.setAttribute("title","keycloak-3p-check-iframe"),r.style.display="none",document.body.appendChild(r);var s=function(a){r.contentWindow===a.source&&(a.data!=="supported"&&a.data!=="unsupported"||(a.data==="unsupported"&&(W(`[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:

 - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).
 - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).

For more information see: https://www.keycloak.org/securing-apps/javascript-adapter#_modern_browsers`),m.enable=!1,e.silentCheckSsoFallback&&(e.silentCheckSsoRedirectUri=!1)),document.body.removeChild(r),window.removeEventListener("message",s),t.setSuccess()))};window.addEventListener("message",s,!1)}else t.setSuccess();return xe(t.promise,e.messageReceiveTimeout,"Timeout when waiting for 3rd party check iframe message.")}function Q(t){if(!t||t=="default")return{login:async function(n){return window.location.assign(await e.createLoginUrl(n)),w().promise},logout:async function(n){if((n?.logoutMethod??e.logoutMethod)==="GET"){window.location.replace(e.createLogoutUrl(n));return}const u=document.createElement("form");u.setAttribute("method","POST"),u.setAttribute("action",e.createLogoutUrl(n)),u.style.display="none";const p={id_token_hint:e.idToken,client_id:e.clientId,post_logout_redirect_uri:d.redirectUri(n,!1)};for(const[f,v]of Object.entries(p)){const S=document.createElement("input");S.setAttribute("type","hidden"),S.setAttribute("name",f),S.setAttribute("value",v),u.appendChild(S)}document.body.appendChild(u),u.submit()},register:async function(n){return window.location.assign(await e.createRegisterUrl(n)),w().promise},accountManagement:function(){var n=e.createAccountUrl();if(typeof n<"u")window.location.href=n;else throw"Not supported by the OIDC server";return w().promise},redirectUri:function(n,o){return n&&n.redirectUri?n.redirectUri:e.redirectUri?e.redirectUri:location.href}};if(t=="cordova"){m.enable=!1;var r=function(n,o,u){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(n,o,u):window.open(n,o,u)},s=function(n){return n&&n.cordovaOptions?Object.keys(n.cordovaOptions).reduce(function(o,u){return o[u]=n.cordovaOptions[u],o},{}):{}},a=function(n){return Object.keys(n).reduce(function(o,u){return o.push(u+"="+n[u]),o},[]).join(",")},i=function(n){var o=s(n);return o.location="no",n&&n.prompt=="none"&&(o.hidden="yes"),a(o)},c=function(){return e.redirectUri||"http://localhost"};return{login:async function(n){var o=w(),u=i(n),p=await e.createLoginUrl(n),f=r(p,"_blank",u),v=!1,S=!1,E=function(){S=!0,f.close()};return f.addEventListener("loadstart",function(U){if(U.url.indexOf(c())==0){var te=P(U.url);R(te,o),E(),v=!0}}),f.addEventListener("loaderror",function(U){if(!v)if(U.url.indexOf(c())==0){var te=P(U.url);R(te,o),E(),v=!0}else o.setError(),E()}),f.addEventListener("exit",function(U){S||o.setError({reason:"closed_by_user"})}),o.promise},logout:function(n){var o=w(),u=e.createLogoutUrl(n),p=r(u,"_blank","location=no,hidden=yes,clearcache=yes"),f;return p.addEventListener("loadstart",function(v){v.url.indexOf(c())==0&&p.close()}),p.addEventListener("loaderror",function(v){v.url.indexOf(c())==0||(f=!0),p.close()}),p.addEventListener("exit",function(v){f?o.setError():(e.clearToken(),o.setSuccess())}),o.promise},register:async function(n){var o=w(),u=await e.createRegisterUrl(),p=i(n),f=r(u,"_blank",p);return f.addEventListener("loadstart",function(v){if(v.url.indexOf(c())==0){f.close();var S=P(v.url);R(S,o)}}),o.promise},accountManagement:function(){var n=e.createAccountUrl();if(typeof n<"u"){var o=r(n,"_blank","location=no");o.addEventListener("loadstart",function(u){u.url.indexOf(c())==0&&o.close()})}else throw"Not supported by the OIDC server"},redirectUri:function(n){return c()}}}if(t=="cordova-native")return m.enable=!1,{login:async function(n){var o=w(),u=await e.createLoginUrl(n);return universalLinks.subscribe("keycloak",function(p){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var f=P(p.url);R(f,o)}),window.cordova.plugins.browsertab.openUrl(u),o.promise},logout:function(n){var o=w(),u=e.createLogoutUrl(n);return universalLinks.subscribe("keycloak",function(p){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),e.clearToken(),o.setSuccess()}),window.cordova.plugins.browsertab.openUrl(u),o.promise},register:async function(n){var o=w(),u=await e.createRegisterUrl(n);return universalLinks.subscribe("keycloak",function(p){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var f=P(p.url);R(f,o)}),window.cordova.plugins.browsertab.openUrl(u),o.promise},accountManagement:function(){var n=e.createAccountUrl();if(typeof n<"u")window.cordova.plugins.browsertab.openUrl(n);else throw"Not supported by the OIDC server"},redirectUri:function(n){return n&&n.redirectUri?n.redirectUri:e.redirectUri?e.redirectUri:"http://localhost"}};throw"invalid adapter type: "+t}const O="kc-callback-";var Z=function(){if(!(this instanceof Z))return new Z;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");var t=this;function r(){const c=Date.now();for(const[n,o]of a()){const u=i(o);(u===null||u<c)&&localStorage.removeItem(n)}}function s(){for(const[c]of a())localStorage.removeItem(c)}function a(){return Object.entries(localStorage).filter(([c])=>c.startsWith(O))}function i(c){let n;try{n=JSON.parse(c)}catch{return null}return ie(n)&&"expires"in n&&typeof n.expires=="number"?n.expires:null}t.get=function(c){if(c){var n=O+c,o=localStorage.getItem(n);return o&&(localStorage.removeItem(n),o=JSON.parse(o)),r(),o}},t.add=function(c){r();const n=O+c.state,o=JSON.stringify({...c,expires:Date.now()+60*60*1e3});try{localStorage.setItem(n,o)}catch{s(),localStorage.setItem(n,o)}}},ee=function(){if(!(this instanceof ee))return new ee;var t=this;t.get=function(i){if(i){var c=s(O+i);if(a(O+i,"",r(-100)),c)return JSON.parse(c)}},t.add=function(i){a(O+i.state,JSON.stringify(i),r(60))},t.removeItem=function(i){a(i,"",r(-100))};var r=function(i){var c=new Date;return c.setTime(c.getTime()+i*60*1e3),c},s=function(i){for(var c=i+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var u=n[o];u.charAt(0)==" ";)u=u.substring(1);if(u.indexOf(c)==0)return u.substring(c.length,u.length)}return""},a=function(i,c,n){var o=i+"="+c+"; expires="+n.toUTCString()+"; ";document.cookie=o}};function Re(){try{return new Z}catch{}return new ee}function de(t){return function(){e.enableLogging&&t.apply(console,Array.prototype.slice.call(arguments))}}}function $e(l){const e=String.fromCodePoint(...l);return btoa(e)}async function Qe(l){const d=new TextEncoder().encode(l);if(typeof crypto>"u"||typeof crypto.subtle>"u")throw new Error("Web Crypto API is not available.");return await crypto.subtle.digest("SHA-256",d)}function oe(l){const[e,d]=l.split(".");if(typeof d!="string")throw new Error("Unable to decode token, payload not found.");let k;try{k=Ze(d)}catch(y){throw new Error("Unable to decode token, payload is not a valid Base64URL value.",{cause:y})}try{return JSON.parse(k)}catch(y){throw new Error("Unable to decode token, payload is not a valid JSON value.",{cause:y})}}function Ze(l){let e=l.replaceAll("-","+").replaceAll("_","/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("Input is not of the correct length.")}try{return et(e)}catch{return atob(e)}}function et(l){return decodeURIComponent(atob(l).replace(/(.)/g,(e,d)=>{let k=d.charCodeAt(0).toString(16).toUpperCase();return k.length<2&&(k="0"+k),"%"+k}))}function ie(l){return typeof l=="object"&&l!==null}const C=je("authentication-keycloak:KeycloakAuthPlugin");var V,F,j,b,D,q,M,J,Y,x,be,z;class tt{constructor(e){_(this,x);_(this,V);_(this,F);_(this,j);_(this,b);_(this,D);_(this,q);_(this,M);_(this,J);_(this,Y,Ne({kind:"pending"}));A(this,V,e.references.notifier),A(this,F,e.intl),A(this,D,{redirectUri:void 0}),A(this,q,{redirectUri:void 0});try{A(this,j,rt(e.properties))}catch(d){throw new Error("Invalid keycloak configuration",{cause:d})}try{A(this,b,new ye(g(this,j).keycloakConfig))}catch(d){throw new Error("Failed to construct keycloak instance",{cause:d})}K(this,x,be).call(this).catch(d=>{K(this,x,z).call(this,{kind:"error",error:d}),g(this,V).notify({level:"error",title:g(this,F).formatMessage({id:"loginFailed.title"}),message:g(this,F).formatMessage({id:"loginFailed.message"})}),C.error("Failed to check if user is authenticated",d)})}destroy(){clearInterval(g(this,M)),A(this,J,Me(g(this,J))),A(this,M,void 0)}getAuthState(){return g(this,Y).value}getLoginBehavior(){return{kind:"effect",login:()=>{C.debug("Login with options",g(this,q)),g(this,b).login(g(this,q))}}}logout(){C.debug("Logout with options",g(this,D)),g(this,b).logout(g(this,D))}__refresh(e,d){clearInterval(g(this,M)),A(this,M,setInterval(()=>{g(this,b).updateToken(d).catch(k=>{C.error("Failed to refresh token",k),K(this,x,z).call(this,{kind:"not-authenticated"}),this.destroy()})},e))}}V=new WeakMap,F=new WeakMap,j=new WeakMap,b=new WeakMap,D=new WeakMap,q=new WeakMap,M=new WeakMap,J=new WeakMap,Y=new WeakMap,x=new WeakSet,be=async function(){const e=g(this,j),d=g(this,j).keycloakInitOptions,k=e.refreshOptions;let y;try{y=await g(this,b).init(d)}catch(m){const I=typeof m=="string"?new Error(m):m;throw new Error("Failed to initialize keycloak session",{cause:I})}y?(K(this,x,z).call(this,{kind:"authenticated",sessionInfo:{userId:g(this,b).subject?g(this,b).subject:"undefined",userName:g(this,b).idTokenParsed?.preferred_username,attributes:{keycloak:g(this,b),familyName:g(this,b).idTokenParsed?.family_name,givenName:g(this,b).idTokenParsed?.given_name,userName:g(this,b).idTokenParsed?.preferred_username}}}),C.debug(`User ${g(this,b).subject} is authenticated`),k.autoRefresh&&(C.debug("Starting auto-refresh",k),this.__refresh(k.interval,k.timeLeft))):(K(this,x,z).call(this,{kind:"not-authenticated"}),C.debug("User is not authenticated"))},z=function(e){g(this,Y).value=e};const ge={autoRefresh:!0,interval:6e3,timeLeft:70},ve={onLoad:"check-sso",pkceMethod:"S256"};function rt(l){const{keycloakOptions:e}=l,{refreshOptions:d,keycloakInitOptions:k,keycloakConfig:y}=e;return{refreshOptions:{...nt(d)},keycloakInitOptions:{...ot(k)},keycloakConfig:{...it(y)}}}function nt(l){return!l||se(l)?(C.warn(`The autorefresh options of the Keycloak configuration should be set to ensure automatic refreshes at specified intervals. Defaulting to '${ge}'.`),Object.assign({},{...ge})):l}function ot(l){return!l||se(l)?(C.warn(`The Keycloak init options of the keycloak configuration should be set. Defaulting to '${ve}'.`),Object.assign({},{...ve})):l}function it(l){if(!l||se(l))throw new Error("KeycloakConfig not found: The Keycloak configuration options are required by the plugin to perform login and logout operations");return l}const se=l=>l&&Object.keys(l).length===0&&l.constructor===Object,at={"keycloak-sample":{name:"keycloak-sample",services:{SampleTokenInterceptor:{name:"SampleTokenInterceptor",clazz:Xe,provides:[{name:"http.Interceptor",qualifier:void 0}],references:{authService:{name:"authentication.AuthService",qualifier:void 0,all:!1}}}},ui:{references:[{name:"authentication.AuthService",qualifier:void 0,all:!1},{name:"http.HttpService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/authentication":{name:"@open-pioneer/authentication",services:{AuthServiceImpl:{name:"AuthServiceImpl",clazz:He,provides:[{name:"authentication.AuthService",qualifier:void 0}],references:{plugin:{name:"authentication.AuthPlugin",qualifier:void 0,all:!1}}}},ui:{references:[{name:"authentication.AuthService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/http":{name:"@open-pioneer/http",services:{HttpServiceImpl:{name:"HttpServiceImpl",clazz:qe,provides:[{name:"http.HttpService",qualifier:void 0}],references:{interceptors:{name:"http.Interceptor",qualifier:void 0,all:!0}}}},ui:{references:[]},properties:{}},"@open-pioneer/runtime":{name:"@open-pioneer/runtime",services:{},ui:{references:[]},properties:{}},"@open-pioneer/notifier":{name:"@open-pioneer/notifier",services:{NotificationServiceImpl:{name:"NotificationServiceImpl",clazz:ze,provides:[{name:"notifier.NotificationService",qualifier:void 0}],references:{appCtx:{name:"runtime.ApplicationContext",qualifier:void 0,all:!1}}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{position:{value:"top-right",required:!1}}},"@open-pioneer/core":{name:"@open-pioneer/core",services:{},ui:{references:[]},properties:{}},"@open-pioneer/reactivity":{name:"@open-pioneer/reactivity",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime-react-support":{name:"@open-pioneer/runtime-react-support",services:{},ui:{references:[]},properties:{}},"@open-pioneer/base-theme":{name:"@open-pioneer/base-theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/react-utils":{name:"@open-pioneer/react-utils",services:{},ui:{references:[]},properties:{}},"@open-pioneer/authentication-keycloak":{name:"@open-pioneer/authentication-keycloak",services:{KeycloakAuthPlugin:{name:"KeycloakAuthPlugin",clazz:tt,provides:[{name:"authentication.AuthPlugin",qualifier:void 0},{name:"authentication-keycloak.KeycloakAuthPlugin",qualifier:void 0}],references:{notifier:{name:"notifier.NotificationService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{keycloakOptions:{value:{refreshOptions:null,keycloakInitOptions:null,keycloakConfig:null,keycloakLogoutOptions:null,keycloakLoginOptions:null},required:!1}}}},st="",ct=["de","en"];function lt(l){switch(l){case"de":return me(()=>import("./B1VR2lbE9HZn.js"),[],import.meta.url).then(e=>e.default);case"en":return me(()=>import("./MiNfHBqPghPY.js"),[],import.meta.url).then(e=>e.default)}throw new Error(`Unsupported locale: '${l}'`)}const ut=Oe(st),dt=Object.freeze(Object.defineProperty({__proto__:null,loadMessages:lt,locales:ct,packages:at,styles:ut},Symbol.toStringTag,{value:"Module"})),ft="keycloak-sample",ae=Je.bind(void 0,ft);function pt(){const l=ae("authentication.AuthService"),e=()=>{l.logout()};return h.jsx(we,{colorPalette:"red",onClick:e,children:"Log out"})}function ht(){const l=ae("authentication.AuthService"),e=ae("http.HttpService"),d=Fe(l),y=(d.kind=="authenticated"?d.sessionInfo:void 0)?.userName,m=()=>{e.fetch("https://ogc-api.nrw.de/inspire-us-kindergarten/v1/collections/governmentalservice/items?f=json").catch(I=>console.error("Request failed",I))};return h.jsxs(h.Fragment,{children:[h.jsx(Ve,{}),h.jsxs(Ye,{maxW:"800px",children:[h.jsxs(Be,{height:"100%",direction:"column",overflow:"hidden",children:[h.jsx(pe,{as:"h1",size:"2xl",children:"Keycloak Sample"}),h.jsxs(he,{mt:4,gap:2,align:"stretch",children:[h.jsx(pe,{as:"h2",size:"xl",children:"Additional Setup"}),h.jsx(N,{children:"This application requires additional setup. Most importantly, a Keycloak installation must be present."}),h.jsxs(N,{children:["The following environment properties should be set via vite (e.g. in"," ",h.jsx(H,{children:".env.local"}),"):"]}),h.jsxs(Ge,{children:[h.jsxs(ne,{children:[h.jsx(H,{children:"VITE_KEYCLOAK_CONFIG_URL"})," (the URL to the Keycloak instance)"]}),h.jsxs(ne,{children:[h.jsx(H,{children:"VITE_KEYCLOAK_CONFIG_REALM"})," (the Keycloak realm)"]}),h.jsxs(ne,{children:[h.jsx(H,{children:"VITE_KEYCLOAK_CONFIG_CLIENT_ID"})," (the client id of this application)"]})]}),h.jsxs(N,{textAlign:"center",children:[h.jsx(N,{as:"b",children:"Status: "}),y!=null?h.jsxs(h.Fragment,{children:["Logged in as ",h.jsx(H,{children:y}),"."]}):h.jsx(h.Fragment,{children:"Not logged in."})]})]})]}),h.jsx(De,{renderErrorFallback:I=>h.jsxs(h.Fragment,{children:[h.jsx(ke,{children:"An Error occured while trying to login!"}),h.jsx(ke,{color:"red",children:I.message})]}),children:h.jsxs(he,{align:"center",p:10,mt:2,gap:3,border:"2px solid red",borderRadius:5,children:[h.jsx(N,{textAlign:"center",children:"This part of the application is only visible when logged in."}),h.jsx(pt,{}),h.jsxs(N,{children:["The following button triggers a request against a backend. The request will automatically include the Keycloak token (see"," ",h.jsx(H,{children:"SampleTokenInterceptor.ts"}),"):"]}),h.jsx(we,{onClick:m,children:"Trigger Request With Token"})]})})]})]})}const mt=new URLSearchParams(window.location.search),kt=mt.get("lang")||void 0,gt=Ke({component:ht,appMetadata:dt,config:{properties:{"@open-pioneer/authentication-keycloak":{keycloakOptions:{refreshOptions:{autoRefresh:!0,interval:6e3,timeLeft:70},keycloakInitOptions:{onLoad:"check-sso",pkceMethod:"S256"},keycloakConfig:{url:void 0,realm:void 0,clientId:void 0}}}},locale:kt}});customElements.define("keycloak-app-element",gt);
