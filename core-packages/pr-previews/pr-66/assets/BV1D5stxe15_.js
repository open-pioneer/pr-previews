var m=t=>{throw TypeError(t)};var k=(t,n,e)=>n.has(t)||m("Cannot "+e);var r=(t,n,e)=>(k(t,n,"read from private field"),e?e.call(t):n.get(t)),h=(t,n,e)=>n.has(t)?m("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(t):n.set(t,e),o=(t,n,e,a)=>(k(t,n,"write to private field"),a?a.call(t,e):n.set(t,e),e),A=(t,n,e)=>(k(t,n,"access private method"),e);import{ae as E,a8 as F,af as j,c as I,r as d,j as u}from"./BDSkedxQL-YV.js";import{E as p}from"./vOBnYnib6xFk.js";import{u as B}from"./B0WlhuaTcrRe.js";import{B as C}from"./CNWuYlzDx_4w.js";const b=I("authentication:AuthService");var c,i,s,l,f,v;class $ extends p{constructor(e){super();h(this,f);h(this,c);h(this,i);h(this,s);h(this,l);o(this,c,e.references.plugin),o(this,i,r(this,c).getAuthState()),o(this,l,r(this,c).on?.("changed",()=>A(this,f,v).call(this))),b.debug(`Constructed with initial auth state '${r(this,i).kind}'`,r(this,i))}destroy(){r(this,s)?.reject(E()),o(this,s,void 0),o(this,l,F(r(this,l)))}getAuthState(){return r(this,i)}getSessionInfo(){return r(this,i).kind!=="pending"?Promise.resolve(S(r(this,i))):(r(this,s)||o(this,s,j()),r(this,s).promise)}getLoginBehavior(){return r(this,c).getLoginBehavior()}logout(){b.debug("Triggering logout"),r(this,c).logout()}}c=new WeakMap,i=new WeakMap,s=new WeakMap,l=new WeakMap,f=new WeakSet,v=function(){const e=r(this,c).getAuthState();o(this,i,e),e.kind!=="pending"&&r(this,s)&&(r(this,s).resolve(S(e)),o(this,s,void 0)),b.debug(`Auth state changed to '${r(this,i).kind}'`,r(this,i)),this.emit("changed")};function S(t){return t.kind==="authenticated"?t.sessionInfo:void 0}const L="@open-pioneer/authentication",P=B.bind(void 0,L);function w(t){const n=d.useCallback(g=>{const x=t.on("changed",g);return()=>x.destroy()},[t]),e=d.useCallback(()=>t.getAuthState(),[t]);return d.useSyncExternalStore(n,e)}const H=t=>{const n=P("authentication.AuthService"),e=w(n),a=d.useMemo(()=>{if(e.kind==="not-authenticated")return n.getLoginBehavior()},[n,e.kind]);switch(d.useEffect(()=>{e.kind==="not-authenticated"&&a?.kind==="effect"&&a.login()},[a,e.kind]),e.kind){case"pending":return null;case"not-authenticated":{if(!a||a.kind!=="fallback")return null;const g=a.Fallback;return t.renderFallback?u.jsx(u.Fragment,{children:t.renderFallback(g)}):u.jsx(g,{...t.fallbackProps})}case"error":return t.renderErrorFallback?t.renderErrorFallback(e.error):t.errorFallback?u.jsx(t.errorFallback,{error:e.error}):u.jsx(C,{className:"authentication-error",children:"An error occurred during authentication."});case"authenticated":return u.jsx(u.Fragment,{children:t.children})}};export{$ as A,H as F,w as u};
