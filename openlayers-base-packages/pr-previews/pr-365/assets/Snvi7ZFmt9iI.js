const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CcyxBKh9H3JI.js","./Dch09mLNbtBx.js","./B0U5l2hn8DlK.js","./DnPhTJjuvB9x.js","./CIxQfNC2cMTH.js","./8OrxpnVJc3KT.js","./CmjcKXDoFKDR.js","./D7zOpgirDLuA.js","./C8z7RweOG7Qz.js","./CxlYFj-33NQH.js"])))=>i.map(i=>d[i]);
var en=Object.defineProperty;var Xe=i=>{throw TypeError(i)};var tn=(i,e,t)=>e in i?en(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var y=(i,e,t)=>tn(i,typeof e!="symbol"?e+"":e,t),Te=(i,e,t)=>e.has(i)||Xe("Cannot "+t);var _=(i,e,t)=>(Te(i,e,"read from private field"),t?t.call(i):e.get(i)),x=(i,e,t)=>e.has(i)?Xe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),C=(i,e,t,n)=>(Te(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),te=(i,e,t)=>(Te(i,e,"access private method"),t);import{aE as nn,b5 as sn,b6 as rn,b7 as on,b8 as an,aP as cn,aX as ln,b9 as un,ba as dn,a0 as hn,bb as gn,b0 as fn,h as N,bc as mn,bd as pn,be as yn,bf as St,bg as _n,bh as vn,a as ee,b as Pe,aL as _e,bi as Ze,bj as K,E as Qe,_ as R,bk as ke,a_ as Z,an as ve,bl as me,bm as et,bn as A,m as F,bo as U,bp as je,bq as Sn,br as xn,x as Cn,bs as Re,bt as wn,bu as bn,bv as xt,ao as Ct,bw as En,bx as Mn,by as tt,bz as Pn,bA as nt,bB as Fn,bC as st,bD as Be,a$ as Ue,b1 as Ln,u as z,aZ as $,g as B,B as L,bE as In,b4 as Fe,bF as Tn,am as Se,bG as kn,bH as An,c as xe,ax as se,F as De,C as Nn,d as wt,bI as it,bJ as On,bK as rt,i as ot}from"./CIxQfNC2cMTH.js";import{u as jn,m as Rn,r as f,n as Dn,h as We,o as bt,p as Et,q as Mt,j as d,f as G,s as Gn,t as Vn,c as ge,b as Pt,P as Hn,E as $n,v as Bn,w as at,B as Ft,C as Un,x as Wn,i as Lt,y as It,l as zn,I as Kn}from"./DnPhTJjuvB9x.js";import{G as Tt,i as kt}from"./B-xIxjuOza_9.js";import{a as qn}from"./C5ZA6LylQzJw.js";import{D as At,S as Yn,I as Jn,c as Xn,a as Zn}from"./7-jTxxRgzMuS.js";import{u as H}from"./8OrxpnVJc3KT.js";import{T as Q,L as Qn,V as es}from"./D7zOpgirDLuA.js";import{c as Nt}from"./D-6auUUTUlQk.js";import{L as Ge}from"./Dg3C47GSrK2D.js";import{u as Ot,F as Ce}from"./CmjcKXDoFKDR.js";import{F as we}from"./BsO-e0_dqALd.js";import{H as Ve}from"./CHC26VxbYQqb.js";import{F as O,r as jt}from"./B0U5l2hn8DlK.js";import{F as ts}from"./CxlYFj-33NQH.js";import{_ as ns}from"./Dch09mLNbtBx.js";function ss(i){const{theme:e}=jn(),t=Rn();return f.useMemo(()=>Dn(e.direction,{...t,...i}),[i,e.direction,t])}var ze=We(function(e,t){const{htmlSize:n,...s}=e,r=bt("Input",s),o=Et(s),a=Ot(o),c=Mt("chakra-input",e.className);return d.jsx(G.input,{size:n,...a,__css:r.field,ref:t,className:c})});ze.displayName="Input";ze.id="Input";var Rt=We(function(e,t){const{children:n,placeholder:s,className:r,...o}=e;return d.jsxs(G.select,{...o,ref:t,className:Mt("chakra-select",r),children:[s&&d.jsx("option",{value:"",children:s}),n]})});Rt.displayName="SelectField";function is(i,e){const t={},n={};for(const[s,r]of Object.entries(i))e.includes(s)?t[s]=r:n[s]=r;return[t,n]}var Ke=We((i,e)=>{var t;const n=bt("Select",i),{rootProps:s,placeholder:r,icon:o,color:a,height:c,h:l,minH:u,minHeight:h,iconColor:m,iconSize:g,...p}=Et(i),[v,S]=is(p,Vn),M=Ot(S),j={width:"100%",height:"fit-content",position:"relative",color:a},I={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...(t=n.field)==null?void 0:t._focus}};return d.jsxs(G.div,{className:"chakra-select__wrapper",__css:j,...v,...s,children:[d.jsx(Rt,{ref:e,height:l??c,minH:u??h,placeholder:r,...M,__css:I,children:i.children}),d.jsx(Dt,{"data-disabled":Gn(M.disabled),...(m||a)&&{color:m||a},__css:n.icon,...g&&{fontSize:g},children:o})]})});Ke.displayName="Select";var rs=i=>d.jsx("svg",{viewBox:"0 0 24 24",...i,children:d.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),os=G("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Dt=i=>{const{children:e=d.jsx(rs,{}),...t}=i,n=f.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return d.jsx(os,{...t,className:"chakra-select__icon-wrapper",children:f.isValidElement(e)?n:null})};Dt.displayName="SelectIcon";const b={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Le extends nn{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+sn,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(b.ELEMENT,this.handleElementChanged),this.addChangeListener(b.MAP,this.handleMapChanged),this.addChangeListener(b.OFFSET,this.handleOffsetChanged),this.addChangeListener(b.POSITION,this.handlePositionChanged),this.addChangeListener(b.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(b.ELEMENT)}getId(){return this.id}getMap(){return this.get(b.MAP)||null}getOffset(){return this.get(b.OFFSET)}getPosition(){return this.get(b.POSITION)}getPositioning(){return this.get(b.POSITIONING)}handleElementChanged(){rn(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(on(this.element),an(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=cn(e,ln.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(b.ELEMENT,e)}setMap(e){this.set(b.MAP,e)}setOffset(e){this.set(b.OFFSET,e)}setPosition(e){this.set(b.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(b.POSITION))return;const n=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),r=this.getRect(s,[un(s),dn(s)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!hn(n,r)){const a=r[0]-n[0],c=n[2]-r[2],l=r[1]-n[1],u=n[3]-r[3],h=[0,0];if(a<0?h[0]=a-o:c<0&&(h[0]=Math.abs(c)+o),l<0?h[1]=l-o:u<0&&(h[1]=Math.abs(u)+o),h[0]!==0||h[1]!==0){const m=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(m);if(!g)return;const p=[g[0]+h[0],g[1]+h[1]],v=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(p),duration:v.duration,easing:v.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),s=n.left+window.pageXOffset,r=n.top+window.pageYOffset;return[s,r,s+t[0],r+t[1]]}setPositioning(e){this.set(b.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(n,s)}updateRenderedPosition(e,t){const n=this.element.style,s=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+s[0])+"px",a=Math.round(e[1]+s[1])+"px";let c="0%",l="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?c="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(c="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?l="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(l="-50%");const u=`translate(${c}, ${l}) translate(${o}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,n.transform=u)}getOptions(){return this.options}}const fr=gn,as=25.4/.28,cs=39.37;function qe(i){return Ye(i,ls,us)}function ls(i){return i.getView()}function us(i,e){return i.on("change:view",e)}function Gt(i){return qe(i)?.getProjection()}function ds(i){const e=qe(i);return Ye(e,hs,gs)}function hs(i){return i.getResolution()}function gs(i,e){return i.on("change:resolution",e)}function fs(i){const e=qe(i);return Ye(e,ms,ps)}function ms(i){return i.getCenter()}function ps(i,e){return i.on("change:center",e)}function ys(i){const e=fs(i),t=ds(i),n=Gt(i);return f.useMemo(()=>{if(n==null||t==null||e==null)return;const r=fn(n,t,e);return Math.round(r*cs*as)},[n,t,e])}function Ye(i,e,t){const n=f.useCallback(()=>i?e(i):void 0,[i,e]),s=f.useCallback(r=>{if(!i)return()=>{};const o=t(i,r);return()=>N(o)},[i,t]);return f.useSyncExternalStore(s,n)}const ct=0,ie=1,lt=[0,0,0,0],q=[],Ae={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ne extends Ct{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class _s extends mn{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:pn,this.defaultDeleteCondition_=function(n){return yn(n)&&St(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:_n,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new vn,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new ee({source:new Pe({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Ss(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new _e(this.source_.getFeatures()),this.source_.addEventListener(Ze.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ze.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(K.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(K.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(Qe.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new _e;const n=this.featuresBeingModified_.getArray();for(let s=0,r=t.length;s<r;++s){const o=t[s];for(let a=0,c=o.length;a<c;++a){const l=o[a].feature;l&&!n.includes(l)&&this.featuresBeingModified_.push(l)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ne(Ae.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Qe.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(s){e===s.feature&&n.push(s)});for(let s=n.length-1;s>=0;--s){const r=n[s];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),s={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s],a={feature:e,geometry:t,depth:[s],index:s,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length-1;s<r;++s){const o=n.slice(s,s+2),a={feature:e,geometry:t,index:s,segment:o};this.rBush_.insert(R(o),a)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,c=o.length-1;a<c;++a){const l=o.slice(a,a+2),u={feature:e,geometry:t,depth:[s],index:a,segment:l};this.rBush_.insert(R(l),u)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,c=o.length-1;a<c;++a){const l=o.slice(a,a+2),u={feature:e,geometry:t,depth:[s],index:a,segment:l};this.rBush_.insert(R(l),u)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,c=o.length;a<c;++a){const l=o[a];for(let u=0,h=l.length-1;u<h;++u){const m=l.slice(u,u+2),g={feature:e,geometry:t,depth:[a,s],index:u,segment:m};this.rBush_.insert(R(m),g)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),s={feature:e,geometry:t,index:ct,segment:[n,n]},r={feature:e,geometry:t,index:ie,segment:[n,n]},o=[s,r];s.featureSegments=o,r.featureSegments=o,this.rBush_.insert(ke(n),s);let a=t;this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let s=0;s<n.length;++s){const r=n[s],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,n){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new Z(new ve(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",n),s}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==me.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=me.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==me.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],s=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],c=a[0],l=c.feature;n.includes(l)||n.push(l);const u=c.geometry;s.includes(u)||s.push(u);const h=c.depth;let m;const g=c.segment,p=a[1];for(;t.length<u.getStride();)t.push(g[p][t.length]);switch(u.getType()){case"Point":m=t,g[0]=t,g[1]=t;break;case"MultiPoint":m=u.getCoordinates(),m[c.index]=t,g[0]=t,g[1]=t;break;case"LineString":m=u.getCoordinates(),m[c.index+p]=t,g[p]=t;break;case"MultiLineString":m=u.getCoordinates(),m[h[0]][c.index+p]=t,g[p]=t;break;case"Polygon":m=u.getCoordinates(),m[h[0]][c.index+p]=t,g[p]=t;break;case"MultiPolygon":m=u.getCoordinates(),m[h[1]][h[0]][c.index+p]=t,g[p]=t;break;case"Circle":if(g[0]=t,g[1]=t,c.index===ct)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let v=et(A(u.getCenter()),A(t));u.setRadius(v),this.changingFeature_=!1}break}m&&this.setGeometryCoordinates_(u,m)}this.createOrUpdateVertexFeature_(t,n,s)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(n){e.map.getView().getProjection();const s=[],r=n.getGeometry().getCoordinates(),o=R([r]),a=this.rBush_.getInExtent(o),c={};a.sort(vs);for(let l=0,u=a.length;l<u;++l){const h=a[l],m=h.segment;let g=F(h.geometry);const p=h.depth;if(p&&(g+="-"+p.join("-")),c[g]||(c[g]=new Array(2)),h.geometry.getType()==="Circle"&&h.index===ie){const v=dt(t,h);U(v,r)&&!c[g][0]&&(this.dragSegments_.push([h,0]),c[g][0]=h);continue}if(U(m[0],r)&&!c[g][0]){this.dragSegments_.push([h,0]),c[g][0]=h;continue}if(U(m[1],r)&&!c[g][1]){if(c[g][0]&&c[g][0].index===0){let v=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":v=v[p[1]];case"Polygon":if(h.index!==v[p[0]].length-2)continue;break}}this.dragSegments_.push([h,1]),c[g][1]=h;continue}F(m)in this.vertexSegments_&&!c[g][0]&&!c[g][1]&&this.insertVertexCondition_(e)&&s.push(h)}s.length&&this.willModifyFeatures_(e,[s]);for(let l=s.length-1;l>=0;--l)this.insertVertex_(s[l],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],s=n.geometry;if(s.getType()==="Circle"){const r=s.getCenter(),o=n.featureSegments[0],a=n.featureSegments[1];o.segment[0]=r,o.segment[1]=r,a.segment[0]=r,a.segment[1]=r,this.rBush_.update(ke(r),o);let c=s;this.rBush_.update(c.getExtent(),a)}else this.rBush_.update(R(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ne(Ae.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,n){const s=n||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(c,l){return ut(s,c)-ut(s,l)};let o,a;if(this.hitDetection_){const c=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(l,u,h)=>{h&&h.getType()==="Point"&&(h=new ve(je(h.getCoordinates())));const m=h||l.getGeometry();if(l instanceof Z&&this.features_.getArray().includes(l)){a=m;const g=l.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:l,geometry:a,segment:[g,g]}]}return!0},{layerFilter:c})}if(!o){const c=Sn(ke(s,lt)),l=t.getView().getResolution()*this.pixelTolerance_,u=xn(Cn(c,l,lt));o=this.rBush_.getInExtent(u)}if(o&&o.length>0){const c=o.sort(r)[0],l=c.segment;let u=dt(s,c);const h=t.getPixelFromCoordinate(u);let m=et(e,h);if(a||m<=this.pixelTolerance_){const g={};if(g[F(l)]=!0,this.snapToPointer_||(this.delta_[0]=u[0]-s[0],this.delta_[1]=u[1]-s[1]),c.geometry.getType()==="Circle"&&c.index===ie)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(u,[c.feature],[c.geometry]);else{const p=t.getPixelFromCoordinate(l[0]),v=t.getPixelFromCoordinate(l[1]),S=Re(h,p),M=Re(h,v);m=Math.sqrt(Math.min(S,M)),this.snappedToVertex_=m<=this.pixelTolerance_,this.snappedToVertex_&&(u=S>M?l[1]:l[0]),this.createOrUpdateVertexFeature_(u,[c.feature],[c.geometry]);const j={};j[F(c.geometry)]=!0;for(let I=1,w=o.length;I<w;++I){const E=o[I].segment;if(U(l[0],E[0])&&U(l[1],E[1])||U(l[0],E[1])&&U(l[1],E[0])){const P=F(o[I].geometry);P in j||(j[P]=!0,g[F(E)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,s=e.feature,r=e.geometry,o=e.depth,a=e.index;let c;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":c=r.getCoordinates(),c[o[0]].splice(a+1,0,t);break;case"Polygon":c=r.getCoordinates(),c[o[0]].splice(a+1,0,t);break;case"MultiPolygon":c=r.getCoordinates(),c[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":c=r.getCoordinates(),c.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(r,c);const l=this.rBush_;l.remove(e),this.updateSegmentIndices_(r,a,o,1);const u={segment:[n[0],t],feature:s,geometry:r,depth:o,index:a};l.insert(R(u.segment),u),this.dragSegments_.push([u,1]);const h={segment:[t,n[1]],feature:s,geometry:r,depth:o,index:a+1};l.insert(R(h.segment),h),this.dragSegments_.push([h,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=me.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ne(Ae.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let n=!1,s,r,o,a,c,l,u,h,m,g,p;for(c=e.length-1;c>=0;--c)o=e[c],g=o[0],p=F(g.feature),g.depth&&(p+="-"+g.depth.join("-")),p in t||(t[p]={}),o[1]===0?(t[p].right=g,t[p].index=g.index):o[1]==1&&(t[p].left=g,t[p].index=g.index+1);for(p in t){switch(m=t[p].right,u=t[p].left,l=t[p].index,h=l-1,u!==void 0?g=u:g=m,h<0&&(h=0),a=g.geometry,r=a.getCoordinates(),s=r,n=!1,a.getType()){case"MultiLineString":r[g.depth[0]].length>2&&(r[g.depth[0]].splice(l,1),n=!0);break;case"LineString":r.length>2&&(r.splice(l,1),n=!0);break;case"MultiPolygon":s=s[g.depth[1]];case"Polygon":s=s[g.depth[0]],s.length>4&&(l==s.length-1&&(l=0),s.splice(l,1),n=!0,l===0&&(s.pop(),s.push(s[0]),h=s.length-1));break}if(n){this.setGeometryCoordinates_(a,r);const v=[];if(u!==void 0&&(this.rBush_.remove(u),v.push(u.segment[0])),m!==void 0&&(this.rBush_.remove(m),v.push(m.segment[1])),u!==void 0&&m!==void 0){const S={depth:g.depth,feature:g.feature,geometry:g.geometry,index:h,segment:v};this.rBush_.insert(R(S.segment),S)}this.updateSegmentIndices_(a,l,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,s){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(n===void 0||r.depth===void 0||wn(r.depth,n))&&r.index>t&&(r.index+=s)})}}function vs(i,e){return i.index-e.index}function ut(i,e,t){const n=e.geometry;if(n.getType()==="Circle"){let r=n;if(e.index===ie){const o=Re(r.getCenter(),A(i)),a=Math.sqrt(o)-r.getRadius();return a*a}}const s=A(i);return q[0]=A(e.segment[0]),q[1]=A(e.segment[1]),En(s,q)}function dt(i,e,t){const n=e.geometry;if(n.getType()==="Circle"&&e.index===ie)return je(n.getClosestPoint(A(i)));const s=A(i);return q[0]=A(e.segment[0]),q[1]=A(e.segment[1]),je(bn(s,q))}function Ss(){const i=xt();return function(e,t){return i.Point}}const xs={SELECT:"select"};class Cs extends Ct{constructor(e,t,n,s){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=s}}const pe={};class Vt extends Mn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:St,this.addCondition_=e.addCondition?e.addCondition:tt,this.removeCondition_=e.removeCondition?e.removeCondition:tt,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Pn,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:nt,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:ws(),this.features_=e.features||new _e;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(s){return n.includes(s)}}else t=nt;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[F(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[F(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(K.ADD,this.boundAddFeature_),this.features_.addEventListener(K.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(K.ADD,this.boundAddFeature_),this.features_.removeEventListener(K.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.getMap().getAllLayers().find(function(s){if(s instanceof ee&&s.getSource()&&s.getSource().hasFeature(t))return s});n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=F(e);t in pe||(pe[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let s=t.length-1;s>=0;--s){const r=t[s];if(r!==this&&r instanceof Vt&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const n=F(e);e.setStyle(pe[n]),delete pe[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[F(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),s=this.toggleCondition_(e),r=!t&&!n&&!s,o=e.map,a=this.getFeatures(),c=[],l=[];if(r){Fn(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,(u,h)=>{if(!(!(u instanceof Z)||!this.filter_(u,h)))return this.addFeatureLayerAssociation_(u,h),l.push(u),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=a.getLength()-1;u>=0;--u){const h=a.item(u),m=l.indexOf(h);m>-1?l.splice(m,1):(a.remove(h),c.push(h))}l.length!==0&&a.extend(l)}else{o.forEachFeatureAtPixel(e.pixel,(u,h)=>{if(!(!(u instanceof Z)||!this.filter_(u,h)))return(t||s)&&!a.getArray().includes(u)?(this.addFeatureLayerAssociation_(u,h),l.push(u)):(n||s)&&a.getArray().includes(u)&&(c.push(u),this.removeFeatureLayerAssociation_(u)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=c.length-1;u>=0;--u)a.remove(c[u]);a.extend(l)}return(l.length>0||c.length>0)&&this.dispatchEvent(new Cs(xs.SELECT,l,c,e)),!0}}function ws(){const i=xt();return st(i.Polygon,i.LineString),st(i.GeometryCollection,i.LineString),function(e){return e.getGeometry()?i[e.getGeometry().getType()]:null}}async function bs(i,e,t,n){const r=n.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),o=await i.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${r}>`}});if(!o||!o.ok||o.status!==201)throw new Error("Request failed: "+o.status);const a=o.headers.get("location");if(!a)throw new Error("Request failed: no Location response header");const c=a.substring(a.lastIndexOf("/")+1);return Promise.resolve(c)}async function Es(i,e,t,n,s){const o=s.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),a=new URL(`${e.toString()}/${t}`),c=await i.fetch(a,{method:"PATCH",body:JSON.stringify({type:"Feature",properties:{},geometry:n}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${o}>`}});if(!c||!c.ok||c.status!==204)throw new Error("Request failed: "+c.status);return Promise.resolve(t)}function Ht(i,e){const t=document.createElement("div");t.className="editing-tooltip editing-tooltip-hidden",t.role="tooltip";const n=document.createElement("span");n.textContent=e,t.appendChild(n);const s=new Le({element:t,offset:[15,0],positioning:"center-left"}),r=i.on("pointermove",o=>{o.dragging||s.setPosition(o.coordinate)});return i.addOverlay(s),{destroy(){N(r),i.removeOverlay(s)},setVisible(o){t.classList.toggle("editing-tooltip-hidden",!o)},setText(o){n.textContent=o}}}function $t(i){let e=ht(i.polygon);Array.isArray(e)&&(e=e[0]);let t=ht(i.vertex);Array.isArray(t)&&(t=t[0]);const n=[];return e&&n.push(e),t&&(t.setGeometry(Ms),n.push(t)),n}const Ms=i=>{if(i){const e=i.getGeometry();if(e&&e.getType()==="Polygon"){const t=e.getCoordinates()[0];if(t)return new qn(t)}}},ht=i=>{const e=new Z,n=new ee({style:i}).getStyleFunction();if(!n)throw new Error("can't retrieve style function");const s=n(e,1);if(!s)throw new Error("can't retrieve styles from feature style function");return Array.isArray(s)&&s.length?s.length>1?s:s[0]:s},Ps=ge("editing:EditingCreateWorkflowImpl");var D;class Fs extends Be{constructor(t){super();x(this,D);y(this,"_httpService");y(this,"_intl");y(this,"_map");y(this,"_polygonStyle");y(this,"_vertexStyle");y(this,"_state");y(this,"_editLayerURL");y(this,"_featureId");y(this,"_editingSource");y(this,"_editingLayer");y(this,"_drawInteraction");y(this,"_olMap");y(this,"_mapContainer");y(this,"_tooltip");y(this,"_enterHandler");y(this,"_escapeHandler");y(this,"_error");y(this,"_interactionListener");y(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonStyle=t.polygonStyle,this._vertexStyle=t.vertexStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._editingSource=new Pe,this._editingLayer=new ee({source:this._editingSource,zIndex:Ue,properties:{name:"editing-layer"}}),this._drawInteraction=new At({source:this._editingSource,type:"Polygon",style:$t({polygon:this._polygonStyle,vertex:this._vertexStyle})}),this._tooltip=Ht(this._olMap,this._intl.formatMessage({id:"create.tooltip.begin"})),this._enterHandler=n=>{if((n.code==="Enter"||n.code==="NumpadEnter")&&n.target===this._olMap.getTargetElement()){const s=this._drawInteraction.getOverlay().getSource()?.getFeatures()??[];s[0]&&s[0].getGeometry().getCoordinates()[0].length>4&&this.triggerSave()}},this._escapeHandler=n=>{n.code==="Escape"&&n.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_save(t){this._setState("active:saving");const n=this._editLayerURL,s=t.getGeometry();if(!s){this._destroy(),this._error=new Error("no geometry available"),_(this,D)?.reject(this._error);return}const r=this._olMap.getView().getProjection(),a=new Tt({dataProjection:r}).writeGeometryObject(s,{rightHanded:!0,decimals:10});bs(this._httpService,n,a,r).then(c=>{this._featureId=c,this._destroy(),_(this,D)?.resolve({featureId:this._featureId})}).catch(c=>{Ps.error(c),this._destroy(),this._error=new Error("Failed to save feature",{cause:c}),_(this,D)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._drawInteraction),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.setVisible(!0);const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.continue"}))}),n=this._drawInteraction.on("drawend",r=>{const o=r.feature;if(!o){this._destroy(),this._error=new Error("no feature available"),_(this,D)?.reject(this._error);return}this._save(o)}),s=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(t,n),this._mapListener.push(s)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.begin"})),this._setState("active:initialized")}stop(){this._destroy(),_(this,D)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{N(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._setState("destroyed")}triggerSave(){this._drawInteraction.finishDrawing()}whenComplete(){return this._state==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(_(this,D)??C(this,D,Pt())).promise}}D=new WeakMap;var T;class Ls extends Be{constructor(t){super();x(this,T);y(this,"_httpService");y(this,"_intl");y(this,"_map");y(this,"_polygonStyle");y(this,"_vertexStyle");y(this,"_state");y(this,"_editLayerURL");y(this,"_featureId");y(this,"_initialFeature");y(this,"_editFeature");y(this,"_editingSource");y(this,"_editingLayer");y(this,"_modifyInteraction");y(this,"_olMap");y(this,"_mapContainer");y(this,"_tooltip");y(this,"_enterHandler");y(this,"_escapeHandler");y(this,"_error");y(this,"_interactionListener");y(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonStyle=t.polygonStyle,this._vertexStyle=t.vertexStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._initialFeature=t.feature.clone(),this._initialFeature.setId(t.feature.getId()),this._editFeature=t.feature.clone(),this._editFeature.setId(t.feature.getId()),this._editFeature.setStyle($t({polygon:this._polygonStyle,vertex:this._vertexStyle})),this._editingSource=new Pe({features:new _e([this._editFeature])}),this._editingLayer=new ee({source:this._editingSource,zIndex:Ue,properties:{name:"editing-layer"}}),this._modifyInteraction=new _s({source:this._editingSource}),this._tooltip=Ht(this._olMap,this._intl.formatMessage({id:"create.tooltip.deselect"})),this._enterHandler=n=>{if((n.code==="Enter"||n.code==="NumpadEnter")&&n.target===this._olMap.getTargetElement()){const s=this._editingSource.getFeatures()[0];if(!s)throw Error("no updated feature found");this._save(s)}},this._escapeHandler=n=>{n.code==="Escape"&&n.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getModifyInteraction(){return this._modifyInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_save(t){this._setState("active:saving");const n=this._editLayerURL;if(this._featureId=t.getId()?.toString(),!this._featureId){this._destroy(),this._error=new Error("no feature id available"),_(this,T)?.reject(this._error);return}const s=t?.getGeometry();if(!s){this._destroy(),this._error=new Error("no geometry available"),_(this,T)?.reject(this._error);return}const r=this._olMap.getView().getProjection(),a=new Tt({dataProjection:r}).writeGeometryObject(s,{rightHanded:!0,decimals:10});Es(this._httpService,n,this._featureId,a,r).then(c=>{this._destroy(),_(this,T)?.resolve({featureId:c})}).catch(c=>{this._destroy(),this._error=new Error("Failed to save feature",{cause:c}),_(this,T)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._modifyInteraction);const t=this._editingSource.getFeatures()[0];if(t&&!t.getId()?.toString()){this._destroy(),this._error=new Error("no feature id available"),_(this,T)?.reject(this._error);return}this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.setVisible(!0);const n=this._map.olMap.on("click",o=>{const a=o.coordinate,c=o.originalEvent.altKey,l=this._editingSource.getFeaturesAtCoordinate(a);c||l.length===0&&this.triggerSave()}),s=this._modifyInteraction.on("modifystart",()=>{this._setState("active:drawing")}),r=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(n,s),this._mapListener.push(r)}reset(){const t=this._initialFeature.getGeometry()?.clone(),n=this._editingSource.getFeatures()[0];if(!n)throw Error("no updated feature found");n.setGeometry(t),this._setState("active:initialized")}stop(){this._destroy(),_(this,T)?.resolve(void 0)}_destroy(){this._editingSource.clear(),this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{N(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._setState("destroyed")}triggerSave(){const t=this._editingSource.getFeatures()[0];if(!t)throw Error("no updated feature found");this._save(t)}whenComplete(){return this._state==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(_(this,T)??C(this,T,Pt())).promise}}T=new WeakMap;class mr{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}createFeature(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const n=e.id;let s=this._workflows.get(n);if(s)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return s=new Fs({map:e,ogcApiFeatureLayerUrl:t,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(n,s),this._connectToWorkflowDestroyEvent(s,n),s}updateFeature(e,t,n){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const s=e.id;let r=this._workflows.get(s);if(r)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return r=new Ls({map:e,ogcApiFeatureLayerUrl:t,feature:n,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(s,r),this._connectToWorkflowDestroyEvent(r,s),r}stop(e){const t=this._workflows.get(e);t&&t.stop()}reset(e){const t=this._workflows.get(e);if(t)t.reset();else throw new Error("No workflow found for mapId: "+e)}_connectToWorkflowDestroyEvent(e,t){e.on("destroyed",()=>{this._workflows.get(t)===e&&this._workflows.delete(t)})}}new ve([407354,5754673]),new ve([404740,5757893]);var W,V,re,oe,ae,He;class Is extends Be{constructor(t,n,s){super();x(this,ae);y(this,"label");x(this,W,{kind:"available"});x(this,V);x(this,re);x(this,oe);this.label=n,C(this,V,t),C(this,oe,s),te(this,ae,He).call(this),C(this,re,_(this,V).on("change:visible",()=>{te(this,ae,He).call(this)}))}destroy(){N(_(this,re))}get status(){return _(this,W)}async select(t,n){if(t.type!=="extent")throw new Error(`Unsupported selection kind: ${t.type}`);if(_(this,W).kind!=="available"||_(this,V).getSource()===null)return[];const s=[];_(this,V).getSource().forEachFeatureIntersectingExtent(t.extent,a=>{if(!a.getGeometry())return;const c={...a.getProperties()};delete c.geometries;const l={id:a.getId()?.toString()||Ln(),geometry:a.getGeometry(),properties:c};s.push(l)});const r=s.filter(a=>a!=null);return r.length>n.maxResults?r.slice(0,n.maxResults):r}}W=new WeakMap,V=new WeakMap,re=new WeakMap,oe=new WeakMap,ae=new WeakSet,He=function(){const n=_(this,V).getVisible()?{kind:"available"}:{kind:"unavailable",reason:_(this,oe)};n.kind!==_(this,W).kind&&(C(this,W,n),this.emit("changed:status"))};var ce;class pr{constructor({intl:e}){x(this,ce);C(this,ce,e)}createSelectionSource(e){return new Is(e.vectorLayer,e.label,_(this,ce).formatMessage({id:"layerNotVisibleReason"}))}}ce=new WeakMap;function Ts(i,e,t){const n=f.useContext(Hn);return f.useMemo(()=>ks("useService",n).getService(i,e,t??{}),[n,i,e,t])}function ks(i,e){if(!e)throw new $n(Bn.INTERNAL,`"Failed to access package context from '${i}': react integration was not set up properly.`);return e}const As="@open-pioneer/notifier",Ns=Ts.bind(void 0,As);var Bt=Nt({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),Os=Nt({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const js=!1;function yr(i){const{position:e="top-right"}=i,t=ss(),n=Ns("notifier.NotificationService"),[s,r]=f.useState(!js),o=H(c=>{const l=c.level==="error"?d.jsx(Bt,{h:"100%",w:"100%"}):void 0;t({position:e,title:c.title,description:c.message||null,status:c.level,isClosable:!0,duration:c.displayDuration??null,icon:l})}),a=H(()=>{t.closeAll()});return f.useEffect(()=>{const c=n.registerHandler({showNotification:o,closeAll:a});return()=>c.destroy()},[s,n,o,a]),d.jsx(d.Fragment,{})}const Rs="@open-pioneer/coordinate-viewer",Ds=z.bind(void 0,Rs),Gs=4,Vs="decimal",_r=i=>{const{mapId:e,precision:t,displayProjectionCode:n,format:s}=i,{containerProps:r}=$("coordinate-viewer",i),{map:o}=B(e),a=o?.olMap,c=Gt(a)?.getCode()??"";let{coordinates:l}=$s(a);l=l&&n?Us(l,c,n):l;const u=Hs(l,t,s),h=n||c,m=u?u+" "+h:"";return d.jsx(L,{...r,children:d.jsx(Q,{className:"coordinate-viewer-text",children:m})})};function Hs(i,e,t){const n=Ds();return i?Bs(i,e,n,t):""}function $s(i){const[e,t]=f.useState();return f.useEffect(()=>{if(!i)return;const n=i.on("pointermove",s=>{t(s.coordinate)});return()=>N(n)},[i]),{coordinates:e}}function Bs(i,e,t,n){if(i[0]==null||i[1]==null)return"";const s=e??Gs,r=n??Vs,[o,a]=i;let c;if(r==="degree"&&isFinite(o)&&isFinite(a)){const[l,u,h]=gt(o,t,s),[m,g,p]=gt(a,t,s),v=`${Math.abs(l)}°${u}'${h}"${0<=l?"(E)":"(W)"}`,S=`${Math.abs(m)}°${g}'${p}"${0<=m?"(N)":"(S)"}`;c=v+" "+S}else{const l=t.formatNumber(o,{maximumFractionDigits:s,minimumFractionDigits:s}),u=t.formatNumber(a,{maximumFractionDigits:s,minimumFractionDigits:s});c=l+" "+u}return c}function gt(i,e,t){const n=Math.floor(i),s=i-n,r=Math.floor(60*s),a=60*(60*s-r),c=e.formatNumber(a,{maximumFractionDigits:t,minimumFractionDigits:t});return[n,r,c]}function Us(i,e,t){return In(i,e,t)}const vr=i=>{const{mapId:e,displayMode:t="line"}=i,{containerProps:n}=$("scale-bar",i),{map:s}=B(e),r=f.useRef(null);return f.useEffect(()=>{if(r.current&&s){const o=s.olMap,a=new Yn({units:"metric",target:r.current,bar:t==="bar"});return o.addControl(a),()=>{o.removeControl(a)}}},[t,s]),d.jsx(L,{...n,ref:r})},Ws="@open-pioneer/scale-viewer",zs=z.bind(void 0,Ws),Sr=i=>{const{mapId:e}=i,{containerProps:t}=$("scale-viewer",i),{map:n}=B(e),s=zs(),r=ys(n?.olMap),o=r?s.formatNumber(r):void 0;return d.jsx(L,{...t,children:o&&d.jsxs(Q,{children:["1:",o]})})},Ks="@open-pioneer/legend",Ut=z.bind(void 0,Ks),xr=i=>{const{mapId:e,showBaseLayers:t=!1}=i,{containerProps:n}=$("legend",i),{map:s}=B(e);return d.jsx(L,{...n,children:s?d.jsx(qs,{map:s,showBaseLayers:t}):null})};function qs(i){const{map:e,showBaseLayers:t}=i,s=Xs(e).map(r=>d.jsx(Wt,{layer:r,showBaseLayers:t},r.id));return d.jsx(Qn,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:s})}function Wt(i){const{layer:e,showBaseLayers:t}=i,{isVisible:n}=Qs(e),s=Zs(e);if(!n||!t&&kt(e)&&e.isBaseLayer)return;const r=[];return s?.length&&s.forEach(o=>{r.push(d.jsx(Wt,{layer:o,showBaseLayers:t},o.id))}),d.jsxs(d.Fragment,{children:[d.jsx(Ys,{layer:e,showBaseLayers:t}),r]})}function Ys(i){const e=Ut(),{layer:t,showBaseLayers:n}=i,s=ei(t),r=Js(t);let o;s?.Component?o=d.jsx(s.Component,{layer:t}):s?.imageUrl?o=d.jsx(ft,{layer:t,imageUrl:s.imageUrl}):r&&(o=d.jsx(ft,{layer:t,imageUrl:r}));const a=kt(t)&&t.isBaseLayer;return o?d.jsxs(L,{as:"li",className:Fe("legend-item",`layer-${ti(t.id)}`),children:[n&&a?d.jsx(Q,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,o]}):void 0}function ft(i){const e=Ut(),{layer:t,imageUrl:n}=i;return d.jsxs(L,{children:[d.jsx(Q,{children:t.title}),d.jsx(Jn,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:d.jsx(L,{children:d.jsxs(Q,{children:[d.jsx(Bt,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function Js(i){const e=f.useCallback(()=>i.legend,[i]),t=f.useCallback(n=>{const s=i.on("changed:legend",n);return()=>s.destroy()},[i]);return f.useSyncExternalStore(t,e)}function Xs(i){const e=f.useCallback(n=>{const s=i.layers.on("changed",n);return()=>s.destroy()},[i]),t=f.useCallback(()=>{let n=i.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[i]);return zt(e,t)}function Zs(i){const e=f.useCallback(n=>{const s=i.sublayers?.on("changed",n);return()=>s?.destroy()},[i]),t=f.useCallback(()=>{if(!i.sublayers)return;let s=i.sublayers?.getSublayers({sortByDisplayOrder:!0});return s=s.reverse(),s},[i]);return zt(e,t)}function zt(i,e){const t=f.useRef(),n=f.useCallback(r=>{const o=i(()=>{t.current=void 0,r()});return()=>{t.current=void 0,o()}},[i]),s=f.useCallback(()=>{if(t.current)return t.current.value;const r=e();return t.current={value:r},r},[e]);return f.useSyncExternalStore(n,s)}function Qs(i){const e=f.useCallback(()=>i.visible,[i]),t=f.useCallback(s=>{const r=i.on("changed:visible",s);return()=>r.destroy()},[i]);return{isVisible:f.useSyncExternalStore(t,e)}}function ei(i){const[e,t]=f.useState(void 0);return f.useEffect(()=>{t(i.attributes.legend);const n=i.on("changed:attributes",()=>{t(i.attributes.legend)});return()=>n.destroy()},[i]),e}function ti(i){return i.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const ni="@open-pioneer/measurement",si=z.bind(void 0,ni);class ii{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;activeMeasurement;predefinedMeasurements=new Map;finishedMeasurements=new Set;helpTooltip;resources=[];measurementChangedHandler;constructor(e,t){this.olMap=e,this.messages=t;const n=this.source=new Pe;this.layer=new ee({source:n,zIndex:Ue,properties:{name:"measurement-layer"}}),e.addLayer(this.layer);const s=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){N(s)}});const r=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",r),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",r)}}),this.helpTooltip=oi(this.olMap)}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.activeMeasurement=at(this.activeMeasurement);for(const e of this.finishedMeasurements)e.destroy();this.finishedMeasurements.clear(),this.helpTooltip.destroy(),this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose(),this.measurementChangedHandler=void 0,this.predefinedMeasurements.clear()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setMeasurementSourceChangedHandler(e){this.measurementChangedHandler=e}setPredefinedMeasurements(e){this.updatePredefinedMeasurements(e)}setActiveFeatureStyle(e){const t=Tn(e);this.activeFeatureStyle=(n,...s)=>{const r=n?.getGeometry()?.getType();if(r==="Polygon"||r==="LineString"||r==="Point")return t(n,...s)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){const e=this.source.getFeatures();this.source.clear(),e.forEach(t=>{this.raiseMeasurementsChangeEvent("remove-measurement",t)}),this.predefinedMeasurements.clear();for(const t of this.finishedMeasurements)t.destroy();this.finishedMeasurements.clear()}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",n=this.draw=new At({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let s,r;n.on("drawstart",o=>{const a=o.feature;a&&(s=this.activeMeasurement=new mt("active",a,this),r=a.getGeometry()?.on("change",()=>{s?.updateTooltipContent(),s?.updateTooltipPosition()}))}),n.on("drawend",()=>{if(s&&s===this.activeMeasurement){const o=s;o.updateState("finished"),this.finishedMeasurements.add(o),this.raiseMeasurementsChangeEvent("add-measurement",o.feature),this.activeMeasurement=s=void 0}s=void 0,r&&N(r)}),n.on("drawabort",()=>{s&&(s.destroy(),s===this.activeMeasurement&&(this.activeMeasurement=void 0),s=void 0),r&&N(r)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.activeMeasurement=at(this.activeMeasurement)}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,n=ci(this.messages,this.activeMeasurement);t.setText(n),t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}updatePredefinedMeasurements(e){const t=e.filter(s=>!this.predefinedMeasurements.has(s)),n=[];for(const s of this.predefinedMeasurements.keys())e.includes(s)||n.push(s);t.forEach(s=>{const r=new Z(s);this.source.addFeature(r);const o=new mt("finished",r,this);this.finishedMeasurements.add(o),this.predefinedMeasurements.set(s,o),this.raiseMeasurementsChangeEvent("add-measurement",r)}),n.forEach(s=>{const r=this.predefinedMeasurements.get(s);r&&(this.source.removeFeature(r.feature),this.finishedMeasurements.delete(r),r.destroy(),this.raiseMeasurementsChangeEvent("remove-measurement",r.feature)),this.predefinedMeasurements.delete(s)})}raiseMeasurementsChangeEvent(e,t){const n=t.getGeometry();this.measurementChangedHandler&&n&&this.measurementChangedHandler({kind:e,geometry:(n instanceof Se,n)})}}class mt{controller;feature;_state;tooltip;constructor(e,t,n){this.controller=n,this._state=e,this.feature=t,this.tooltip=ai(this.olMap),this.updateTooltipContent(),this.updateTooltipPosition(),this.tooltip.setActive(e==="active")}destroy(){this.tooltip.destroy()}get state(){return this._state}updateState(e){this._state!==e&&(this._state=e,this.tooltip.setActive(e==="active"))}updateTooltipContent(){const e=this.feature.getGeometry();if(!e)return;const t=this.olMap.getView().getProjection();let n;e instanceof Se?n=li(e,t,this.messages):e instanceof Ge&&(n=ui(e,t,this.messages)),n&&this.tooltip.setHtml(n)}updateTooltipPosition(){const e=this.feature.getGeometry();if(!e)return;let t;if(e instanceof Se)t=e.getInteriorPoint().getCoordinates()||null;else if(e instanceof Ge)t=e.getLastCoordinate()||null;else return;this.tooltip.overlay.setPosition(t)}get olMap(){return this.controller.olMap}get messages(){return this.controller.messages}}const pt=[0,-15],ri=[0,-7];function oi(i){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const n=new Le({element:e,offset:[15,0],positioning:"center-left"});return i.addOverlay(n),{overlay:n,element:e,destroy(){i.removeOverlay(n)},setText(s){t.textContent=s},setHtml(s){t.innerHTML=s}}}function ai(i){const e=document.createElement("div");e.role="tooltip",e.className="measurement-tooltip measurement-active-tooltip printing-hide";const t=document.createElement("span");e.appendChild(t);const n=new Le({element:e,offset:pt,positioning:"bottom-center",stopEvent:!1,insertFirst:!1});return i.addOverlay(n),{overlay:n,element:e,destroy(){i.removeOverlay(n)},setActive(s){s?(e.className="measurement-tooltip measurement-active-tooltip printing-hide",n.setOffset(pt)):(e.className="measurement-tooltip measurement-finished-tooltip",n.setOffset(ri))},setText(s){t.textContent=s},setHtml(s){t.innerHTML=s}}}function ci(i,e){if(e){const t=e.feature.getGeometry();if(t instanceof Se||t instanceof Ge)return i.getContinueMessage()}return i.getHelpMessage()}function li(i,e,t){const n=kn(i,{projection:e});let s;return n>=1e6?s=`${t.formatNumber(n/1e6)} km<sup>2</sup>`:s=`${t.formatNumber(n)} m<sup>2</sup>`,s}function ui(i,e,t){const n=An(i,{projection:e});let s;return n>=1e3?s=`${t.formatNumber(n/1e3)} km`:s=`${t.formatNumber(n)} m`,s}const Cr=i=>{const e=si(),{mapId:t}=i,{containerProps:n}=$("measurement",i),[s,r]=f.useState("distance"),o=h=>e.formatMessage({id:h}),a=B(t),c=di(a.map,i,e);f.useEffect(()=>{if(c)return c.startMeasurement(s),()=>{c.stopMeasurement()}},[c,s]);function l(h){if(h==="distance"||h==="area")r(h);else throw new Error(`Unexpected measurement type: '${h}'.`)}function u(){c?.clearMeasurements()}return d.jsxs(L,{...n,children:[d.jsx(Q,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),d.jsx(Ce,{mb:4,alignItems:"center",children:d.jsxs(Ve,{mb:2,children:[d.jsx(we,{mb:1,children:o("measurementLabel")}),d.jsxs(Ke,{value:s,onChange:h=>l(h.target.value),className:"measurement-select",children:[d.jsx("option",{value:"distance",children:o("distance")}),d.jsx("option",{value:"area",children:o("area")})]})]})}),d.jsx(Ft,{padding:2,className:"measurement-delete-button",onClick:u,width:"100%",children:o("deleteMeasurementLabel")})]})};function di(i,e,t){const{activeFeatureStyle:n,finishedFeatureStyle:s,onMeasurementsChange:r,predefinedMeasurements:o}=e,[a,c]=f.useState(void 0);return f.useEffect(()=>{if(!i)return;const l=new ii(i.olMap,{getContinueMessage(){return t.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return t.formatMessage({id:"tooltips.help"})},formatNumber(u){return t.formatNumber(u,{maximumFractionDigits:2})}});return c(l),()=>{l.destroy(),c(void 0)}},[i,t]),f.useEffect(()=>{a?.setActiveFeatureStyle(n??hi())},[a,n]),f.useEffect(()=>{a?.setFinishedFeatureStyle(s??gi())},[a,s]),f.useEffect(()=>{a?.setMeasurementSourceChangedHandler(r)},[a,r]),f.useEffect(()=>{a?.setPredefinedMeasurements(o??[])},[a,o]),a}function hi(){return[new xe({stroke:new se({color:"#fff",lineDash:[10,10],width:5})}),new xe({fill:new De({color:"rgba(0,0,0,0.15)"}),stroke:new se({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new Nn({radius:5,stroke:new se({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new De({color:"rgba(255, 255, 255, 0.2)"})})})]}function gi(){return[new xe({stroke:new se({color:"#fff",width:5})}),new xe({stroke:new se({color:"#0b96fc",width:3}),fill:new De({color:"rgba(11,150,252,0.15)"})})]}const fi="@open-pioneer/search",Ie=z.bind(void 0,fi);function mi(i){const e=i.selectProps.inputValue.length>0,t={...i,className:Fe(i.className,{"search-invisible":!e})};return d.jsx(O.Menu,{...t,children:i.children})}function pi(i){const e=i.data.label,t={...i.innerProps,"aria-label":e,role:"group"};return d.jsx(O.Group,{...i,innerProps:t})}function yi(i){const t=Ie().formatMessage({id:"noOptionsText"});return d.jsx(O.NoOptionsMessage,{...i,children:d.jsx(G.span,{className:"search-no-match",children:t})})}function _i(i){const t=Ie().formatMessage({id:"loadingText"});return d.jsx(O.LoadingMessage,{...i,children:d.jsx(G.span,{className:"search-loading-text",children:t})})}function vi({children:i,...e}){const t={...e,className:Fe(e.className,"search-value-container")};return d.jsxs(O.ValueContainer,{...t,children:[!!i&&d.jsx(Os,{style:{position:"absolute",left:8}}),i]})}function Si(i){const e={...i,isHidden:!1};return d.jsx(O.Input,{...e})}function xi(i){return null}function Ci(i){return d.jsxs(O.IndicatorsContainer,{...i,children:[i.children,!i.selectProps.isLoading&&i.selectProps.inputValue&&d.jsx(wi,{selectProps:i.selectProps,clearValue:i.clearValue})]})}function wi(i){const t=Ie().formatMessage({id:"ariaLabel.clearButton"}),n=s=>{s.preventDefault(),s.stopPropagation(),i.clearValue()};return d.jsx(Un,{role:"button",size:"md",mr:1,"aria-label":t,onClick:n,onTouchEnd:n,onMouseDown:s=>s.preventDefault()})}function bi(i){return null}function Ei(i){const e=i.selectProps.inputValue,t=i.data.label,n={...i,className:Fe(i.className,"search-option")};return d.jsx(O.Option,{...n,children:d.jsx(G.div,{className:"search-option-label",children:e.trim().length>0?Mi(t,e):t})})}function Mi(i,e){const t=i.toLowerCase().indexOf(e.toLowerCase());return t>=0?d.jsxs(d.Fragment,{children:[i.substring(0,t),d.jsx(G.span,{className:"search-highlighted-match",children:i.substring(t,t+e.length)},"highlighted"),i.substring(t+e.length)]}):i}const yt=ge("search:SearchController"),_t=200,vt=5;var le,Y,J,X,k,Ee,Kt;class Pi{constructor(e,t){x(this,Ee);x(this,le);x(this,Y,[]);x(this,J,vt);x(this,X,_t);x(this,k);C(this,le,e),C(this,Y,t)}destroy(){_(this,k)?.abort(),C(this,k,void 0)}async search(e){if(_(this,k)?.abort(),C(this,k,void 0),!e)return[];const t=C(this,k,new AbortController);try{return await Fi(t.signal,_(this,X)),t.signal.aborted&&(yt.debug(`search canceled with ${e}`),Wn()),(await Promise.all(_(this,Y).map(s=>te(this,Ee,Kt).call(this,s,e,t.signal)))).filter(s=>s!=null)}finally{_(this,k)===t&&C(this,k,void 0)}}get searchTypingDelay(){return _(this,X)}set searchTypingDelay(e){C(this,X,e??_t)}get maxResultsPerSource(){return _(this,J)}set maxResultsPerSource(e){C(this,J,e??vt)}get sources(){return _(this,Y)}}le=new WeakMap,Y=new WeakMap,J=new WeakMap,X=new WeakMap,k=new WeakMap,Ee=new WeakSet,Kt=async function(e,t,n){const s=e.label,r=_(this,le).olMap.getView().getProjection();try{const o=_(this,J);let a=await e.search(t,{maxResults:o,signal:n,mapProjection:r});return a.length>o&&(a=a.slice(0,o)),{label:s,source:e,results:a}}catch(o){Lt(o)||yt.error(`search for source ${s} failed`,o);return}};async function Fi(i,e){i.aborted||await new Promise(t=>{const n=()=>{i.removeEventListener("abort",n),clearTimeout(s),t()};i.addEventListener("abort",n);const s=setTimeout(n,e)})}const be=ge("search:Search"),wr=i=>{const{mapId:e,sources:t,searchTypingDelay:n,maxResultsPerGroup:s,onSelect:r,onClear:o}=i,{containerProps:a}=$("search",i),{map:c}=B(e),l=Ie(),u=ki(t,n,s,c),{input:h,search:m,selectedOption:g,onInputChanged:p,onResultConfirmed:v}=Ai(u),S=Ti(),M=Li(l),j=Ii(),I=H((P,fe)=>{fe.action==="input-change"&&p(P)}),w=H((P,fe)=>{switch(fe.action){case"select-option":P&&(v(P),r?.({source:P.source,result:P.result}));break;case"clear":p(""),E.current?.blur(),E.current?.focus(),o?.();break;default:be.debug(`Unhandled action type '${fe.action}'.`);break}}),E=f.useRef(null);return d.jsx(L,{...a,children:d.jsx(jt,{className:"search-component",classNamePrefix:"react-select",ref:E,inputValue:h,onInputChange:I,"aria-label":l.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:M,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:S,isClearable:!0,placeholder:l.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:m.kind==="loading",options:m.kind==="ready"?m.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:j,onChange:w,value:g,menuPosition:"fixed"})})};function Li(i){return f.useMemo(()=>({onFocus:()=>"",onChange:()=>"",guidance:()=>`${i.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[i])}function Ii(){return f.useMemo(()=>({Menu:mi,Input:Si,SingleValue:xi,Option:Ei,NoOptionsMessage:yi,LoadingMessage:_i,ValueContainer:vi,IndicatorsContainer:Ci,ClearIndicator:bi,Group:pi}),[])}function Ti(){const[i,e]=It("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return f.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:i,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[i,e])}function ki(i,e,t,n){const[s,r]=f.useState(void 0);return f.useEffect(()=>{if(!n)return;const o=new Pi(n,i);return r(o),()=>{o.destroy(),r(void 0)}},[n,i]),f.useEffect(()=>{s&&(s.searchTypingDelay=e)},[s,e]),f.useEffect(()=>{s&&(s.maxResultsPerSource=t)},[s,t]),s}function Ai(i){const[e,t]=f.useReducer((a,c)=>{switch(c.kind){case"input":return{...a,query:c.query,selectedOption:null};case"select-option":return{...a,selectedOption:c.option,query:c.option.label};case"load-results":return{...a,search:{kind:"loading"}};case"accept-results":return{...a,search:{kind:"ready",results:c.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=f.useRef(),s=H(a=>{if(!i){n.current=void 0,t({kind:"accept-results",results:[]});return}be.isDebug()&&be.debug(`Starting new search for query ${JSON.stringify(a)}.`),t({kind:"load-results"});const c=n.current=Ni(i,a).then(l=>{n.current===c&&t({kind:"accept-results",results:l})})}),r=f.useCallback(a=>{t({kind:"select-option",option:a})},[]),o=f.useCallback(a=>{t({kind:"input",query:a}),s(a)},[s]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:r,onInputChanged:o}}async function Ni(i,e){let t;try{t=await i.search(e)}catch(n){Lt(n)||be.error("Search failed",n),t=[]}return Oi(t)}function Oi(i){return i.map((t,n)=>({label:t.label,options:t.results.map(s=>({value:`${n}-${s.id}`,label:s.label,source:t.source,result:s}))}))}const qt="@open-pioneer/selection",ji=wt.bind(void 0,qt),Je=z.bind(void 0,qt),ne="selection-active",ye="selection-inactive";class Ri{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,n,s){const r=this.initViewport(e);this.interactionResources.push(this.createDragBox(e,s,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources)),this.tooltip=this.createHelpTooltip(e,t),this.olMap=e,this.tooltipMessage=t,this.tooltipDisabledMessage=n}initViewport(e){const t=e.getViewport();return t.classList.add(ne),t.oncontextmenu=n=>(n.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.setText(this.tooltipMessage),t.classList.remove(ye),t.classList.add(ne),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.setText(this.tooltipDisabledMessage),t.classList.remove(ne),t.classList.add(ye),this.isActive=!1)}createDragBox(e,t,n,s){const r=new it({className:"selection-drag-box",condition:On});return e.addInteraction(r),r.on("boxend",function(){t(r.getGeometry())}),{interaction:r,destroy(){e.removeInteraction(r),s.splice(s.indexOf(this)),r.dispose(),n.classList.remove(ne),n.classList.remove(ye),n.oncontextmenu=null}}}createDrag(e,t,n){const s=function(a){return a.originalEvent.button==2},r=new rt({condition:s});return e.addInteraction(r),{interaction:r,destroy(){e.removeInteraction(r),n.splice(n.indexOf(this)),r.dispose(),t.classList.remove(ne),t.classList.remove(ye),t.oncontextmenu=null}}}createHelpTooltip(e,t){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.role="tooltip";const s=document.createElement("span");s.textContent=t,n.appendChild(s);const r=new Le({element:n,offset:[15,0],positioning:"center-left"}),o=e.on("pointermove",a=>{r.setPosition(a.coordinate)});return e.addOverlay(r),{overlay:r,element:n,destroy(){e.removeOverlay(r),r.dispose(),N(o)},setText(a){s.textContent=a}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof it)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof rt)}}const Oe=ge("selection:SelectionController"),Di=1e4;var ue,de,he,Me,Yt;class Gi{constructor(e){x(this,Me);x(this,ue);x(this,de);x(this,he);const{mapModel:t,onError:n,maxResults:s=Di}=e;C(this,ue,t),C(this,de,s),C(this,he,n)}destroy(){}async select(e,t){if(t)return await te(this,Me,Yt).call(this,e,t)}}ue=new WeakMap,de=new WeakMap,he=new WeakMap,Me=new WeakSet,Yt=async function(e,t){const n=_(this,ue).olMap.getView().getProjection();try{Oe.debug(`Starting selection on source '${e.label}'`);const s=_(this,de);let r=await e.select({type:"extent",extent:t},{maxResults:s,mapProjection:n,signal:new AbortController().signal});return r.length>s&&(r=r.slice(0,s)),Oe.debug(`Found ${r.length} results on source '${e.label}'`),{source:e,results:r}}catch(s){Oe.error(`selection from source ${e.label} failed`,s),_(this,he).call(this);return}};const Vi={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},br=i=>{const e=Je(),{mapId:t,sources:n,onSelectionComplete:s,onSelectionSourceChanged:r}=i,{containerProps:o}=$("selection",i),a=e.formatMessage({id:"sourceNotAvailable"}),[c,l]=Bi(n,r),u=Xt(c,a),h=B(t),{onExtentSelected:m}=Ui(h.map,n,c,s),g=zi(),[p,v]=f.useState(!1);Wi(h.map,e,m,u.kind==="available",!!c);const S=f.useMemo(()=>n.map(w=>({label:w.label,value:w})),[n]),M=f.useMemo(()=>S.find(E=>E.value===c)||null,[S,c]),j=H(w=>{l(w?.value)}),I=H(w=>{!p&&w.key==="Enter"&&v(!0)});return d.jsx(es,{...o,spacing:2,children:d.jsxs(Ce,{children:[d.jsx(we,{children:e.formatMessage({id:"selectSource"})}),d.jsx(jt,{className:"selection-source react-select",...Vi,options:S,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:M,onChange:j,components:{Option:Hi,SingleValue:$i},isOptionDisabled:()=>!1,getOptionLabel:w=>{const E=w.label,P=$e(w.value,a);return P.kind=="available"?E:E+" "+P.reason},ariaLiveMessages:{guidance:()=>"",onChange:w=>w.action=="select-option"||w.action=="initial-input-focus"?w.label+" "+e.formatMessage({id:"selected"}):"",onFilter:()=>"",onFocus:()=>""},chakraStyles:g,onKeyDown:I,menuIsOpen:p,onMenuOpen:()=>v(!0),onMenuClose:()=>v(!1)})]})})};function Hi(i){const{value:e}=i.data,{isAvailable:t,content:n}=Jt(e,!1);return d.jsx(O.Option,{...i,isDisabled:!t,className:"selection-source-option",children:n})}function $i(i){const{value:e}=i.data,{isAvailable:t,content:n}=Jt(e,!0),s=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return d.jsx(O.SingleValue,{...i,isDisabled:!t,className:s,children:n})}function Bi(i,e){const[t,n]=f.useState(()=>i[0]);f.useEffect(()=>{t&&!i.includes(t)&&n(void 0)},[i,t]);const s=f.useRef(void 0);return f.useEffect(()=>{t!==s.current&&(s.current=t,e?.({source:t}))},[t,e]),[t,n]}function Jt(i,e){const t=Je(),n=i?.label,s=t.formatMessage({id:"sourceNotAvailable"}),r=Xt(i,s);return{isAvailable:r.kind==="available",content:d.jsxs(ot,{direction:"row",alignItems:"center",grow:1,children:[!e&&d.jsx(ot,{grow:1,children:n}),r.kind==="unavailable"&&d.jsx(L,{ml:2,children:d.jsx(zn,{label:r.reason,placement:"right",openDelay:500,children:d.jsx(G.span,{children:d.jsx(Kn,{as:ts,color:"red",className:"warning-icon","aria-label":r.reason})})})}),e&&n]})}}function Ui(i,e,t,n){const s=ji("notifier.NotificationService"),r=Je(),[o,a]=f.useState(void 0);f.useEffect(()=>{if(!i)return;const l=new Gi({mapModel:i,onError(){s.notify({level:"error",message:r.formatMessage({id:"selectionFailed"})})}});return a(l),()=>{l.destroy()}},[i,s,e,r]);const c=H(async l=>{if(!o||!t)return;const u=await o.select(t,l.getExtent());u&&n?.(u)});return{controller:o,onExtentSelected:c}}function $e(i,e){const t=i.status??"available",n=typeof t=="string"?{kind:t}:t;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function Xt(i,e){const[t,n]=f.useState(()=>({kind:"unavailable",reason:e}));return f.useEffect(()=>{if(!i){n({kind:"unavailable",reason:e});return}n($e(i,e));const s=i.on?.("changed:status",()=>{n($e(i,e))});return()=>s?.destroy()},[i,e]),t}function Wi(i,e,t,n,s){f.useEffect(()=>{if(!i)return;const r=s?e.formatMessage({id:"disabledTooltip"}):e.formatMessage({id:"noSourceTooltip"}),o=new Ri(i.olMap,e.formatMessage({id:"tooltip"}),r,t);return o.setActive(n),()=>{o?.destroy()}},[i,e,t,n,s])}function zi(){const[i,e]=It("colors",["background_body","border"],["#ffffff","#ffffff"]);return f.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:i})}),[i,e])}const Zt="@open-pioneer/printing",Qt=wt.bind(void 0,Zt),Ki=z.bind(void 0,Zt),qi="map";class Yi{olMap;i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,t,n){this.olMap=e,this.printingService=t,this.i18n=n}destroy(){this.reset()}setViewPadding(e){this.viewPadding=e}async handleMapExport(e){if(this.olMap)try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const t=this.printMap.getCanvas();if(t)e.fileFormat=="png"?await this.exportMapInPNG(t,e):await this.exportMapInPDF(t,e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Xn(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(e){const t=e.title||"",n=e.title||qi;return{title:t,fileName:n}}async exportMapInPNG(e,t){const n=document.createElement("canvas");n.width=e.width,n.height=e.height+50,n.style.backgroundColor="#fff";const s=n.getContext("2d");if(!s)throw new Error("2d canvas rendering context not available");const{title:r,fileName:o}=this.getTitleAndFileName(t);s.fillStyle="#fff",s.fillRect(0,0,n.width,n.height),s.font="20px bold sans-serif",s.textAlign="center",s.fillStyle="#000";const a=n.width/2;s.fillText(r,a,20),s.drawImage(e,0,50);const c=document.createElement("a");c.setAttribute("download",o+".png");const l=Zn(n);if(!l)throw new Error("Failed to get image data URL");c.href=l,c.click()}async exportMapInPDF(e,t){const{jsPDF:n}=await ns(async()=>{const{jsPDF:M}=await import("./CcyxBKh9H3JI.js");return{jsPDF:M}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),s=new n({orientation:"landscape",unit:"mm",format:"a4"}),r=s.internal.pageSize.getWidth(),o=s.internal.pageSize.getHeight(),a=15,c=20,l=o-c;s.setFontSize(20);const{title:u,fileName:h}=this.getTitleAndFileName(t);s.text(u,r/2,a,{align:"center"});const m=e.width/e.height;let g=l,p=g*m;p>=r&&(p=r,g=p/m);const v=(r-p)/2,S=c+(l-g)/2;s.addImage(e,"",v,S,p,g),s.save(h+".pdf")}}const Ji=ge("printing"),Er=i=>{const e=Ki(),{mapId:t,viewPadding:n="auto"}=i,{containerProps:s}=$("printing",i),[r,o]=f.useState("pdf"),[a,c]=f.useState(""),[l,u]=f.useState(!1),h=Qt("notifier.NotificationService"),{map:m}=B(t),g=Xi(m,e,n);function p(S){(S==="png"||S==="pdf")&&o(S)}function v(){l||!g||(u(!0),g.handleMapExport({title:a,fileFormat:r}).catch(S=>{const M=e.formatMessage({id:"printingFailed"});h.notify({level:"error",message:M}),Ji.error("Failed to print the map",S)}).finally(()=>{u(!1)}))}return d.jsx(L,{...s,children:d.jsxs(L,{as:"form",m:2,alignItems:"center",onSubmit:S=>{S.preventDefault(),v()},children:[d.jsxs(Ce,{as:Ve,mb:2,children:[d.jsx(we,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),d.jsx(ze,{placeholder:e.formatMessage({id:"input.placeholder"}),value:a,onChange:S=>{c(S.target.value)},autoFocus:!0})]}),d.jsxs(Ce,{as:Ve,mb:2,children:[d.jsx(we,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),d.jsxs(Ke,{value:r,onChange:S=>p(S.target.value),className:"printing-select",children:[d.jsx("option",{value:"png",children:"PNG"}),d.jsx("option",{value:"pdf",children:"PDF"})]})]}),d.jsx(Ft,{isLoading:l,loadingText:e.formatMessage({id:"printingMap"}),disabled:l,mt:2,p:2,className:"printing-export-button",type:"submit",width:"100%",children:e.formatMessage({id:"export"})})]})})};function Xi(i,e,t){const n=Qt("printing.PrintingService"),[s,r]=f.useState(void 0);return f.useEffect(()=>{if(!i)return;const o=new Yi(i.olMap,n,{overlayText:e.formatMessage({id:"printingMap"})});return r(o),()=>{o.destroy(),r(void 0)}},[i,e,n]),f.useEffect(()=>{s?.setViewPadding(t)},[s,t]),s}export{_r as C,mr as E,ze as I,xr as L,Cr as M,yr as N,Le as O,Er as P,Vt as S,pr as V,fr as W,vr as a,Sr as b,wr as c,br as d,Ke as e,ys as u};
