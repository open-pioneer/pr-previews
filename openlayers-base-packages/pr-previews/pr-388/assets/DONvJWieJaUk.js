var H=o=>{throw TypeError(o)};var D=(o,t,e)=>t.has(o)||H("Cannot "+e);var c=(o,t,e)=>(D(o,t,"read from private field"),e?e.call(o):t.get(o)),y=(o,t,e)=>t.has(o)?H("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),h=(o,t,e,s)=>(D(o,t,"write to private field"),s?s.call(o,e):t.set(o,e),e),d=(o,t,e)=>(D(o,t,"access private method"),e);import{s as G,m as it,j as a,c as K,E as g,r as I,V as F,A as P,x as V,B as lt,t as ct,b as $}from"./CilY7FyO6Rl3.js";import{f as dt,u as mt,d as ht,w as ut,bx as kt,bC as pt,bD as ft,i as gt,aZ as bt,k as R,by as wt}from"./CSmiKdizJP8d.js";import{j as xt,k as J}from"./Dlg1VqNw_sqn.js";import{u as vt}from"./BijvRNQYcfni.js";import{I as jt}from"./CqnaKyfzTnUa.js";import{L as yt,T as It}from"./Bj7cN7qkOzIJ.js";import{S as At}from"./B3YDfXTQi5NX.js";import{G as q}from"./n4hly-pWbHU_.js";const W=G("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});W.displayName="Center";const St={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};it(function(t,e){const{axis:s="both",...r}=t;return a.jsx(G.div,{ref:e,__css:St[s],...r,position:"absolute"})});const A=K("local-storage"),Bt=0,b={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var E,p,v,N,f,n,Z,Q,T,B,tt;class oe{constructor(t){y(this,n);y(this,E);y(this,p,{});y(this,v);y(this,N);y(this,f);h(this,E,Lt(t.properties)),h(this,v,Mt()),c(this,v)&&(d(this,n,Q).call(this),h(this,N,d(this,n,tt).call(this)))}destroy(){c(this,f)&&(clearTimeout(c(this,f)),h(this,f,void 0)),c(this,v)&&d(this,n,T).call(this)}get isSupported(){return!!c(this,N)}get(t){return d(this,n,B).call(this).get(t)}set(t,e){return d(this,n,B).call(this).set(t,e)}remove(t){return d(this,n,B).call(this).remove(t)}removeAll(){return d(this,n,B).call(this).removeAll()}getNamespace(t){return d(this,n,B).call(this).getNamespace(t)}}E=new WeakMap,p=new WeakMap,v=new WeakMap,N=new WeakMap,f=new WeakMap,n=new WeakSet,Z=function(){c(this,f)&&clearTimeout(c(this,f)),h(this,f,setTimeout(()=>{h(this,f,void 0),d(this,n,T).call(this)},Bt))},Q=function(){try{const t=c(this,v);if(!t)throw new g(b.INTERNAL,"Local storage is not available.");const e=t.getItem(c(this,E));if(e==null){h(this,p,{}),d(this,n,T).call(this);return}try{const s=JSON.parse(e);if(!C(s))throw new g(b.CORRUPTED_DATA,"Persisted value should be an object.");h(this,p,s)}catch(s){A.warn("Invalid persisted data, reverting to default.",s),h(this,p,{}),d(this,n,T).call(this)}}catch(t){A.error("Failed to load from local storage",t)}},T=function(){try{const t=c(this,v);if(!t)throw new g(b.INTERNAL,"Local storage is not available.");const e=JSON.stringify(c(this,p));t.setItem(c(this,E),e)}catch(t){A.error("Failed to save to local storage",t)}},B=function(){const t=c(this,N);if(!t)throw new g(b.NOT_SUPPORTED,"Local storage is not supported by this browser.");return t},tt=function(){const t={getByPath:e=>X(Et(c(this,p),e)),setByPath:(e,s)=>{if(!Ct(s))throw new g(b.INVALID_VALUE,"The value is not supported by local storage.");if(s=X(s),e.length===0){if(!C(s))throw new g(b.INVALID_VALUE,"The root value must be a plain object.");h(this,p,s)}else Nt(c(this,p),e,s);d(this,n,Z).call(this)}};return new _([],t)};class _{path;access;constructor(t,e){this.path=t,this.access=e}get(t){return this.access.getByPath([...this.path,t])}set(t,e){this.access.setByPath([...this.path,t],e)}remove(t){this.access.setByPath([...this.path,t],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(t){const e=this.get(t);if(e===void 0)this.set(t,{});else if(!C(e))throw new g(b.INVALID_PATH,`Cannot use '${t}' as a namespace because it is not associated with an object.`);return new _(this.path.concat([t]),this.access)}}const Y="trails-state";function Et(o,t){let e=o;for(const s of t){if(!C(e))throw new g(b.INVALID_PATH,`Cannot get nested property '${s}' because the parent is no object.`);e=e[s]}return e}function Nt(o,t,e){if(!t.length)throw new g(b.INTERNAL,"Path must not be empty.");let s=o;for(let l=0,i=t.length-1;l<i;++l){const u=t[l],w=s[u];if(!C(w))throw new g(b.INVALID_PATH,`Cannot set property on '${u}' because it is no object.`);s=w}const r=t[t.length-1];s[r]=e}function C(o){return!!(o&&typeof o=="object"&&!Array.isArray(o))}function Ct(o){const t=typeof o;return t==="boolean"||t==="number"||t==="string"||t==="undefined"||o===null||Array.isArray(o)||C(o)}function Lt(o){const t=o.storageId;return!t||typeof t!="string"?(A.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${Y}'.`),Y):t}function Mt(){if(typeof Storage>"u"){A.warn("Local storage is not supported by this browser.");return}try{const o=globalThis.localStorage;if(!o){A.warn("Local storage is not supported by this browser.");return}return o}catch(o){A.warn("Local storage is not supported by this browser.",o);return}}function X(o){return o!=null&&(o=JSON.parse(JSON.stringify(o))),o}const et="@open-pioneer/spatial-bookmarks",Tt=dt.bind(void 0,et),Dt=mt.bind(void 0,et),x=K("spatial-bookmark:SpatialBookmarkViewModel");class Pt{map;packageNamespace;writableBookmarks=ht([]);watchBookmarksHandle;get bookmarks(){return this.writableBookmarks.getItems()}constructor(t,e){this.map=t,this.packageNamespace=e.getNamespace("spatial-bookmarks"),this.loadState(),this.watchBookmarksHandle=ut(()=>[this.writableBookmarks.getItems()],([s])=>this.saveState(s),{immediate:!1})}destroy(){this.watchBookmarksHandle.destroy()}createBookmark(t){const e=this.map.olView.calculateExtent(),s=this.map.projection.getCode(),r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]},l={id:kt(),title:t,extent:r,projection:s};x.debug("Created a new bookmark",l),this.writableBookmarks.push(l)}activateBookmark(t){x.debug("Activating bookmark",t);const e=this.getBookmarkExtent(t);x.debug("Attempting to apply extent",e),this.applyExtent(e)}deleteBookmark(t){x.debug("Deleting bookmark",t);const e=this.writableBookmarks.findIndex(s=>s.id===t);e>-1&&this.writableBookmarks.splice(e,1)}deleteAllBookmarks(){x.debug("Deleting all bookmarks"),this.writableBookmarks.splice(0)}loadState(){x.debug("Restoring bookmarks from local storage");const t=this.packageNamespace.get("bookmarks")??[];try{Vt(t),this.writableBookmarks.push(...t)}catch(e){x.error("Bookmarks data in local storage is invalid, resetting to default value.",e),this.writableBookmarks.splice(0),this.saveState([])}}saveState(t){x.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",t)}getBookmarkExtent(t){const e=this.map.olView,s=t.extent,r=[s.minX,s.minY,s.maxX,s.maxY],l=e.getProjection(),i=t.projection;return pt(r,i,l)}applyExtent(t){const e=this.map.olView,s=ft(t),r=e.getResolutionForExtent(t);e.setCenter(s),e.setResolution(r)}}function Vt(o){if(!Array.isArray(o))throw new Error("Expected bookmarks from local storage to be an array.");for(const t of o)Rt(t)}function Rt(o){if(!o||typeof o!="object")throw new Error("Expected bookmark from local storage to be an object.");const t=o;if(typeof t.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof t.title!="string")throw new Error("Bookmark does not have a valid title.");if(_t(t.extent),typeof t.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function _t(o){if(!o||typeof o!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const t=o;if(typeof t.minX!="number"||typeof t.minY!="number"||typeof t.maxX!="number"||typeof t.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const se=o=>{const{map:t}=gt(o),e=Tt("local-storage.LocalStorageService"),s=zt(t,e);return s&&a.jsx(Ot,{...o,viewModel:s})};function Ot(o){const{viewModel:t}=o,e=Dt(),s=I.useRef([]),[r,l]=I.useState(!1),i=vt(()=>t.bookmarks,[t]),[u,w]=I.useState(""),m=u.trim().length>0,{containerProps:M}=bt("spatial-bookmarks",o),[j,k]=I.useState("list"),ot=()=>{t.deleteAllBookmarks(),k("list")},U=()=>{m&&(t.createBookmark(u),k("list"),w(""),l(!0))};I.useEffect(()=>{if(r){const S=s.current;S&&S[i.length-1]?.scrollIntoView?.(),l(!1)}},[i,r]);const st=()=>a.jsxs(F,{children:[a.jsxs(P,{rounded:"md",status:"warning",children:[a.jsx(V,{}),e.formatMessage({id:"bookmark.alert.delete"})]}),a.jsx(Yt,{intl:e,onClear:ot,onCancel:()=>k("list")})]}),at=()=>a.jsxs(F,{children:[a.jsxs(P,{rounded:"md",status:"info",children:[a.jsx(V,{}),e.formatMessage({id:"bookmark.alert.create"})]}),a.jsx(jt,{"aria-label":e.formatMessage({id:"bookmark.input.label"}),placeholder:e.formatMessage({id:"bookmark.input.placeholder"}),value:u,onChange:S=>{w(S.target.value)},onKeyDown:S=>{S.key==="Enter"&&U()},isRequired:!0,isInvalid:!m,autoFocus:!0}),a.jsx(Xt,{intl:e,isInvalid:!m,onCancel:()=>{w(""),k("list")},onSave:U})]}),rt=()=>a.jsxs(a.Fragment,{children:[i.length?Ut(i,t,e,s):a.jsxs(P,{rounded:"md",status:"info",children:[a.jsx(V,{}),e.formatMessage({id:"bookmark.alert.noSaved"})]}),a.jsx(Ft,{intl:e,bookmarks:i,showCreate:()=>k("create"),showDelete:()=>k("delete")})]}),nt=a.jsxs(a.Fragment,{children:[j==="list"&&rt(),j==="create"&&at(),j==="delete"&&st()]});return a.jsx(R,{flexDirection:"column",...M,children:nt})}function Ut(o,t,e,s){const r=e.formatMessage({id:"bookmark.button.deleteOne"}),l=o.map((i,u)=>a.jsx(Ht,{index:u,listItemNodes:s,bookmark:i,onActivate:()=>t.activateBookmark(i),onDelete:()=>t.deleteBookmark(i.id),deleteBtnLabel:r},i.id));return a.jsx(yt,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":e.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:l})}const z={ArrowDown:1,ArrowUp:-1};function Ht(o){const{index:t,listItemNodes:e,bookmark:s,onDelete:r,onActivate:l,deleteBtnLabel:i}=o,u=s.title,w=m=>{const M=m.key;if(M==="Enter"){m.target===m.currentTarget&&l();return}if(z[M]!=null){const j=e.current?.length;if(!j)return;let k=(t+z[M])%j;k<0&&(k=j-1),e.current[k]?.focus()}};return a.jsx(lt,{as:"li",p:1,ref:m=>{if(!m){e.current.splice(t,1);return}e.current[t]=m},className:wt("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:w,onClick:l,children:a.jsxs(R,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[a.jsx(W,{children:a.jsx(xt,{})}),a.jsx(It,{ps:2,noOfLines:1,children:u}),a.jsx(At,{}),a.jsx(ct,{hasArrow:!0,label:i,placement:"right",children:a.jsx($,{className:"spatial-bookmarks-item-delete","aria-label":i,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:a.jsx(J,{}),onClick:m=>{r(),m.stopPropagation()}})},t)]})})}function Ft(o){const{intl:t,bookmarks:e,showCreate:s,showDelete:r}=o;return a.jsxs(O,{children:[a.jsx(L,{isDisabled:e.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:a.jsx(J,{}),onClick:r,"aria-label":t.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),a.jsx(L,{onClick:s,width:"100%",children:t.formatMessage({id:"bookmark.button.create"})})]})}function Yt(o){const{intl:t,onCancel:e,onClear:s}=o;return a.jsxs(O,{children:[a.jsx(L,{variant:"outline",onClick:e,children:t.formatMessage({id:"bookmark.button.cancelDelete"})}),a.jsx(L,{onClick:s,children:t.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function Xt(o){const{intl:t,onCancel:e,onSave:s,isInvalid:r}=o;return a.jsxs(O,{children:[a.jsx(L,{variant:"outline",onClick:()=>e(),children:t.formatMessage({id:"bookmark.button.cancel"})}),a.jsx(L,{isDisabled:r,onClick:()=>s(),children:t.formatMessage({id:"bookmark.button.save"})})]})}function O(o){return a.jsx(R,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:o.children})}function L(o){return a.jsx($,{width:"100%",...o})}function zt(o,t){const[e,s]=I.useState();return I.useEffect(()=>{let r;return o?r=new Pt(o,t):r=void 0,s(r),()=>r?.destroy()},[o,t]),e}function ae(o){return q({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"},child:[]}]})(o)}function re(o){return q({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(o)}export{oe as L,re as M,se as S,ae as a};
