import{M as ao,r as i,j as s,N as io,O as xe,n as B,l as ve,P as lo,Q as co,R as q,T as D,U as C,u as uo,o as po,W as mo,G as fo,s as E,m as G,C as ho,X as go,Y as yo,t as Pe,b as ee,F as Ce,B as F}from"./CilY7FyO6Rl3.js";import{aZ as we,by as je,u as bo,k as oe,r as Ie,i as xo,g as de,h as pe,e as vo}from"./CSmiKdizJP8d.js";import{u as L,B as Po}from"./BijvRNQYcfni.js";import{f as Te,F as Co}from"./n4hly-pWbHU_.js";import{u as wo,a as jo,b as Io,c as To,l as No,i as me,M as Lo}from"./Cy7ss6gga7Ek.js";import{S as Ne,I as So}from"./B3YDfXTQi5NX.js";import{C as Mo,a as ko,b as Ao,M as fe}from"./oqlO-O4whMei.js";import{c as Eo}from"./xdScXFjN6s-F.js";import{C as Bo}from"./CPKpkcGeZHQo.js";import{T as te,L as Ro}from"./Bj7cN7qkOzIJ.js";const Oo=e=>{const{condition:o,message:t}=e};function _o(e){return"current"in e}const Le=()=>typeof window<"u";function Do(){return navigator.userAgentData?.platform??navigator.platform}const Fo=e=>Le()&&e.test(navigator.vendor),Go=e=>Le()&&e.test(Do()),Ho=()=>Go(/mac|iphone|ipad|ipod/i),Vo=()=>Ho()&&Fo(/apple/i);function zo(e){const{ref:o,elements:t,enabled:n}=e,r=()=>o.current?.ownerDocument??document;ao(r,"pointerdown",a=>{if(!Vo()||!n)return;const c=a.composedPath?.()?.[0]??a.target,m=(t??[o]).some(p=>{const f=_o(p)?p.current:p;return f?.contains(c)||f===c});r().activeElement!==c&&m&&(a.preventDefault(),c.focus())})}const A={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1],easeInOut:[.4,0,.2,1]},Tt={enter:{duration:.2,ease:A.easeOut},exit:{duration:.1,ease:A.easeIn}},he={enter:(e,o)=>({...e,delay:typeof o=="number"?o:o?.enter}),exit:(e,o)=>({...e,delay:typeof o=="number"?o:o?.exit})},$o=e=>e!=null&&parseInt(e.toString(),10)>0,ge={exit:{height:{duration:.2,ease:A.ease},opacity:{duration:.3,ease:A.ease}},enter:{height:{duration:.3,ease:A.ease},opacity:{duration:.4,ease:A.ease}}},Ko={exit:({animateOpacity:e,startingHeight:o,transition:t,transitionEnd:n,delay:r})=>({...e&&{opacity:$o(o)?1:0},height:o,transitionEnd:n?.exit,transition:t?.exit??he.exit(ge.exit,r)}),enter:({animateOpacity:e,endingHeight:o,transition:t,transitionEnd:n,delay:r})=>({...e&&{opacity:1},height:o,transitionEnd:n?.enter,transition:t?.enter??he.enter(ge.enter,r)})},Se=i.forwardRef((e,o)=>{const{in:t,unmountOnExit:n,animateOpacity:r=!0,startingHeight:a=0,endingHeight:c="auto",style:l,className:m,transition:p,transitionEnd:f,animatePresenceProps:b,...v}=e,[P,w]=i.useState(!1);i.useEffect(()=>{const V=setTimeout(()=>{w(!0)});return()=>clearTimeout(V)},[]),Oo({condition:Number(a)>0&&!!n,message:"startingHeight and unmountOnExit are mutually exclusive. You can't use them together"});const j=parseFloat(a.toString())>0,d={startingHeight:a,endingHeight:c,animateOpacity:r,transition:P?p:{enter:{duration:0}},transitionEnd:{enter:f?.enter,exit:n?f?.exit:{...f?.exit,display:j?"block":"none"}}},h=n?t:!0,I=t||n?"enter":"exit";return s.jsx(io,{...b,initial:!1,custom:d,children:h&&s.jsx(xe.div,{ref:o,...v,className:B("chakra-collapse",m),style:{overflow:"hidden",display:"block",...l},custom:d,variants:Ko,initial:n?"exit":!1,animate:I,exit:"exit"})})});Se.displayName="Collapse";const[Uo,S]=ve({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[Yo,H]=ve({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),k={click:"click",hover:"hover"};function Qo(e={}){const{closeOnBlur:o=!0,closeOnEsc:t=!0,initialFocusRef:n,id:r,returnFocusOnClose:a=!0,autoFocus:c=!0,arrowSize:l,arrowShadowColor:m,trigger:p=k.click,openDelay:f=200,closeDelay:b=200,isLazy:v,lazyBehavior:P="unmount",computePositionOnMount:w,...j}=e,{isOpen:d,onClose:h,onOpen:I,onToggle:V}=lo(e),[$e,Q]=i.useState(a);i.useEffect(()=>Q(a),[a]);const W=i.useRef(null),O=i.useRef(null),T=i.useRef(null),_=i.useRef(!1),se=i.useRef(!1);d&&(se.current=!0);const[ne,Ke]=i.useState(!1),[re,Ue]=i.useState(!1),Ye=i.useId(),Qe=r??Ye,[ae,z,$,K]=["popover-trigger","popover-content","popover-header","popover-body"].map(u=>`${u}-${Qe}`),{referenceRef:U,getArrowProps:We,getPopperProps:ie,getArrowInnerProps:Xe,forceUpdate:Ze}=co({...j,enabled:d||!!w}),le=wo({isOpen:d,ref:T});zo({enabled:d,ref:O}),jo(T,{focusRef:O,visible:d,shouldFocus:$e&&p===k.click}),Io(T,{focusRef:n,visible:d,shouldFocus:c&&p===k.click}),To({enabled:d&&o,ref:T,handler(u){const y=u.composedPath?.()[0]??[u.target];Y(O.current,y)||(y&&Q(!me(y)),h())}});const ce=No({wasSelected:se.current,enabled:v,mode:P,isSelected:le.present}),qe=i.useCallback((u={},y=null)=>{const g={...u,style:{...u.style,transformOrigin:q.transformOrigin.varRef,[q.arrowSize.var]:l?`${l}px`:void 0,[q.arrowShadowColor.var]:m},ref:D(T,y),children:ce?u.children:null,id:z,tabIndex:-1,role:"dialog",onKeyDown:C(u.onKeyDown,x=>{x.nativeEvent.isComposing||t&&x.key==="Escape"&&(x.preventDefault(),x.stopPropagation(),h())}),onBlur:C(u.onBlur,x=>{const M=ye(x),Z=Y(T.current,M),no=Y(O.current,M),ro=!Z&&!no;M&&Q(!me(M)),d&&o&&ro&&h()}),"aria-labelledby":ne?$:void 0,"aria-describedby":re?K:void 0};return p===k.hover&&(g.role="tooltip",g.onMouseEnter=C(u.onMouseEnter,()=>{_.current=!0}),g.onMouseLeave=C(u.onMouseLeave,x=>{x.nativeEvent.relatedTarget!==null&&(_.current=!1,setTimeout(()=>h(),b))})),g},[ce,z,ne,$,re,K,p,t,h,d,o,b,m,l]),Je=i.useCallback((u={},y=null)=>ie({...u,style:{visibility:d?"visible":"hidden",...u.style}},y),[d,ie]),eo=i.useCallback((u,y=null)=>({...u,ref:D(y,W,U)}),[W,U]),N=i.useRef(),X=i.useRef(),ue=i.useCallback(u=>{W.current==null&&U(u)},[U]),oo=i.useCallback((u={},y=null)=>{const g={...u,ref:D(O,y,ue),id:ae,"aria-haspopup":"dialog","aria-expanded":d,"aria-controls":z};return p===k.click&&(g.onClick=C(u.onClick,V)),p===k.hover&&(g.onFocus=C(u.onFocus,()=>{N.current===void 0&&I()}),g.onBlur=C(u.onBlur,x=>{const M=ye(x),Z=!Y(T.current,M);d&&o&&Z&&h()}),g.onKeyDown=C(u.onKeyDown,x=>{x.key==="Escape"&&h()}),g.onMouseEnter=C(u.onMouseEnter,()=>{_.current=!0,N.current=window.setTimeout(()=>I(),f)}),g.onMouseLeave=C(u.onMouseLeave,()=>{_.current=!1,N.current&&(clearTimeout(N.current),N.current=void 0),X.current=window.setTimeout(()=>{_.current===!1&&h()},b)})),g},[ae,d,z,p,ue,V,I,o,h,f,b]);i.useEffect(()=>()=>{N.current&&clearTimeout(N.current),X.current&&clearTimeout(X.current)},[]);const to=i.useCallback((u={},y=null)=>({...u,id:$,ref:D(y,g=>{Ke(!!g)})}),[$]),so=i.useCallback((u={},y=null)=>({...u,id:K,ref:D(y,g=>{Ue(!!g)})}),[K]);return{forceUpdate:Ze,isOpen:d,onAnimationComplete:le.onComplete,onClose:h,getAnchorProps:eo,getArrowProps:We,getArrowInnerProps:Xe,getPopoverPositionerProps:Je,getPopoverProps:qe,getTriggerProps:oo,getHeaderProps:to,getBodyProps:so}}function Y(e,o){return e===o||e?.contains(o)}function ye(e){const o=e.currentTarget.ownerDocument.activeElement;return e.relatedTarget??o}function Me(e){const o=uo("Popover",e),{children:t,...n}=po(e),r=mo(),a=Qo({...n,direction:r.direction});return s.jsx(Uo,{value:a,children:s.jsx(Yo,{value:o,children:fo(t,{isOpen:a.isOpen,onClose:a.onClose,forceUpdate:a.forceUpdate})})})}Me.displayName="Popover";const J=(e,o)=>o?`${e}.${o}, ${o}`:void 0;function ke(e){const{bg:o,bgColor:t,backgroundColor:n,shadow:r,boxShadow:a,shadowColor:c,...l}=e,{getArrowProps:m,getArrowInnerProps:p}=S(),f=H(),b=o??t??n,v=r??a;return s.jsx(E.div,{...m(),className:"chakra-popover__arrow-positioner",children:s.jsx(E.div,{className:B("chakra-popover__arrow",e.className),...p(l),__css:{"--popper-arrow-shadow-color":J("colors",c),"--popper-arrow-bg":J("colors",b),"--popper-arrow-shadow":J("shadows",v),...f.arrow}})})}ke.displayName="PopoverArrow";const Ae=G(function(o,t){const{getBodyProps:n}=S(),r=H();return s.jsx(E.div,{...n(o,t),className:B("chakra-popover__body",o.className),__css:r.body})});Ae.displayName="PopoverBody";const Ee=G(function(o,t){const{onClose:n}=S(),r=H();return s.jsx(ho,{size:"sm",onClick:n,className:B("chakra-popover__close-btn",o.className),__css:r.closeButton,ref:t,...o})});Ee.displayName="PopoverCloseButton";function Wo(e){if(e)return{enter:{...e.enter,visibility:"visible"},exit:{...e.exit,transitionEnd:{visibility:"hidden"}}}}const Xo={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},Zo=E(xe.section),Be=G(function(o,t){const{variants:n=Xo,...r}=o,{isOpen:a}=S();return s.jsx(Zo,{ref:t,variants:Wo(n),initial:!1,animate:a?"enter":"exit",...r})});Be.displayName="PopoverTransition";const Re=G(function(o,t){const{rootProps:n,motionProps:r,...a}=o,{getPopoverProps:c,getPopoverPositionerProps:l,onAnimationComplete:m}=S(),p=H(),f=go({position:"relative",display:"flex",flexDirection:"column",...p.content});return s.jsx(E.div,{...l(n),__css:p.popper,className:"chakra-popover__popper",children:s.jsx(Be,{...r,...c(a,t),onAnimationComplete:yo(m,a.onAnimationComplete),className:B("chakra-popover__content",o.className),__css:f})})});Re.displayName="PopoverContent";const Oe=G(function(o,t){const{getHeaderProps:n}=S(),r=H();return s.jsx(E.header,{...n(o,t),className:B("chakra-popover__header",o.className),__css:r.header})});Oe.displayName="PopoverHeader";function _e(e){const o=i.Children.only(e.children),{getTriggerProps:t}=S();return s.jsx(s.Fragment,{children:i.cloneElement(o,t(o.props,o.ref))})}_e.displayName="PopoverTrigger";function qo(e){return"parentLayer"in e}function Nt(e){return"olLayer"in e}const Jo=Eo({d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",displayName:"ChevronRightIcon"}),Lt=i.forwardRef(function(o,t){const{label:n,icon:r,onClick:a,isLoading:c,isDisabled:l,isActive:m,tooltipProps:p,buttonProps:f}=o,{containerProps:{className:b,...v}}=we("tool-button",o),P=je(b,{"tool-button--active":m,"tool-button--loading":c,"tool-button--disabled":l}),w=typeof m=="boolean"?m?"true":"false":void 0,[j,d]=i.useState(!1),h=I=>{d(!1),a?.(I)};return s.jsx(Pe,{label:n,placement:"auto",openDelay:500,...p,isOpen:j,onOpen:()=>d(!0),onClose:()=>d(!1),children:s.jsx(et,{className:P,ref:t,"aria-label":n,leftIcon:r,iconSpacing:0,padding:0,isDisabled:l,isLoading:c,isActive:m,"aria-pressed":w,...v,...f,onClick:h})})}),et=i.forwardRef(function(o,t){const{"aria-labelledby":n,"aria-describedby":r,...a}=o;return s.jsx(ee,{ref:t,...a})}),ot="@open-pioneer/toc",R=bo.bind(void 0,ot),De=i.createContext(void 0),tt=De.Provider;function Fe(){const e=i.useContext(De);if(!e)throw new Error("Internal error: TocModel not found in context.");return e}function st(e){return e.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function nt(e){return L(()=>{const o=e.layers.getOperationalLayers({sortByDisplayOrder:!0})??[];return o.reverse(),o},[e])}function rt(e){return L(()=>{const o=e.children?.getItems({sortByDisplayOrder:!0});return o?.reverse(),o},[e])}function Ge(e){return L(()=>(qo(e)?e.parentLayer:e).loadState,[e])}function at(e){const{layer:o,title:t,description:n,intl:r}=e,a=!!n,c=r.formatMessage({id:"descriptionLabel"}),l=Ge(o)!=="error";return a&&s.jsxs(Me,{placement:"bottom-start",children:[s.jsx(_e,{children:s.jsx(ee,{isDisabled:!l,className:"toc-layer-item-details-button","aria-label":c,borderRadius:"full",iconSpacing:0,padding:0,variant:"ghost",leftIcon:s.jsx(Te,{})})}),s.jsx(Ce,{children:s.jsxs(Re,{className:"toc-layer-item-details",overflowY:"auto",maxHeight:"400",children:[s.jsx(ke,{}),s.jsx(Ee,{mt:1}),s.jsx(Oe,{children:t}),s.jsx(Ae,{children:n})]})})]})}const it=i.memo(function(o){const{layer:t}=o,n=R(),[r,a,c]=ct(t),l=L(()=>r.isExpanded,[r]),m=c?c.collapsibleGroups:!1,p=i.useId(),f=rt(t),b=Ge(t)!=="error",v=n.formatMessage({id:"layerNotAvailable"}),{title:P,description:w,isVisible:j}=L(()=>({title:t.title,description:t.description,isVisible:t.visible}),[t]);let d;return f?.length&&(d=s.jsx(Ve,{layers:f,ml:4,"aria-label":n.formatMessage({id:"childgroupLabel"},{title:P})})),s.jsxs(F,{as:"li",className:je("toc-layer-item",`layer-${st(t.id)}`),children:[s.jsxs(oe,{className:"toc-layer-item-content",width:"100%",flexDirection:"row",align:"center",justifyContent:"space-between",gap:2,minHeight:10,children:[m&&s.jsx(lt,{layerTitle:P,layerGroupId:p,expanded:l,onClick:()=>r.setExpanded(!l),hasNestedChildren:!!d}),s.jsx(Bo,{"aria-label":P+(b?"":" "+v),isChecked:j,isDisabled:!b,onChange:h=>He(t,h.target.checked,c.autoShowParents),children:P}),!b&&s.jsx(Pe,{className:"toc-layer-item-content-tooltip",label:v,placement:"right",openDelay:500,children:s.jsx("span",{children:s.jsx(Co,{className:"toc-layer-item-content-icon",color:"red","aria-label":v})})}),s.jsx(Ne,{}),s.jsx(at,{layer:t,title:P,description:w,intl:n})]}),d&&s.jsx(Se,{in:l,id:p,className:"toc-collapsible-item",children:d})]})});function lt(e){const{layerTitle:o,layerGroupId:t,expanded:n,onClick:r,hasNestedChildren:a}=e,c=R();return s.jsx(So,{variant:"ghost",borderRadius:"full",padding:0,className:"toc-layer-item-collapse-button",onClick:r,icon:n?s.jsx(Mo,{}):s.jsx(Jo,{}),"aria-label":n?c.formatMessage({id:"group.collapse"},{title:o}):c.formatMessage({id:"group.expand"},{title:o}),"aria-expanded":n,"aria-controls":t,visibility:a?"visible":"hidden"})}function ct(e){const o=Fe(),t=L(()=>o.options,[o]),n=i.useMemo(()=>{const r=Ie(!t.initiallyCollapsed);return{layerId:e.id,get isExpanded(){return r.value},setExpanded(a){r.value=a}}},[e,t.initiallyCollapsed]);return i.useEffect(()=>(o.registerItem(n),()=>o.unregisterItem(n)),[o,n]),[n,o,t]}function He(e,o,t){e.setVisible(o),o&&t&&e.parent&&He(e.parent,!0,!0)}const ut=i.memo(function(o){const{map:t,"aria-label":n}=o,r=R(),a=nt(t);return a.length?s.jsx(Ve,{layers:a,"aria-label":n}):s.jsx(te,{className:"toc-missing-layers","aria-label":n,children:r.formatMessage({id:"missingLayers"})})}),Ve=i.memo(function(o){const{layers:t,...n}=o,r=i.useMemo(()=>t.map(a=>s.jsx(it,{layer:a},a.id)),[t]);return s.jsx(F,{children:s.jsx(Ro,{as:"ul",className:"toc-layer-list",listStyleType:"none",role:"group",...n,children:r})})}),dt=i.memo(function(o){const t=R(),n=Fe(),r=L(()=>n.options.collapsibleGroups,[n]),{map:a,showHideAllLayers:c=!0,showCollapseAllGroups:l=r}=o,m=r&&l;return(c||m)&&s.jsx(F,{className:"toc-tools",children:s.jsxs(Lo,{placement:"bottom-start",children:[s.jsx(ko,{as:ee,className:"toc-tools-button","aria-label":t.formatMessage({id:"toolsLabel"}),borderRadius:"full",iconSpacing:0,padding:3,variant:"ghost",leftIcon:s.jsx(Te,{})}),s.jsx(Ce,{children:s.jsxs(Ao,{className:"tools-menu",children:[c&&s.jsx(fe,{"aria-label":t.formatMessage({id:"tools.hideAllLayers"}),onClick:()=>{pt(a)},children:t.formatMessage({id:"tools.hideAllLayers"})}),m&&s.jsx(fe,{"aria-label":t.formatMessage({id:"tools.collapseAllGroups"}),onClick:()=>{mt(n)},children:t.formatMessage({id:"tools.collapseAllGroups"})})]})})]})})});function pt(e){const o=t=>{t.setVisible(!1);const n=t.children?.getItems();if(n)for(const r of n)o(r)};e?.layers.getOperationalLayers().forEach(t=>{o(t)})}function mt(e){e.getItems().forEach(o=>o.setExpanded(!1))}const ze=2,St=e=>{const o=R(),{containerProps:t}=we("toc",e),n=xo(e);let r;switch(n.kind){case"loading":r=null;break;case"rejected":r=s.jsx(te,{className:"toc-error",children:o.formatMessage({id:"error"})});break;case"resolved":{const a=n.map;r=s.jsx(ft,{...e,map:a});break}}return s.jsx(oe,{...t,direction:"column",gap:ze,children:r})};function ft(e){const{map:o,showTools:t=!1,toolsConfig:n,showBasemapSwitcher:r=!0,basemapSwitcherProps:a}=e,c=R(),l=ht(e),m=i.useId(),p=r&&s.jsx(F,{className:"toc-basemap-switcher",children:s.jsx(de,{title:s.jsx(pe,{id:m,size:"sm",mb:ze,children:c.formatMessage({id:"basemapsLabel"})}),children:s.jsx(Po,{map:o,"aria-labelledby":m,...a})})}),f=s.jsx(F,{className:"toc-operational-layers",children:s.jsx(de,{title:s.jsx(pe,{size:"sm",mb:2,children:s.jsxs(oe,{children:[s.jsx(te,{my:3,children:c.formatMessage({id:"operationalLayerLabel"})}),s.jsx(Ne,{}),t&&s.jsx(dt,{map:o,...n})]})}),children:s.jsx(ut,{map:o,"aria-label":c.formatMessage({id:"operationalLayerLabel"})})})});return s.jsxs(tt,{value:l,children:[p,f]})}function ht(e){const o=i.useRef(e),{model:t,options:n}=i.useMemo(()=>{const r=Ie(be(o.current.autoShowParents,o.current.collapsibleGroups,o.current.initiallyCollapsed)),a=vo();return{model:{get options(){return r.value},getItem(l){return a.get(l)},getItems(){return Array.from(a.values())},registerItem(l){if(a.has(l.layerId))throw new Error(`Item with layerId '${l.layerId}' already registered.`);a.set(l.layerId,l)},unregisterItem(l){if(a.get(l.layerId)!==l)throw new Error(`Item with layerId '${l.layerId}' not registered.`);a.delete(l.layerId)}},options:r}},[]);return i.useEffect(()=>{n.value=be(e.autoShowParents,e.collapsibleGroups,e.initiallyCollapsed)},[n,e.autoShowParents,e.collapsibleGroups,e.initiallyCollapsed]),t}function be(e,o,t){return{autoShowParents:e??!0,collapsibleGroups:o??!1,initiallyCollapsed:t??!1}}export{Me as P,Lt as T,_e as a,Re as b,ke as c,Ae as d,St as e,Nt as i,S as u};
