const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BbaoeC_R5Std.js","./CmsKOCeNyeyo.js","./BijvRNQYcfni.js","./CilY7FyO6Rl3.js","./CSmiKdizJP8d.js","./hnzQPimfMtwE.js","./BBrt1HOYTwGp.js","./Cy7ss6gga7Ek.js","./n4hly-pWbHU_.js"])))=>i.map(i=>d[i]);
import{m as k,u as Y,o as X,n as Z,j as a,s as T,y as de,z as ue,r as m,D as w,G,H as me,J as he,K as fe,B as v,L as B,b as J,c as ge}from"./CilY7FyO6Rl3.js";import{u as K}from"./hnzQPimfMtwE.js";import{aE as pe,bE as ye,bF as Me,bG as ve,aP as xe,aX as Pe,bH as Se,bI as Ee,J as be,f as q,u as F,aZ as E,i as b,j as N,b0 as we,by as Ce,b as Fe,a as Ne,a$ as Le,bJ as Ie,a_ as Te,am as L,bK as je,bL as Ae,c as I,ax as C,F as A,C as Oe}from"./CSmiKdizJP8d.js";import{u as P}from"./BijvRNQYcfni.js";import{T as S,L as _e}from"./Bj7cN7qkOzIJ.js";import{S as He,I as De,D as ke,c as Re,a as $e}from"./KONR8iZ-Avj1.js";import{i as Ge}from"./DWSYd4wJ1TYc.js";import{c as Be}from"./xdScXFjN6s-F.js";import{L as O}from"./ZELZeNiQy5tD.js";import{u as Q,F as _}from"./BBrt1HOYTwGp.js";import{F as H}from"./RthlauyR4DBd.js";import{H as D}from"./Dmf5wzxP0u3m.js";import{_ as Ke}from"./CmsKOCeNyeyo.js";import{s as ze}from"./CzYrjwZokjtc.js";const R=k(function(e,t){const{htmlSize:s,...n}=e,i=Y("Input",n),o=X(n),l=Q(o),c=Z("chakra-input",e.className);return a.jsx(T.input,{size:s,...l,__css:i.field,ref:t,className:c})});R.displayName="Input";R.id="Input";const ee=k(function(e,t){const{children:s,placeholder:n,className:i,...o}=e;return a.jsxs(T.select,{...o,ref:t,className:Z("chakra-select",i),children:[n&&a.jsx("option",{value:"",children:n}),s]})});ee.displayName="SelectField";const $=k((r,e)=>{const t=Y("Select",r),{rootProps:s,placeholder:n,icon:i,color:o,height:l,h:c,minH:d,minHeight:u,iconColor:f,iconSize:y,...p}=X(r),[M,h]=ze(p,de),x=Q(h),j={width:"100%",height:"fit-content",position:"relative",color:o},ce={paddingEnd:"2rem",...t.field,_focus:{zIndex:"unset",...t.field?._focus}};return a.jsxs(T.div,{className:"chakra-select__wrapper",__css:j,...M,...s,children:[a.jsx(ee,{ref:e,height:c??l,minH:d??u,placeholder:n,...x,__css:ce,children:r.children}),a.jsx(te,{"data-disabled":ue(x.disabled),...(f||o)&&{color:f||o},__css:t.icon,...y&&{fontSize:y},children:i})]})});$.displayName="Select";const Ue=r=>a.jsx("svg",{viewBox:"0 0 24 24",...r,children:a.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Ve=T("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),te=r=>{const{children:e=a.jsx(Ue,{}),...t}=r,s=m.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return a.jsx(Ve,{...t,className:"chakra-select__icon-wrapper",children:m.isValidElement(e)?s:null})};te.displayName="SelectIcon";function We(r,e){const t=r??"bottom";return{"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[t]?.[e]??t}function Ye(r,e){const t=n=>({...e,...n,position:We(n?.position??e?.position,r)}),s=n=>{const i=t(n),o=me(i);return w.notify(o,i)};return s.update=(n,i)=>{w.update(n,t(i))},s.promise=(n,i)=>{const o=s({...i.loading,status:"loading",duration:null});n.then(l=>s.update(o,{status:"success",duration:5e3,...G(i.success,l)})).catch(l=>s.update(o,{status:"error",duration:5e3,...G(i.error,l)}))},s.closeAll=w.closeAll,s.close=w.close,s.isActive=w.isActive,s}function Xe(r){const{theme:e}=he(),t=fe();return m.useMemo(()=>Ye(e.direction,{...t,...r}),[r,e.direction,t])}const g={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class se extends pe{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+ye,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(g.ELEMENT,this.handleElementChanged),this.addChangeListener(g.MAP,this.handleMapChanged),this.addChangeListener(g.OFFSET,this.handleOffsetChanged),this.addChangeListener(g.POSITION,this.handlePositionChanged),this.addChangeListener(g.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(g.ELEMENT)}getId(){return this.id}getMap(){return this.get(g.MAP)||null}getOffset(){return this.get(g.OFFSET)}getPosition(){return this.get(g.POSITION)}getPositioning(){return this.get(g.POSITIONING)}handleElementChanged(){Me(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),ve(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=xe(e,Pe.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(g.ELEMENT,e)}setMap(e){this.set(g.MAP,e)}setOffset(e){this.set(g.OFFSET,e)}setPosition(e){this.set(g.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(g.POSITION))return;const s=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),i=this.getRect(n,[Se(n),Ee(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!be(s,i)){const l=i[0]-s[0],c=s[2]-i[2],d=i[1]-s[1],u=s[3]-i[3],f=[0,0];if(l<0?f[0]=l-o:c<0&&(f[0]=Math.abs(c)+o),d<0?f[1]=d-o:u<0&&(f[1]=Math.abs(u)+o),f[0]!==0||f[1]!==0){const y=t.getView().getCenterInternal(),p=t.getPixelFromCoordinateInternal(y);if(!p)return;const M=[p[0]+f[0],p[1]+f[1]],h=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(M),duration:h.duration,easing:h.easing})}}}getRect(e,t){const s=e.getBoundingClientRect(),n=s.left+window.pageXOffset,i=s.top+window.pageYOffset;return[n,i,n+t[0],i+t[1]]}setPositioning(e){this.set(g.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const s=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(s,n)}updateRenderedPosition(e,t){const s=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+n[0])+"px",l=Math.round(e[1]+n[1])+"px";let c="0%",d="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?c="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(c="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?d="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(d="-50%");const u=`translate(${c}, ${d}) translate(${o}, ${l})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,s.transform=u)}getOptions(){return this.options}}const Ze="@open-pioneer/notifier",Je=q.bind(void 0,Ze),ne=Be({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),qe=!1;function Wt(r){const{position:e="top-right"}=r,t=Xe(),s=Je("notifier.NotificationService"),[n,i]=m.useState(!qe),o=K(c=>{const d=c.level==="error"?a.jsx(ne,{h:"100%",w:"100%"}):void 0;t({position:e,title:c.title,description:c.message||null,status:c.level,isClosable:!0,duration:c.displayDuration??null,icon:d})}),l=K(()=>{t.closeAll()});return m.useEffect(()=>{const c=s.registerHandler({showNotification:o,closeAll:l});return()=>c.destroy()},[n,s,o,l]),a.jsx(a.Fragment,{})}const Qe="@open-pioneer/coordinate-viewer",et=F.bind(void 0,Qe),tt=4,st="decimal",Yt=r=>{const{precision:e,displayProjectionCode:t,format:s}=r,{containerProps:n}=E("coordinate-viewer",r),{map:i}=b(r),o=i?.olMap,l=P(()=>i?.projection.getCode()??"",[i]);let{coordinates:c}=it(o);c=c&&t?ot(c,l,t):c;const d=nt(c,e,s),u=t||l,f=d?d+" "+u:"";return a.jsx(v,{...n,children:a.jsx(S,{className:"coordinate-viewer-text",children:f})})};function nt(r,e,t){const s=et();return r?rt(r,e,s,t):""}function it(r){const[e,t]=m.useState();return m.useEffect(()=>{if(!r)return;const s=r.on("pointermove",n=>{t(n.coordinate)});return()=>N(s)},[r]),{coordinates:e}}function rt(r,e,t,s){if(r[0]==null||r[1]==null)return"";const n=e??tt,i=s??st,[o,l]=r;let c;if(i==="degree"&&isFinite(o)&&isFinite(l)){const[d,u,f]=z(o,t,n),[y,p,M]=z(l,t,n),h=`${Math.abs(d)}°${u}'${f}"${0<=d?"(E)":"(W)"}`,x=`${Math.abs(y)}°${p}'${M}"${0<=y?"(N)":"(S)"}`;c=h+" "+x}else{const d=t.formatNumber(o,{maximumFractionDigits:n,minimumFractionDigits:n}),u=t.formatNumber(l,{maximumFractionDigits:n,minimumFractionDigits:n});c=d+" "+u}return c}function z(r,e,t){const s=Math.floor(r),n=r-s,i=Math.floor(60*n),l=60*(60*n-i),c=e.formatNumber(l,{maximumFractionDigits:t,minimumFractionDigits:t});return[s,i,c]}function ot(r,e,t){return we(r,e,t)}const Xt=r=>{const{displayMode:e="line"}=r,{containerProps:t}=E("scale-bar",r),{map:s}=b(r),n=m.useRef(null);return m.useEffect(()=>{if(n.current&&s){const i=s.olMap,o=new He({units:"metric",target:n.current,bar:e==="bar"});return i.addControl(o),()=>{i.removeControl(o)}}},[e,s]),a.jsx(v,{...t,ref:n})},at="@open-pioneer/scale-viewer",lt=F.bind(void 0,at),Zt=r=>{const{containerProps:e}=E("scale-viewer",r),{map:t}=b(r),s=lt(),n=P(()=>t?.scale??1,[t]),i=n?s.formatNumber(n):void 0;return a.jsx(v,{...e,children:i&&a.jsxs(S,{children:["1:",i]})})},ct="@open-pioneer/legend",ie=F.bind(void 0,ct),Jt=r=>{const{showBaseLayers:e=!1}=r,{containerProps:t}=E("legend",r),{map:s}=b(r);return a.jsx(v,{...t,children:s?a.jsx(dt,{map:s,showBaseLayers:e}):null})};function dt(r){const{map:e,showBaseLayers:t}=r,n=mt(e).map(i=>a.jsx(re,{layer:i,showBaseLayers:t},i.id));return a.jsx(_e,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:n})}function re(r){const{layer:e,showBaseLayers:t}=r,s=P(()=>e.visible,[e]),n=ht(e);if(!s||!t&&Ge(e)&&oe(e))return;const i=[];return n?.length&&n.forEach(o=>{i.push(a.jsx(re,{layer:o,showBaseLayers:t},o.id))}),a.jsxs(a.Fragment,{children:[a.jsx(ut,{layer:e,showBaseLayers:t}),i]})}function ut(r){const e=ie(),{layer:t,showBaseLayers:s}=r,n=oe(t),i=ft(t),o=P(()=>t.legend,[t]);let l;return i?.Component?l=a.jsx(i.Component,{layer:t}):i?.imageUrl?l=a.jsx(U,{layer:t,imageUrl:i.imageUrl}):o&&(l=a.jsx(U,{layer:t,imageUrl:o})),l?a.jsxs(v,{as:"li",className:Ce("legend-item",`layer-${gt(t.id)}`),children:[s&&n?a.jsx(S,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,l]}):void 0}function U(r){const e=ie(),{layer:t,imageUrl:s}=r;return a.jsxs(v,{children:[a.jsx(S,{children:t.title}),a.jsx(De,{maxW:"none",maxH:"none",src:s,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:a.jsx(v,{children:a.jsxs(S,{children:[a.jsx(ne,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function mt(r){return P(()=>{const e=r.layers.getAllLayers({sortByDisplayOrder:!0})??[];return e.reverse(),e},[r])}function ht(r){return P(()=>{const e=r.sublayers?.getSublayers({sortByDisplayOrder:!0});if(e)return e.reverse(),e},[r])}function ft(r){return P(()=>r.attributes.legend,[r])}function oe(r){return!("parentLayer"in r)&&r.isBaseLayer}function gt(r){return r.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const pt="@open-pioneer/measurement",yt=F.bind(void 0,pt);class Mt{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;activeMeasurement;predefinedMeasurements=new Map;finishedMeasurements=new Set;helpTooltip;resources=[];measurementChangedHandler;constructor(e,t){this.olMap=e,this.messages=t;const s=this.source=new Fe;this.layer=new Ne({source:s,zIndex:Le,properties:{name:"measurement-layer"}}),e.addLayer(this.layer);const n=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){N(n)}});const i=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",i),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",i)}}),this.helpTooltip=xt(this.olMap)}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.activeMeasurement=B(this.activeMeasurement);for(const e of this.finishedMeasurements)e.destroy();this.finishedMeasurements.clear(),this.helpTooltip.destroy(),this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose(),this.measurementChangedHandler=void 0,this.predefinedMeasurements.clear()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setMeasurementSourceChangedHandler(e){this.measurementChangedHandler=e}setPredefinedMeasurements(e){this.updatePredefinedMeasurements(e)}setActiveFeatureStyle(e){const t=Ie(e);this.activeFeatureStyle=(s,...n)=>{const i=s?.getGeometry()?.getType();if(i==="Polygon"||i==="LineString"||i==="Point")return t(s,...n)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){const e=this.source.getFeatures();this.source.clear(),e.forEach(t=>{this.raiseMeasurementsChangeEvent("remove-measurement",t)}),this.predefinedMeasurements.clear();for(const t of this.finishedMeasurements)t.destroy();this.finishedMeasurements.clear()}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",s=this.draw=new ke({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(s);let n,i;s.on("drawstart",o=>{const l=o.feature;l&&(n=this.activeMeasurement=new V("active",l,this),i=l.getGeometry()?.on("change",()=>{n?.updateTooltipContent(),n?.updateTooltipPosition()}))}),s.on("drawend",()=>{if(n&&n===this.activeMeasurement){const o=n;o.updateState("finished"),this.finishedMeasurements.add(o),this.raiseMeasurementsChangeEvent("add-measurement",o.feature),this.activeMeasurement=n=void 0}n=void 0,i&&N(i)}),s.on("drawabort",()=>{n&&(n.destroy(),n===this.activeMeasurement&&(this.activeMeasurement=void 0),n=void 0),i&&N(i)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.activeMeasurement=B(this.activeMeasurement)}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,s=St(this.messages,this.activeMeasurement);t.setText(s),t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}updatePredefinedMeasurements(e){const t=e.filter(n=>!this.predefinedMeasurements.has(n)),s=[];for(const n of this.predefinedMeasurements.keys())e.includes(n)||s.push(n);t.forEach(n=>{const i=new Te(n);this.source.addFeature(i);const o=new V("finished",i,this);this.finishedMeasurements.add(o),this.predefinedMeasurements.set(n,o),this.raiseMeasurementsChangeEvent("add-measurement",i)}),s.forEach(n=>{const i=this.predefinedMeasurements.get(n);i&&(this.source.removeFeature(i.feature),this.finishedMeasurements.delete(i),i.destroy(),this.raiseMeasurementsChangeEvent("remove-measurement",i.feature)),this.predefinedMeasurements.delete(n)})}raiseMeasurementsChangeEvent(e,t){const s=t.getGeometry();this.measurementChangedHandler&&s&&this.measurementChangedHandler({kind:e,geometry:(s instanceof L,s)})}}class V{controller;feature;_state;tooltip;constructor(e,t,s){this.controller=s,this._state=e,this.feature=t,this.tooltip=Pt(this.olMap),this.updateTooltipContent(),this.updateTooltipPosition(),this.tooltip.setActive(e==="active")}destroy(){this.tooltip.destroy()}get state(){return this._state}updateState(e){this._state!==e&&(this._state=e,this.tooltip.setActive(e==="active"))}updateTooltipContent(){const e=this.feature.getGeometry();if(!e)return;const t=this.olMap.getView().getProjection();let s;e instanceof L?s=Et(e,t,this.messages):e instanceof O&&(s=bt(e,t,this.messages)),s&&this.tooltip.setHtml(s)}updateTooltipPosition(){const e=this.feature.getGeometry();if(!e)return;let t;if(e instanceof L)t=e.getInteriorPoint().getCoordinates()||null;else if(e instanceof O)t=e.getLastCoordinate()||null;else return;this.tooltip.overlay.setPosition(t)}get olMap(){return this.controller.olMap}get messages(){return this.controller.messages}}const W=[0,-15],vt=[0,-7];function xt(r){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const s=new se({element:e,offset:[15,0],positioning:"center-left"});return r.addOverlay(s),{overlay:s,element:e,destroy(){r.removeOverlay(s)},setText(n){t.textContent=n},setHtml(n){t.innerHTML=n}}}function Pt(r){const e=document.createElement("div");e.role="tooltip",e.className="measurement-tooltip measurement-active-tooltip printing-hide";const t=document.createElement("span");e.appendChild(t);const s=new se({element:e,offset:W,positioning:"bottom-center",stopEvent:!1,insertFirst:!1});return r.addOverlay(s),{overlay:s,element:e,destroy(){r.removeOverlay(s)},setActive(n){n?(e.className="measurement-tooltip measurement-active-tooltip printing-hide",s.setOffset(W)):(e.className="measurement-tooltip measurement-finished-tooltip",s.setOffset(vt))},setText(n){t.textContent=n},setHtml(n){t.innerHTML=n}}}function St(r,e){if(e){const t=e.feature.getGeometry();if(t instanceof L||t instanceof O)return r.getContinueMessage()}return r.getHelpMessage()}function Et(r,e,t){const s=je(r,{projection:e});let n;return s>=1e6?n=`${t.formatNumber(s/1e6)} km<sup>2</sup>`:n=`${t.formatNumber(s)} m<sup>2</sup>`,n}function bt(r,e,t){const s=Ae(r,{projection:e});let n;return s>=1e3?n=`${t.formatNumber(s/1e3)} km`:n=`${t.formatNumber(s)} m`,n}const qt=r=>{const e=yt(),{containerProps:t}=E("measurement",r),[s,n]=m.useState("distance"),i=u=>e.formatMessage({id:u}),o=b(r),l=wt(o.map,r,e);m.useEffect(()=>{if(l)return l.startMeasurement(s),()=>{l.stopMeasurement()}},[l,s]);function c(u){if(u==="distance"||u==="area")n(u);else throw new Error(`Unexpected measurement type: '${u}'.`)}function d(){l?.clearMeasurements()}return a.jsxs(v,{...t,children:[a.jsx(S,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),a.jsx(_,{mb:4,alignItems:"center",children:a.jsxs(D,{mb:2,children:[a.jsx(H,{mb:1,children:i("measurementLabel")}),a.jsxs($,{value:s,onChange:u=>c(u.target.value),className:"measurement-select",children:[a.jsx("option",{value:"distance",children:i("distance")}),a.jsx("option",{value:"area",children:i("area")})]})]})}),a.jsx(J,{padding:2,className:"measurement-delete-button",onClick:d,width:"100%",children:i("deleteMeasurementLabel")})]})};function wt(r,e,t){const{activeFeatureStyle:s,finishedFeatureStyle:n,onMeasurementsChange:i,predefinedMeasurements:o}=e,[l,c]=m.useState(void 0);return m.useEffect(()=>{if(!r)return;const d=new Mt(r.olMap,{getContinueMessage(){return t.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return t.formatMessage({id:"tooltips.help"})},formatNumber(u){return t.formatNumber(u,{maximumFractionDigits:2})}});return c(d),()=>{d.destroy(),c(void 0)}},[r,t]),m.useEffect(()=>{l?.setActiveFeatureStyle(s??Ct())},[l,s]),m.useEffect(()=>{l?.setFinishedFeatureStyle(n??Ft())},[l,n]),m.useEffect(()=>{l?.setMeasurementSourceChangedHandler(i)},[l,i]),m.useEffect(()=>{l?.setPredefinedMeasurements(o??[])},[l,o]),l}function Ct(){return[new I({stroke:new C({color:"#fff",lineDash:[10,10],width:5})}),new I({fill:new A({color:"rgba(0,0,0,0.15)"}),stroke:new C({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new Oe({radius:5,stroke:new C({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new A({color:"rgba(255, 255, 255, 0.2)"})})})]}function Ft(){return[new I({stroke:new C({color:"#fff",width:5})}),new I({stroke:new C({color:"#0b96fc",width:3}),fill:new A({color:"rgba(11,150,252,0.15)"})})]}const ae="@open-pioneer/printing",le=q.bind(void 0,ae),Nt=F.bind(void 0,ae),Lt="map";class It{olMap;i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,t,s){this.olMap=e,this.printingService=t,this.i18n=s}destroy(){this.reset()}setViewPadding(e){this.viewPadding=e}async handleMapExport(e){if(this.olMap)try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const t=this.printMap.getCanvas();if(t)e.fileFormat=="png"?await this.exportMapInPNG(t,e):await this.exportMapInPDF(t,e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Re(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(e){const t=e.title||"",s=e.title||Lt;return{title:t,fileName:s}}async exportMapInPNG(e,t){const s=document.createElement("canvas");s.width=e.width,s.height=e.height+50,s.style.backgroundColor="#fff";const n=s.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:i,fileName:o}=this.getTitleAndFileName(t);n.fillStyle="#fff",n.fillRect(0,0,s.width,s.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const l=s.width/2;n.fillText(i,l,20),n.drawImage(e,0,50);const c=document.createElement("a");c.setAttribute("download",o+".png");const d=$e(s);if(!d)throw new Error("Failed to get image data URL");c.href=d,c.click()}async exportMapInPDF(e,t){const{jsPDF:s}=await Ke(async()=>{const{jsPDF:j}=await import("./BbaoeC_R5Std.js");return{jsPDF:j}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),n=new s({orientation:"landscape",unit:"mm",format:"a4"}),i=n.internal.pageSize.getWidth(),o=n.internal.pageSize.getHeight(),l=15,c=20,d=o-c;n.setFontSize(20);const{title:u,fileName:f}=this.getTitleAndFileName(t);n.text(u,i/2,l,{align:"center"});const y=e.width/e.height;let p=d,M=p*y;M>=i&&(M=i,p=M/y);const h=(i-M)/2,x=c+(d-p)/2;n.addImage(e,"",h,x,M,p),n.save(f+".pdf")}}const Tt=ge("printing"),Qt=r=>{const e=Nt(),{viewPadding:t="auto"}=r,{containerProps:s}=E("printing",r),[n,i]=m.useState("pdf"),[o,l]=m.useState(""),[c,d]=m.useState(!1),u=le("notifier.NotificationService"),{map:f}=b(r),y=jt(f,e,t);function p(h){(h==="png"||h==="pdf")&&i(h)}function M(){c||!y||(d(!0),y.handleMapExport({title:o,fileFormat:n}).catch(h=>{const x=e.formatMessage({id:"printingFailed"});u.notify({level:"error",message:x}),Tt.error("Failed to print the map",h)}).finally(()=>{d(!1)}))}return a.jsx(v,{...s,children:a.jsxs(v,{as:"form",m:2,alignItems:"center",onSubmit:h=>{h.preventDefault(),M()},children:[a.jsxs(_,{as:D,mb:2,children:[a.jsx(H,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),a.jsx(R,{placeholder:e.formatMessage({id:"input.placeholder"}),value:o,onChange:h=>{l(h.target.value)},autoFocus:!0})]}),a.jsxs(_,{as:D,mb:2,children:[a.jsx(H,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),a.jsxs($,{value:n,onChange:h=>p(h.target.value),className:"printing-select",children:[a.jsx("option",{value:"png",children:"PNG"}),a.jsx("option",{value:"pdf",children:"PDF"})]})]}),a.jsx(J,{isLoading:c,loadingText:e.formatMessage({id:"printingMap"}),disabled:c,mt:2,p:2,className:"printing-export-button",type:"submit",width:"100%",children:e.formatMessage({id:"export"})})]})})};function jt(r,e,t){const s=le("printing.PrintingService"),[n,i]=m.useState(void 0);return m.useEffect(()=>{if(!r)return;const o=new It(r.olMap,s,{overlayText:e.formatMessage({id:"printingMap"})});return i(o),()=>{o.destroy(),i(void 0)}},[r,e,s]),m.useEffect(()=>{n?.setViewPadding(t)},[n,t]),n}export{Yt as C,R as I,Jt as L,qt as M,Wt as N,se as O,Qt as P,Xt as S,Zt as a,$ as b};
