const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BGpV6sNzKbKC.js","./CmsKOCeNyeyo.js","./BOXMyqr06QWb.js","./BeGW3nmX4tO2.js","./q4MLRk0u7kxl.js","./39a3VBatk_eA.js","./BMuX_dt1qyjL.js","./Gw82v5PUNK8h.js","./N6gwA50uHdd6.js"])))=>i.map(i=>d[i]);
var ls=Object.defineProperty;var Qe=i=>{throw TypeError(i)};var cs=(i,e,t)=>e in i?ls(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var y=(i,e,t)=>cs(i,typeof e!="symbol"?e+"":e,t),je=(i,e,t)=>e.has(i)||Qe("Cannot "+t);var v=(i,e,t)=>(je(i,e,"read from private field"),t?t.call(i):e.get(i)),x=(i,e,t)=>e.has(i)?Qe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),w=(i,e,t,n)=>(je(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),ie=(i,e,t)=>(je(i,e,"access private method"),t);import{aE as ds,b6 as us,b7 as hs,b8 as gs,aP as fs,aX as ms,b9 as ps,ba as ys,J as _s,bb as vs,bc as Ss,bd as xs,be as Ms,bf as Et,bg as ws,bh as bs,a as ne,b as Ie,aL as we,bi as et,bj as Y,a9 as tt,G as R,bk as Ne,a_ as te,an as st,bl as xe,bm as nt,bn as j,p as C,bo as z,bp as Ge,bq as Es,br as Cs,z as Ps,bs as Ve,bt as Fs,bu as Ls,bv as Ct,ao as Pt,bw as Is,bx as Ts,by as it,bz as ks,bA as rt,bB as As,bC as ot,j as F,r as Ue,a$ as We,bD as Ft,bE as js,b0 as Ns,f as ze,u as q,aZ as $,i as U,bF as Os,b3 as Te,bG as Ds,am as le,bH as Rs,bI as Gs,c as be,ax as oe,F as He,C as Vs,bJ as at,bK as Hs,bL as lt,k as ct}from"./q4MLRk0u7kxl.js";import{h as Ke,u as Lt,o as It,m as Tt,j as u,g as V,n as Bs,p as $s,r as m,t as re,q as dt,s as Us,v as Ws,w as zs,c as ve,d as kt,B as P,x as ut,b as At,C as Ks,y as qs,i as jt,z as Nt,V as Ys,l as Js,I as Xs}from"./BeGW3nmX4tO2.js";import{G as Ot,i as Zs,T as ht}from"./Bh6kFNuDWsIw.js";import{a as Qs}from"./UlulYB4e5zqK.js";import{D as Dt,S as en,I as tn,c as sn,a as nn}from"./BMa7TTlUnkcm.js";import{u as B}from"./39a3VBatk_eA.js";import{u as W,c as N,s as Rt}from"./BOXMyqr06QWb.js";import{T as se,L as rn}from"./DM7y0OoBz9e5.js";import{c as Gt}from"./Dc3xe-fbgKeJ.js";import{L as Be}from"./D3gFeNVkNTAB.js";import{u as Vt,F as ce}from"./BMuX_dt1qyjL.js";import{F as de}from"./cMbQJw1ZoqBe.js";import{H as Ee}from"./D1wuBnUV5g92.js";import{G as qe,F as on}from"./N6gwA50uHdd6.js";import{h as an}from"./DKlkM3Rq-R3t.js";import{_ as ln}from"./CmsKOCeNyeyo.js";import{s as cn}from"./BknMP--fbInd.js";const Ye=Ke(function(e,t){const{htmlSize:n,...s}=e,r=Lt("Input",s),a=It(s),o=Vt(a),l=Tt("chakra-input",e.className);return u.jsx(V.input,{size:n,...o,__css:r.field,ref:t,className:l})});Ye.displayName="Input";Ye.id="Input";const Ht=Ke(function(e,t){const{children:n,placeholder:s,className:r,...a}=e;return u.jsxs(V.select,{...a,ref:t,className:Tt("chakra-select",r),children:[s&&u.jsx("option",{value:"",children:s}),n]})});Ht.displayName="SelectField";const Je=Ke((i,e)=>{const t=Lt("Select",i),{rootProps:n,placeholder:s,icon:r,color:a,height:o,h:l,minH:c,minHeight:d,iconColor:h,iconSize:f,...g}=It(i),[p,_]=cn(g,Bs),M=Vt(_),L={width:"100%",height:"fit-content",position:"relative",color:a},I={paddingEnd:"2rem",...t.field,_focus:{zIndex:"unset",...t.field?._focus}};return u.jsxs(V.div,{className:"chakra-select__wrapper",__css:L,...p,...n,children:[u.jsx(Ht,{ref:e,height:l??o,minH:c??d,placeholder:s,...M,__css:I,children:i.children}),u.jsx(Bt,{"data-disabled":$s(M.disabled),...(h||a)&&{color:h||a},__css:t.icon,...f&&{fontSize:f},children:r})]})});Je.displayName="Select";const dn=i=>u.jsx("svg",{viewBox:"0 0 24 24",...i,children:u.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),un=V("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Bt=i=>{const{children:e=u.jsx(dn,{}),...t}=i,n=m.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return u.jsx(un,{...t,className:"chakra-select__icon-wrapper",children:m.isValidElement(e)?n:null})};Bt.displayName="SelectIcon";function hn(i,e){const t=i??"bottom";return{"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[t]?.[e]??t}function gn(i,e){const t=s=>({...e,...s,position:hn(s?.position??e?.position,i)}),n=s=>{const r=t(s),a=Us(r);return re.notify(a,r)};return n.update=(s,r)=>{re.update(s,t(r))},n.promise=(s,r)=>{const a=n({...r.loading,status:"loading",duration:null});s.then(o=>n.update(a,{status:"success",duration:5e3,...dt(r.success,o)})).catch(o=>n.update(a,{status:"error",duration:5e3,...dt(r.error,o)}))},n.closeAll=re.closeAll,n.close=re.close,n.isActive=re.isActive,n}function fn(i){const{theme:e}=Ws(),t=zs();return m.useMemo(()=>gn(e.direction,{...t,...i}),[i,e.direction,t])}const b={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class ke extends ds{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+us,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(b.ELEMENT,this.handleElementChanged),this.addChangeListener(b.MAP,this.handleMapChanged),this.addChangeListener(b.OFFSET,this.handleOffsetChanged),this.addChangeListener(b.POSITION,this.handlePositionChanged),this.addChangeListener(b.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(b.ELEMENT)}getId(){return this.id}getMap(){return this.get(b.MAP)||null}getOffset(){return this.get(b.OFFSET)}getPosition(){return this.get(b.POSITION)}getPositioning(){return this.get(b.POSITIONING)}handleElementChanged(){hs(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),gs(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=fs(e,ms.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(b.ELEMENT,e)}setMap(e){this.set(b.MAP,e)}setOffset(e){this.set(b.OFFSET,e)}setPosition(e){this.set(b.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(b.POSITION))return;const n=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),r=this.getRect(s,[ps(s),ys(s)]);e=e||{};const a=e.margin===void 0?20:e.margin;if(!_s(n,r)){const o=r[0]-n[0],l=n[2]-r[2],c=r[1]-n[1],d=n[3]-r[3],h=[0,0];if(o<0?h[0]=o-a:l<0&&(h[0]=Math.abs(l)+a),c<0?h[1]=c-a:d<0&&(h[1]=Math.abs(d)+a),h[0]!==0||h[1]!==0){const f=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(f);if(!g)return;const p=[g[0]+h[0],g[1]+h[1]],_=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(p),duration:_.duration,easing:_.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),s=n.left+window.pageXOffset,r=n.top+window.pageYOffset;return[s,r,s+t[0],r+t[1]]}setPositioning(e){this.set(b.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(n,s)}updateRenderedPosition(e,t){const n=this.element.style,s=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const a=Math.round(e[0]+s[0])+"px",o=Math.round(e[1]+s[1])+"px";let l="0%",c="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?c="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(c="-50%");const d=`translate(${l}, ${c}) translate(${a}, ${o})`;this.rendered.transform_!=d&&(this.rendered.transform_=d,n.transform=d)}getOptions(){return this.options}}const ur=vs,gt=0,ae=1,ft=[0,0,0,0],X=[],Oe={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class De extends Pt{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class mn extends Ss{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:xs,this.defaultDeleteCondition_=function(n){return Ms(n)&&Et(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:ws,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new bs,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new ne({source:new Ie({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:yn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new we(this.source_.getFeatures()),this.source_.addEventListener(et.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(et.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Y.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Y.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(tt.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new we;const n=this.featuresBeingModified_.getArray();for(let s=0,r=t.length;s<r;++s){const a=t[s];for(let o=0,l=a.length;o<l;++o){const c=a[o].feature;c&&!n.includes(c)&&this.featuresBeingModified_.push(c)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new De(Oe.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(tt.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(s){e===s.feature&&n.push(s)});for(let s=n.length-1;s>=0;--s){const r=n[s];for(let a=this.dragSegments_.length-1;a>=0;--a)this.dragSegments_[a][0]===r&&this.dragSegments_.splice(a,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),s={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s],o={feature:e,geometry:t,depth:[s],index:s,segment:[a,a]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length-1;s<r;++s){const a=n.slice(s,s+2),o={feature:e,geometry:t,index:s,segment:a};this.rBush_.insert(R(a),o)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let o=0,l=a.length-1;o<l;++o){const c=a.slice(o,o+2),d={feature:e,geometry:t,depth:[s],index:o,segment:c};this.rBush_.insert(R(c),d)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let o=0,l=a.length-1;o<l;++o){const c=a.slice(o,o+2),d={feature:e,geometry:t,depth:[s],index:o,segment:c};this.rBush_.insert(R(c),d)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let o=0,l=a.length;o<l;++o){const c=a[o];for(let d=0,h=c.length-1;d<h;++d){const f=c.slice(d,d+2),g={feature:e,geometry:t,depth:[o,s],index:d,segment:f};this.rBush_.insert(R(f),g)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),s={feature:e,geometry:t,index:gt,segment:[n,n]},r={feature:e,geometry:t,index:ae,segment:[n,n]},a=[s,r];s.featureSegments=a,r.featureSegments=a,this.rBush_.insert(Ne(n),s);let o=t;this.rBush_.insert(o.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let s=0;s<n.length;++s){const r=n[s],a=this.SEGMENT_WRITERS_[r.getType()];a(e,r)}}createOrUpdateVertexFeature_(e,t,n){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new te(new st(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",n),s}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==xe.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=xe.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==xe.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],s=[];for(let r=0,a=this.dragSegments_.length;r<a;++r){const o=this.dragSegments_[r],l=o[0],c=l.feature;n.includes(c)||n.push(c);const d=l.geometry;s.includes(d)||s.push(d);const h=l.depth;let f;const g=l.segment,p=o[1];for(;t.length<d.getStride();)t.push(g[p][t.length]);switch(d.getType()){case"Point":f=t,g[0]=t,g[1]=t;break;case"MultiPoint":f=d.getCoordinates(),f[l.index]=t,g[0]=t,g[1]=t;break;case"LineString":f=d.getCoordinates(),f[l.index+p]=t,g[p]=t;break;case"MultiLineString":f=d.getCoordinates(),f[h[0]][l.index+p]=t,g[p]=t;break;case"Polygon":f=d.getCoordinates(),f[h[0]][l.index+p]=t,g[p]=t;break;case"MultiPolygon":f=d.getCoordinates(),f[h[1]][h[0]][l.index+p]=t,g[p]=t;break;case"Circle":if(g[0]=t,g[1]=t,l.index===gt)this.changingFeature_=!0,d.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let _=nt(j(d.getCenter()),j(t));d.setRadius(_),this.changingFeature_=!1}break}f&&this.setGeometryCoordinates_(d,f)}this.createOrUpdateVertexFeature_(t,n,s)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(n){e.map.getView().getProjection();const s=[],r=n.getGeometry().getCoordinates(),a=R([r]),o=this.rBush_.getInExtent(a),l={};o.sort(pn);for(let c=0,d=o.length;c<d;++c){const h=o[c],f=h.segment;let g=C(h.geometry);const p=h.depth;if(p&&(g+="-"+p.join("-")),l[g]||(l[g]=new Array(2)),h.geometry.getType()==="Circle"&&h.index===ae){const _=pt(t,h);z(_,r)&&!l[g][0]&&(this.dragSegments_.push([h,0]),l[g][0]=h);continue}if(z(f[0],r)&&!l[g][0]){this.dragSegments_.push([h,0]),l[g][0]=h;continue}if(z(f[1],r)&&!l[g][1]){if(l[g][0]&&l[g][0].index===0){let _=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":_=_[p[1]];case"Polygon":if(h.index!==_[p[0]].length-2)continue;break}}this.dragSegments_.push([h,1]),l[g][1]=h;continue}C(f)in this.vertexSegments_&&!l[g][0]&&!l[g][1]&&this.insertVertexCondition_(e)&&s.push(h)}s.length&&this.willModifyFeatures_(e,[s]);for(let c=s.length-1;c>=0;--c)this.insertVertex_(s[c],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],s=n.geometry;if(s.getType()==="Circle"){const r=s.getCenter(),a=n.featureSegments[0],o=n.featureSegments[1];a.segment[0]=r,a.segment[1]=r,o.segment[0]=r,o.segment[1]=r,this.rBush_.update(Ne(r),a);let l=s;this.rBush_.update(l.getExtent(),o)}else this.rBush_.update(R(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new De(Oe.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,n){const s=n||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(l,c){return mt(s,l)-mt(s,c)};let a,o;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(c,d,h)=>{h&&h.getType()==="Point"&&(h=new st(Ge(h.getCoordinates())));const f=h||c.getGeometry();if(c instanceof te&&this.features_.getArray().includes(c)){o=f;const g=c.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:c,geometry:o,segment:[g,g]}]}return!0},{layerFilter:l})}if(!a){const l=Es(Ne(s,ft)),c=t.getView().getResolution()*this.pixelTolerance_,d=Cs(Ps(l,c,ft));a=this.rBush_.getInExtent(d)}if(a&&a.length>0){const l=a.sort(r)[0],c=l.segment;let d=pt(s,l);const h=t.getPixelFromCoordinate(d);let f=nt(e,h);if(o||f<=this.pixelTolerance_){const g={};if(g[C(c)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-s[0],this.delta_[1]=d[1]-s[1]),l.geometry.getType()==="Circle"&&l.index===ae)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[l.feature],[l.geometry]);else{const p=t.getPixelFromCoordinate(c[0]),_=t.getPixelFromCoordinate(c[1]),M=Ve(h,p),L=Ve(h,_);f=Math.sqrt(Math.min(M,L)),this.snappedToVertex_=f<=this.pixelTolerance_,this.snappedToVertex_&&(d=M>L?c[1]:c[0]),this.createOrUpdateVertexFeature_(d,[l.feature],[l.geometry]);const I={};I[C(l.geometry)]=!0;for(let T=1,O=a.length;T<O;++T){const E=a[T].segment;if(z(c[0],E[0])&&z(c[1],E[1])||z(c[0],E[1])&&z(c[1],E[0])){const D=C(a[T].geometry);D in I||(I[D]=!0,g[C(E)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,s=e.feature,r=e.geometry,a=e.depth,o=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[a[0]].splice(o+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[a[0]].splice(o+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[a[1]][a[0]].splice(o+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(o+1,0,t);break;default:return}this.setGeometryCoordinates_(r,l);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(r,o,a,1);const d={segment:[n[0],t],feature:s,geometry:r,depth:a,index:o};c.insert(R(d.segment),d),this.dragSegments_.push([d,1]);const h={segment:[t,n[1]],feature:s,geometry:r,depth:a,index:o+1};c.insert(R(h.segment),h),this.dragSegments_.push([h,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=xe.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new De(Oe.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let n=!1,s,r,a,o,l,c,d,h,f,g,p;for(l=e.length-1;l>=0;--l)a=e[l],g=a[0],p=C(g.feature),g.depth&&(p+="-"+g.depth.join("-")),p in t||(t[p]={}),a[1]===0?(t[p].right=g,t[p].index=g.index):a[1]==1&&(t[p].left=g,t[p].index=g.index+1);for(p in t){switch(f=t[p].right,d=t[p].left,c=t[p].index,h=c-1,d!==void 0?g=d:g=f,h<0&&(h=0),o=g.geometry,r=o.getCoordinates(),s=r,n=!1,o.getType()){case"MultiLineString":r[g.depth[0]].length>2&&(r[g.depth[0]].splice(c,1),n=!0);break;case"LineString":r.length>2&&(r.splice(c,1),n=!0);break;case"MultiPolygon":s=s[g.depth[1]];case"Polygon":s=s[g.depth[0]],s.length>4&&(c==s.length-1&&(c=0),s.splice(c,1),n=!0,c===0&&(s.pop(),s.push(s[0]),h=s.length-1));break}if(n){this.setGeometryCoordinates_(o,r);const _=[];if(d!==void 0&&(this.rBush_.remove(d),_.push(d.segment[0])),f!==void 0&&(this.rBush_.remove(f),_.push(f.segment[1])),d!==void 0&&f!==void 0){const M={depth:g.depth,feature:g.feature,geometry:g.geometry,index:h,segment:_};this.rBush_.insert(R(M.segment),M)}this.updateSegmentIndices_(o,c,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,s){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(n===void 0||r.depth===void 0||Fs(r.depth,n))&&r.index>t&&(r.index+=s)})}}function pn(i,e){return i.index-e.index}function mt(i,e,t){const n=e.geometry;if(n.getType()==="Circle"){let r=n;if(e.index===ae){const a=Ve(r.getCenter(),j(i)),o=Math.sqrt(a)-r.getRadius();return o*o}}const s=j(i);return X[0]=j(e.segment[0]),X[1]=j(e.segment[1]),Is(s,X)}function pt(i,e,t){const n=e.geometry;if(n.getType()==="Circle"&&e.index===ae)return Ge(n.getClosestPoint(j(i)));const s=j(i);return X[0]=j(e.segment[0]),X[1]=j(e.segment[1]),Ge(Ls(s,X))}function yn(){const i=Ct();return function(e,t){return i.Point}}const _n={SELECT:"select"};class vn extends Pt{constructor(e,t,n,s){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=s}}const Me={};class $t extends Ts{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:Et,this.addCondition_=e.addCondition?e.addCondition:it,this.removeCondition_=e.removeCondition?e.removeCondition:it,this.toggleCondition_=e.toggleCondition?e.toggleCondition:ks,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:rt,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:Sn(),this.features_=e.features||new we;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(s){return n.includes(s)}}else t=rt;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[C(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[C(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(Y.ADD,this.boundAddFeature_),this.features_.addEventListener(Y.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Y.ADD,this.boundAddFeature_),this.features_.removeEventListener(Y.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.getMap().getAllLayers().find(function(s){if(s instanceof ne&&s.getSource()&&s.getSource().hasFeature(t))return s});n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=C(e);t in Me||(Me[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let s=t.length-1;s>=0;--s){const r=t[s];if(r!==this&&r instanceof $t&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const n=C(e);e.setStyle(Me[n]),delete Me[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[C(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),s=this.toggleCondition_(e),r=!t&&!n&&!s,a=e.map,o=this.getFeatures(),l=[],c=[];if(r){As(this.featureLayerAssociation_),a.forEachFeatureAtPixel(e.pixel,(d,h)=>{if(!(!(d instanceof te)||!this.filter_(d,h)))return this.addFeatureLayerAssociation_(d,h),c.push(d),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let d=o.getLength()-1;d>=0;--d){const h=o.item(d),f=c.indexOf(h);f>-1?c.splice(f,1):(o.remove(h),l.push(h))}c.length!==0&&o.extend(c)}else{a.forEachFeatureAtPixel(e.pixel,(d,h)=>{if(!(!(d instanceof te)||!this.filter_(d,h)))return(t||s)&&!o.getArray().includes(d)?(this.addFeatureLayerAssociation_(d,h),c.push(d)):(n||s)&&o.getArray().includes(d)&&(l.push(d),this.removeFeatureLayerAssociation_(d)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let d=l.length-1;d>=0;--d)o.remove(l[d]);o.extend(c)}return(c.length>0||l.length>0)&&this.dispatchEvent(new vn(_n.SELECT,c,l,e)),!0}}function Sn(){const i=Ct();return ot(i.Polygon,i.LineString),ot(i.GeometryCollection,i.LineString),function(e){return e.getGeometry()?i[e.getGeometry().getType()]:null}}async function xn(i,e,t,n){const r=n.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),a=await i.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${r}>`}});if(!a||!a.ok||a.status!==201)throw new Error("Request failed: "+a.status);const o=a.headers.get("location");if(!o)throw new Error("Request failed: no Location response header");const l=o.substring(o.lastIndexOf("/")+1);return Promise.resolve(l)}async function Mn(i,e,t,n,s){const a=s.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),o=new URL(`${e.toString()}/${t}`),l=await i.fetch(o,{method:"PATCH",body:JSON.stringify({type:"Feature",properties:{},geometry:n}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${a}>`}});if(!l||!l.ok||l.status!==204)throw new Error("Request failed: "+l.status);return Promise.resolve(t)}function Ut(i,e){const t=document.createElement("div");t.className="editing-tooltip editing-tooltip-hidden",t.role="tooltip";const n=document.createElement("span");n.textContent=e,t.appendChild(n);const s=new ke({element:t,offset:[15,0],positioning:"center-left"}),r=i.on("pointermove",a=>{a.dragging||s.setPosition(a.coordinate)});return i.addOverlay(s),{destroy(){F(r),i.removeOverlay(s)},setVisible(a){t.classList.toggle("editing-tooltip-hidden",!a)},setText(a){n.textContent=a}}}function Wt(i){let e=yt(i.polygon);Array.isArray(e)&&(e=e[0]);let t=yt(i.vertex);Array.isArray(t)&&(t=t[0]);const n=[];return e&&n.push(e),t&&(t.setGeometry(wn),n.push(t)),n}const wn=i=>{if(i){const e=i.getGeometry();if(e&&e.getType()==="Polygon"){const t=e.getCoordinates()[0];if(t)return new Qs(t)}}},yt=i=>{const e=new te,n=new ne({style:i}).getStyleFunction();if(!n)throw new Error("can't retrieve style function");const s=n(e,1);if(!s)throw new Error("can't retrieve styles from feature style function");return Array.isArray(s)&&s.length?s.length>1?s:s[0]:s},bn=ve("editing:EditingCreateWorkflowImpl");var G;class En{constructor(e){x(this,G);y(this,"_httpService");y(this,"_intl");y(this,"_map");y(this,"_polygonStyle");y(this,"_vertexStyle");y(this,"_state");y(this,"_editLayerURL");y(this,"_featureId");y(this,"_editingSource");y(this,"_editingLayer");y(this,"_drawInteraction");y(this,"_olMap");y(this,"_tooltip");y(this,"_enterHandler");y(this,"_escapeHandler");y(this,"_error");y(this,"_interactionListener");y(this,"_mapListener");this._httpService=e.httpService,this._intl=e.intl,this._polygonStyle=e.polygonStyle,this._vertexStyle=e.vertexStyle,this._map=e.map,this._olMap=e.map.olMap,this._state=Ue("active:initialized"),this._editLayerURL=e.ogcApiFeatureLayerUrl,this._editingSource=new Ie,this._editingLayer=new ne({source:this._editingSource,zIndex:We,properties:{name:"editing-layer"}}),this._drawInteraction=new Dt({source:this._editingSource,type:"Polygon",style:Wt({polygon:this._polygonStyle,vertex:this._vertexStyle})}),this._tooltip=Ut(this._olMap,this._intl.formatMessage({id:"create.tooltip.begin"})),this._enterHandler=t=>{if((t.code==="Enter"||t.code==="NumpadEnter")&&t.target===this._olMap.getTargetElement()){const n=this._drawInteraction.getOverlay().getSource()?.getFeatures()??[];n[0]&&n[0].getGeometry().getCoordinates()[0].length>4&&this.triggerSave()}},this._escapeHandler=t=>{t.code==="Escape"&&t.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state.value}_setState(e){this._state.value=e}_save(e){this._setState("active:saving");const t=this._editLayerURL,n=e.getGeometry();if(!n){this._destroy(),this._error=new Error("no geometry available"),v(this,G)?.reject(this._error);return}const s=this._olMap.getView().getProjection(),a=new Ot({dataProjection:s}).writeGeometryObject(n,{rightHanded:!0,decimals:10});this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),xn(this._httpService,t,a,s).then(o=>{this._featureId=o,this._destroy(),v(this,G)?.resolve({featureId:this._featureId})}).catch(o=>{bn.error(o),this._destroy(),this._error=new Error("Failed to save feature",{cause:o}),v(this,G)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._drawInteraction);const e=Ft(()=>{const s=this._map.container;if(s)return s.addEventListener("keydown",this._enterHandler,!1),s.addEventListener("keydown",this._escapeHandler,!1),()=>{s.removeEventListener("keydown",this._enterHandler),s.removeEventListener("keydown",this._escapeHandler)}});this._tooltip.setVisible(!0);const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.continue"}))}),n=this._drawInteraction.on("drawend",s=>{const r=s.feature;if(!r){this._destroy(),this._error=new Error("no feature available"),v(this,G)?.reject(this._error);return}this._save(r)});this._interactionListener.push(t,n),this._mapListener.push(e)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.begin"})),this._setState("active:initialized")}stop(){this._destroy(),v(this,G)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.forEach(e=>{F(e)}),this._mapListener.forEach(e=>{e.destroy()}),this._setState("destroyed")}triggerSave(){this._drawInteraction.finishDrawing()}whenComplete(){return this._state.value==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(v(this,G)??w(this,G,kt())).promise}}G=new WeakMap;var k;class Cn{constructor(e){x(this,k);y(this,"_httpService");y(this,"_intl");y(this,"_map");y(this,"_polygonStyle");y(this,"_vertexStyle");y(this,"_state");y(this,"_editLayerURL");y(this,"_featureId");y(this,"_initialFeature");y(this,"_editFeature");y(this,"_editingSource");y(this,"_editingLayer");y(this,"_modifyInteraction");y(this,"_olMap");y(this,"_tooltip");y(this,"_enterHandler");y(this,"_escapeHandler");y(this,"_error");y(this,"_interactionListener");y(this,"_mapListener");this._httpService=e.httpService,this._intl=e.intl,this._polygonStyle=e.polygonStyle,this._vertexStyle=e.vertexStyle,this._map=e.map,this._olMap=e.map.olMap,this._state=Ue("active:initialized"),this._editLayerURL=e.ogcApiFeatureLayerUrl,this._initialFeature=e.feature.clone(),this._initialFeature.setId(e.feature.getId()),this._editFeature=e.feature.clone(),this._editFeature.setId(e.feature.getId()),this._editFeature.setStyle(Wt({polygon:this._polygonStyle,vertex:this._vertexStyle})),this._editingSource=new Ie({features:new we([this._editFeature])}),this._editingLayer=new ne({source:this._editingSource,zIndex:We,properties:{name:"editing-layer"}}),this._modifyInteraction=new mn({source:this._editingSource}),this._tooltip=Ut(this._olMap,this._intl.formatMessage({id:"create.tooltip.deselect"})),this._enterHandler=t=>{if((t.code==="Enter"||t.code==="NumpadEnter")&&t.target===this._olMap.getTargetElement()){const n=this._editingSource.getFeatures()[0];if(!n)throw Error("no updated feature found");this._save(n)}},this._escapeHandler=t=>{t.code==="Escape"&&t.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getModifyInteraction(){return this._modifyInteraction}getState(){return this._state.value}_setState(e){this._state.value=e}_save(e){this._setState("active:saving");const t=this._editLayerURL;if(this._featureId=e.getId()?.toString(),!this._featureId){this._destroy(),this._error=new Error("no feature id available"),v(this,k)?.reject(this._error);return}const n=e?.getGeometry();if(!n){this._destroy(),this._error=new Error("no geometry available"),v(this,k)?.reject(this._error);return}const s=this._olMap.getView().getProjection(),a=new Ot({dataProjection:s}).writeGeometryObject(n,{rightHanded:!0,decimals:10});this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),Mn(this._httpService,t,this._featureId,a,s).then(o=>{this._destroy(),v(this,k)?.resolve({featureId:o})}).catch(o=>{this._destroy(),this._error=new Error("Failed to save feature",{cause:o}),v(this,k)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._modifyInteraction);const e=this._editingSource.getFeatures()[0];if(e&&!e.getId()?.toString()){this._destroy(),this._error=new Error("no feature id available"),v(this,k)?.reject(this._error);return}const t=Ft(()=>{const r=this._map.container;if(r)return r.addEventListener("keydown",this._enterHandler,!1),r.addEventListener("keydown",this._escapeHandler,!1),()=>{r.removeEventListener("keydown",this._enterHandler),r.removeEventListener("keydown",this._escapeHandler)}});this._tooltip.setVisible(!0);const n=this._map.olMap.on("click",r=>{const a=r.coordinate,o=r.originalEvent.altKey,l=this._editingSource.getFeaturesAtCoordinate(a);o||l.length===0&&this.triggerSave()}),s=this._modifyInteraction.on("modifystart",()=>{this._setState("active:drawing")});this._interactionListener.push(n,s),this._mapListener.push(t)}reset(){const e=this._initialFeature.getGeometry()?.clone(),t=this._editingSource.getFeatures()[0];if(!t)throw Error("no updated feature found");t.setGeometry(e),this._setState("active:initialized")}stop(){this._destroy(),v(this,k)?.resolve(void 0)}_destroy(){this._editingSource.clear(),this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),this._interactionListener.forEach(e=>{F(e)}),this._mapListener.forEach(e=>{e.destroy()}),this._setState("destroyed")}triggerSave(){const e=this._editingSource.getFeatures()[0];if(!e)throw Error("no updated feature found");this._save(e)}whenComplete(){return this._state.value==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(v(this,k)??w(this,k,kt())).promise}}k=new WeakMap;class hr{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}createFeature(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const n=e.id;let s=this._workflows.get(n);if(s)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return s=new En({map:e,ogcApiFeatureLayerUrl:t,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(n,s),this._connectToWorkflowDestroyEvent(s,n),s}updateFeature(e,t,n){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const s=e.id;let r=this._workflows.get(s);if(r)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return r=new Cn({map:e,ogcApiFeatureLayerUrl:t,feature:n,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(s,r),this._connectToWorkflowDestroyEvent(r,s),r}stop(e){const t=this._workflows.get(e);t&&t.stop()}reset(e){const t=this._workflows.get(e);if(t)t.reset();else throw new Error("No workflow found for mapId: "+e)}_connectToWorkflowDestroyEvent(e,t){const n=js(()=>[e.getState()],([s])=>{s==="destroyed"&&(this._workflows.get(t)===e&&this._workflows.delete(t),n.destroy())})}}var K,H,ue,he,ge,$e;class Pn{constructor(e,t,n){x(this,ge);y(this,"label");x(this,K,Ue({kind:"available"}));x(this,H);x(this,ue);x(this,he);this.label=t,w(this,H,e),w(this,he,n),ie(this,ge,$e).call(this),w(this,ue,v(this,H).on("change:visible",()=>{ie(this,ge,$e).call(this)}))}destroy(){F(v(this,ue))}get status(){return v(this,K).value}async select(e,t){if(e.type!=="extent")throw new Error(`Unsupported selection kind: ${e.type}`);if(v(this,K).value.kind!=="available"||v(this,H).getSource()===null)return[];const n=[];v(this,H).getSource().forEachFeatureIntersectingExtent(e.extent,a=>{if(!a.getGeometry())return;const o={...a.getProperties()};delete o.geometries;const l={id:a.getId()?.toString()||Ns(),geometry:a.getGeometry(),properties:o};n.push(l)});const s=n.filter(a=>a!=null);return s.length>t.maxResults?s.slice(0,t.maxResults):s}}K=new WeakMap,H=new WeakMap,ue=new WeakMap,he=new WeakMap,ge=new WeakSet,$e=function(){const t=v(this,H).getVisible()?{kind:"available"}:{kind:"unavailable",reason:v(this,he)};t.kind!==v(this,K).value.kind&&(v(this,K).value=t)};var fe;class gr{constructor({intl:e}){x(this,fe);w(this,fe,e)}createSelectionSource(e){return new Pn(e.vectorLayer,e.label,v(this,fe).formatMessage({id:"layerNotVisibleReason"}))}}fe=new WeakMap;const Fn="@open-pioneer/notifier",Ln=ze.bind(void 0,Fn),In=Gt({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"}),zt=Gt({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),Tn=!1;function fr(i){const{position:e="top-right"}=i,t=fn(),n=Ln("notifier.NotificationService"),[s,r]=m.useState(!Tn),a=B(l=>{const c=l.level==="error"?u.jsx(zt,{h:"100%",w:"100%"}):void 0;t({position:e,title:l.title,description:l.message||null,status:l.level,isClosable:!0,duration:l.displayDuration??null,icon:c})}),o=B(()=>{t.closeAll()});return m.useEffect(()=>{const l=n.registerHandler({showNotification:a,closeAll:o});return()=>l.destroy()},[s,n,a,o]),u.jsx(u.Fragment,{})}const kn="@open-pioneer/coordinate-viewer",An=q.bind(void 0,kn),jn=4,Nn="decimal",mr=i=>{const{precision:e,displayProjectionCode:t,format:n}=i,{containerProps:s}=$("coordinate-viewer",i),{map:r}=U(i),a=r?.olMap,o=W(()=>r?.projection.getCode()??"",[r]);let{coordinates:l}=Dn(a);l=l&&t?Gn(l,o,t):l;const c=On(l,e,n),d=t||o,h=c?c+" "+d:"";return u.jsx(P,{...s,children:u.jsx(se,{className:"coordinate-viewer-text",children:h})})};function On(i,e,t){const n=An();return i?Rn(i,e,n,t):""}function Dn(i){const[e,t]=m.useState();return m.useEffect(()=>{if(!i)return;const n=i.on("pointermove",s=>{t(s.coordinate)});return()=>F(n)},[i]),{coordinates:e}}function Rn(i,e,t,n){if(i[0]==null||i[1]==null)return"";const s=e??jn,r=n??Nn,[a,o]=i;let l;if(r==="degree"&&isFinite(a)&&isFinite(o)){const[c,d,h]=_t(a,t,s),[f,g,p]=_t(o,t,s),_=`${Math.abs(c)}°${d}'${h}"${0<=c?"(E)":"(W)"}`,M=`${Math.abs(f)}°${g}'${p}"${0<=f?"(N)":"(S)"}`;l=_+" "+M}else{const c=t.formatNumber(a,{maximumFractionDigits:s,minimumFractionDigits:s}),d=t.formatNumber(o,{maximumFractionDigits:s,minimumFractionDigits:s});l=c+" "+d}return l}function _t(i,e,t){const n=Math.floor(i),s=i-n,r=Math.floor(60*s),o=60*(60*s-r),l=e.formatNumber(o,{maximumFractionDigits:t,minimumFractionDigits:t});return[n,r,l]}function Gn(i,e,t){return Os(i,e,t)}const pr=i=>{const{displayMode:e="line"}=i,{containerProps:t}=$("scale-bar",i),{map:n}=U(i),s=m.useRef(null);return m.useEffect(()=>{if(s.current&&n){const r=n.olMap,a=new en({units:"metric",target:s.current,bar:e==="bar"});return r.addControl(a),()=>{r.removeControl(a)}}},[e,n]),u.jsx(P,{...t,ref:s})},Vn="@open-pioneer/scale-viewer",Hn=q.bind(void 0,Vn),yr=i=>{const{containerProps:e}=$("scale-viewer",i),{map:t}=U(i),n=Hn(),s=W(()=>t?.scale??1,[t]),r=s?n.formatNumber(s):void 0;return u.jsx(P,{...e,children:r&&u.jsxs(se,{children:["1:",r]})})},Bn="@open-pioneer/legend",Kt=q.bind(void 0,Bn),_r=i=>{const{showBaseLayers:e=!1}=i,{containerProps:t}=$("legend",i),{map:n}=U(i);return u.jsx(P,{...t,children:n?u.jsx($n,{map:n,showBaseLayers:e}):null})};function $n(i){const{map:e,showBaseLayers:t}=i,s=Wn(e).map(r=>u.jsx(qt,{layer:r,showBaseLayers:t},r.id));return u.jsx(rn,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:s})}function qt(i){const{layer:e,showBaseLayers:t}=i,n=W(()=>e.visible,[e]),s=zn(e);if(!n||!t&&Zs(e)&&Yt(e))return;const r=[];return s?.length&&s.forEach(a=>{r.push(u.jsx(qt,{layer:a,showBaseLayers:t},a.id))}),u.jsxs(u.Fragment,{children:[u.jsx(Un,{layer:e,showBaseLayers:t}),r]})}function Un(i){const e=Kt(),{layer:t,showBaseLayers:n}=i,s=Yt(t),r=Kn(t),a=W(()=>t.legend,[t]);let o;return r?.Component?o=u.jsx(r.Component,{layer:t}):r?.imageUrl?o=u.jsx(vt,{layer:t,imageUrl:r.imageUrl}):a&&(o=u.jsx(vt,{layer:t,imageUrl:a})),o?u.jsxs(P,{as:"li",className:Te("legend-item",`layer-${qn(t.id)}`),children:[n&&s?u.jsx(se,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,o]}):void 0}function vt(i){const e=Kt(),{layer:t,imageUrl:n}=i;return u.jsxs(P,{children:[u.jsx(se,{children:t.title}),u.jsx(tn,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:u.jsx(P,{children:u.jsxs(se,{children:[u.jsx(zt,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function Wn(i){return W(()=>{const e=i.layers.getAllLayers({sortByDisplayOrder:!0})??[];return e.reverse(),e},[i])}function zn(i){return W(()=>{const e=i.sublayers?.getSublayers({sortByDisplayOrder:!0});if(e)return e.reverse(),e},[i])}function Kn(i){return W(()=>i.attributes.legend,[i])}function Yt(i){return!("parentLayer"in i)&&i.isBaseLayer}function qn(i){return i.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function Yn(i){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15.062 12.506l-.284 -.284l3.113 -2.09a1.2 1.2 0 0 0 -.309 -2.228l-13.582 -3.904l3.904 13.563a1.2 1.2 0 0 0 2.228 .308l2.09 -3.093l1.278 1.278"},child:[]},{tag:"path",attr:{d:"M19 22v.01"},child:[]},{tag:"path",attr:{d:"M19 19a2.003 2.003 0 0 0 .914 -3.782a1.98 1.98 0 0 0 -2.414 .483"},child:[]}]})(i)}function vr(i){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 5m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M19 8m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M5 11m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M15 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M6.5 9.5l1.546 -1.311"},child:[]},{tag:"path",attr:{d:"M14 5.5l3 1.5"},child:[]},{tag:"path",attr:{d:"M18.5 10l-1.185 3.318m-1.062 2.972l-.253 .71"},child:[]},{tag:"path",attr:{d:"M13.5 17.5l-7 -5"},child:[]},{tag:"path",attr:{d:"M3 3l18 18"},child:[]}]})(i)}function Sr(i){return qe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 5m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M19 8m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M5 11m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M15 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M6.5 9.5l3.5 -3"},child:[]},{tag:"path",attr:{d:"M14 5.5l3 1.5"},child:[]},{tag:"path",attr:{d:"M18.5 10l-2.5 7"},child:[]},{tag:"path",attr:{d:"M13.5 17.5l-7 -5"},child:[]}]})(i)}const Jn="@open-pioneer/measurement",Xn=q.bind(void 0,Jn);class Zn{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;activeMeasurement;predefinedMeasurements=new Map;finishedMeasurements=new Set;helpTooltip;resources=[];measurementChangedHandler;constructor(e,t){this.olMap=e,this.messages=t;const n=this.source=new Ie;this.layer=new ne({source:n,zIndex:We,properties:{name:"measurement-layer"}}),e.addLayer(this.layer);const s=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){F(s)}});const r=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",r),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",r)}}),this.helpTooltip=ei(this.olMap)}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.activeMeasurement=ut(this.activeMeasurement);for(const e of this.finishedMeasurements)e.destroy();this.finishedMeasurements.clear(),this.helpTooltip.destroy(),this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose(),this.measurementChangedHandler=void 0,this.predefinedMeasurements.clear()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setMeasurementSourceChangedHandler(e){this.measurementChangedHandler=e}setPredefinedMeasurements(e){this.updatePredefinedMeasurements(e)}setActiveFeatureStyle(e){const t=Ds(e);this.activeFeatureStyle=(n,...s)=>{const r=n?.getGeometry()?.getType();if(r==="Polygon"||r==="LineString"||r==="Point")return t(n,...s)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){const e=this.source.getFeatures();this.source.clear(),e.forEach(t=>{this.raiseMeasurementsChangeEvent("remove-measurement",t)}),this.predefinedMeasurements.clear();for(const t of this.finishedMeasurements)t.destroy();this.finishedMeasurements.clear()}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",n=this.draw=new Dt({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let s,r;n.on("drawstart",a=>{const o=a.feature;o&&(s=this.activeMeasurement=new St("active",o,this),r=o.getGeometry()?.on("change",()=>{s?.updateTooltipContent(),s?.updateTooltipPosition()}))}),n.on("drawend",()=>{if(s&&s===this.activeMeasurement){const a=s;a.updateState("finished"),this.finishedMeasurements.add(a),this.raiseMeasurementsChangeEvent("add-measurement",a.feature),this.activeMeasurement=s=void 0}s=void 0,r&&F(r)}),n.on("drawabort",()=>{s&&(s.destroy(),s===this.activeMeasurement&&(this.activeMeasurement=void 0),s=void 0),r&&F(r)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.activeMeasurement=ut(this.activeMeasurement)}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,n=si(this.messages,this.activeMeasurement);t.setText(n),t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}updatePredefinedMeasurements(e){const t=e.filter(s=>!this.predefinedMeasurements.has(s)),n=[];for(const s of this.predefinedMeasurements.keys())e.includes(s)||n.push(s);t.forEach(s=>{const r=new te(s);this.source.addFeature(r);const a=new St("finished",r,this);this.finishedMeasurements.add(a),this.predefinedMeasurements.set(s,a),this.raiseMeasurementsChangeEvent("add-measurement",r)}),n.forEach(s=>{const r=this.predefinedMeasurements.get(s);r&&(this.source.removeFeature(r.feature),this.finishedMeasurements.delete(r),r.destroy(),this.raiseMeasurementsChangeEvent("remove-measurement",r.feature)),this.predefinedMeasurements.delete(s)})}raiseMeasurementsChangeEvent(e,t){const n=t.getGeometry();this.measurementChangedHandler&&n&&this.measurementChangedHandler({kind:e,geometry:(n instanceof le,n)})}}class St{controller;feature;_state;tooltip;constructor(e,t,n){this.controller=n,this._state=e,this.feature=t,this.tooltip=ti(this.olMap),this.updateTooltipContent(),this.updateTooltipPosition(),this.tooltip.setActive(e==="active")}destroy(){this.tooltip.destroy()}get state(){return this._state}updateState(e){this._state!==e&&(this._state=e,this.tooltip.setActive(e==="active"))}updateTooltipContent(){const e=this.feature.getGeometry();if(!e)return;const t=this.olMap.getView().getProjection();let n;e instanceof le?n=ni(e,t,this.messages):e instanceof Be&&(n=ii(e,t,this.messages)),n&&this.tooltip.setHtml(n)}updateTooltipPosition(){const e=this.feature.getGeometry();if(!e)return;let t;if(e instanceof le)t=e.getInteriorPoint().getCoordinates()||null;else if(e instanceof Be)t=e.getLastCoordinate()||null;else return;this.tooltip.overlay.setPosition(t)}get olMap(){return this.controller.olMap}get messages(){return this.controller.messages}}const xt=[0,-15],Qn=[0,-7];function ei(i){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const n=new ke({element:e,offset:[15,0],positioning:"center-left"});return i.addOverlay(n),{overlay:n,element:e,destroy(){i.removeOverlay(n)},setText(s){t.textContent=s},setHtml(s){t.innerHTML=s}}}function ti(i){const e=document.createElement("div");e.role="tooltip",e.className="measurement-tooltip measurement-active-tooltip printing-hide";const t=document.createElement("span");e.appendChild(t);const n=new ke({element:e,offset:xt,positioning:"bottom-center",stopEvent:!1,insertFirst:!1});return i.addOverlay(n),{overlay:n,element:e,destroy(){i.removeOverlay(n)},setActive(s){s?(e.className="measurement-tooltip measurement-active-tooltip printing-hide",n.setOffset(xt)):(e.className="measurement-tooltip measurement-finished-tooltip",n.setOffset(Qn))},setText(s){t.textContent=s},setHtml(s){t.innerHTML=s}}}function si(i,e){if(e){const t=e.feature.getGeometry();if(t instanceof le||t instanceof Be)return i.getContinueMessage()}return i.getHelpMessage()}function ni(i,e,t){const n=Rs(i,{projection:e});let s;return n>=1e6?s=`${t.formatNumber(n/1e6)} km<sup>2</sup>`:s=`${t.formatNumber(n)} m<sup>2</sup>`,s}function ii(i,e,t){const n=Gs(i,{projection:e});let s;return n>=1e3?s=`${t.formatNumber(n/1e3)} km`:s=`${t.formatNumber(n)} m`,s}const xr=i=>{const e=Xn(),{containerProps:t}=$("measurement",i),[n,s]=m.useState("distance"),r=d=>e.formatMessage({id:d}),a=U(i),o=ri(a.map,i,e);m.useEffect(()=>{if(o)return o.startMeasurement(n),()=>{o.stopMeasurement()}},[o,n]);function l(d){if(d==="distance"||d==="area")s(d);else throw new Error(`Unexpected measurement type: '${d}'.`)}function c(){o?.clearMeasurements()}return u.jsxs(P,{...t,children:[u.jsx(se,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),u.jsx(ce,{mb:4,alignItems:"center",children:u.jsxs(Ee,{mb:2,children:[u.jsx(de,{mb:1,children:r("measurementLabel")}),u.jsxs(Je,{value:n,onChange:d=>l(d.target.value),className:"measurement-select",children:[u.jsx("option",{value:"distance",children:r("distance")}),u.jsx("option",{value:"area",children:r("area")})]})]})}),u.jsx(At,{padding:2,className:"measurement-delete-button",onClick:c,width:"100%",children:r("deleteMeasurementLabel")})]})};function ri(i,e,t){const{activeFeatureStyle:n,finishedFeatureStyle:s,onMeasurementsChange:r,predefinedMeasurements:a}=e,[o,l]=m.useState(void 0);return m.useEffect(()=>{if(!i)return;const c=new Zn(i.olMap,{getContinueMessage(){return t.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return t.formatMessage({id:"tooltips.help"})},formatNumber(d){return t.formatNumber(d,{maximumFractionDigits:2})}});return l(c),()=>{c.destroy(),l(void 0)}},[i,t]),m.useEffect(()=>{o?.setActiveFeatureStyle(n??oi())},[o,n]),m.useEffect(()=>{o?.setFinishedFeatureStyle(s??ai())},[o,s]),m.useEffect(()=>{o?.setMeasurementSourceChangedHandler(r)},[o,r]),m.useEffect(()=>{o?.setPredefinedMeasurements(a??[])},[o,a]),o}function oi(){return[new be({stroke:new oe({color:"#fff",lineDash:[10,10],width:5})}),new be({fill:new He({color:"rgba(0,0,0,0.15)"}),stroke:new oe({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new Vs({radius:5,stroke:new oe({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new He({color:"rgba(255, 255, 255, 0.2)"})})})]}function ai(){return[new be({stroke:new oe({color:"#fff",width:5})}),new be({stroke:new oe({color:"#0b96fc",width:3}),fill:new He({color:"rgba(11,150,252,0.15)"})})]}const li="@open-pioneer/search",Ae=q.bind(void 0,li);function ci(i){const e=i.selectProps.inputValue.length>0,t={...i,className:Te(i.className,{"search-invisible":!e})};return u.jsx(N.Menu,{...t,children:i.children})}function di(i){const e=i.data.label,t={...i.innerProps,"aria-label":e,role:"group"};return u.jsx(N.Group,{...i,innerProps:t})}function ui(i){const t=Ae().formatMessage({id:"noOptionsText"});return u.jsx(N.NoOptionsMessage,{...i,children:u.jsx(V.span,{className:"search-no-match",children:t})})}function hi(i){const t=Ae().formatMessage({id:"loadingText"});return u.jsx(N.LoadingMessage,{...i,children:u.jsx(V.span,{className:"search-loading-text",children:t})})}function gi({children:i,...e}){const t={...e,className:Te(e.className,"search-value-container")};return u.jsxs(N.ValueContainer,{...t,children:[!!i&&u.jsx(In,{style:{position:"absolute",left:8}}),i]})}function fi(i){const e={...i,isHidden:!1};return u.jsx(N.Input,{...e})}function mi(i){return null}function pi(i){return u.jsxs(N.IndicatorsContainer,{...i,children:[i.children,!i.selectProps.isLoading&&i.selectProps.inputValue&&u.jsx(yi,{selectProps:i.selectProps,clearValue:i.clearValue})]})}function yi(i){const t=Ae().formatMessage({id:"ariaLabel.clearButton"}),n=s=>{s.preventDefault(),s.stopPropagation(),i.clearValue()};return u.jsx(Ks,{role:"button",size:"md",mr:1,"aria-label":t,onClick:n,onTouchEnd:n,onMouseDown:s=>s.preventDefault()})}function _i(i){return null}function vi(i){const e=i.selectProps.inputValue,t=i.data.label,n={...i,className:Te(i.className,"search-option")};return u.jsx(N.Option,{...n,children:u.jsx(V.div,{className:"search-option-label",children:e.trim().length>0?Si(t,e):t})})}function Si(i,e){const t=i.toLowerCase().indexOf(e.toLowerCase());return t>=0?u.jsxs(u.Fragment,{children:[i.substring(0,t),u.jsx(V.span,{className:"search-highlighted-match",children:i.substring(t,t+e.length)},"highlighted"),i.substring(t+e.length)]}):i}const Mt=ve("search:SearchController"),wt=200,bt=5;var me,Z,Q,ee,A,Fe,Jt;class xi{constructor(e,t){x(this,Fe);x(this,me);x(this,Z,[]);x(this,Q,bt);x(this,ee,wt);x(this,A);w(this,me,e),w(this,Z,t)}destroy(){v(this,A)?.abort(),w(this,A,void 0)}async search(e){if(v(this,A)?.abort(),w(this,A,void 0),!e)return[];const t=w(this,A,new AbortController);try{return await Mi(t.signal,v(this,ee)),t.signal.aborted&&(Mt.debug(`search canceled with ${e}`),qs()),(await Promise.all(v(this,Z).map(s=>ie(this,Fe,Jt).call(this,s,e,t.signal)))).filter(s=>s!=null)}finally{v(this,A)===t&&w(this,A,void 0)}}get searchTypingDelay(){return v(this,ee)}set searchTypingDelay(e){w(this,ee,e??wt)}get maxResultsPerSource(){return v(this,Q)}set maxResultsPerSource(e){w(this,Q,e??bt)}get sources(){return v(this,Z)}}me=new WeakMap,Z=new WeakMap,Q=new WeakMap,ee=new WeakMap,A=new WeakMap,Fe=new WeakSet,Jt=async function(e,t,n){const s=e.label,r=v(this,me).olMap.getView().getProjection();try{const a=v(this,Q);let o=await e.search(t,{maxResults:a,signal:n,mapProjection:r});return o.length>a&&(o=o.slice(0,a)),{label:s,source:e,results:o}}catch(a){jt(a)||Mt.error(`search for source ${s} failed`,a);return}};async function Mi(i,e){i.aborted||await new Promise(t=>{const n=()=>{i.removeEventListener("abort",n),clearTimeout(s),t()};i.addEventListener("abort",n);const s=setTimeout(n,e)})}const Ce=ve("search:Search"),Mr=i=>{const{sources:e,searchTypingDelay:t,maxResultsPerGroup:n,onSelect:s,onClear:r}=i,{containerProps:a}=$("search",i),{map:o}=U(i),l=Ae(),c=Ci(e,t,n,o),{input:d,search:h,selectedOption:f,onInputChanged:g,onResultConfirmed:p}=Pi(c),_=Ei(),M=wi(l),L=bi(),I=B((E,D)=>{D.action==="input-change"&&g(E)}),T=B((E,D)=>{switch(D.action){case"select-option":E&&(p(E),s?.({source:E.source,result:E.result}));break;case"clear":g(""),O.current?.blur(),O.current?.focus(),r?.();break;default:Ce.debug(`Unhandled action type '${D.action}'.`);break}}),O=m.useRef(null);return u.jsx(P,{...a,children:u.jsx(Rt,{className:"search-component",classNamePrefix:"react-select",ref:O,inputValue:d,onInputChange:I,"aria-label":l.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:M,tagColorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:_,isClearable:!0,placeholder:i.placeholder??l.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:h.kind==="loading",options:h.kind==="ready"?h.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:L,onChange:T,value:f,menuPosition:"fixed"})})};function wi(i){return m.useMemo(()=>({onFocus:()=>"",onChange:()=>"",guidance:()=>`${i.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[i])}function bi(){return m.useMemo(()=>({Menu:ci,Input:fi,SingleValue:mi,Option:vi,NoOptionsMessage:ui,LoadingMessage:hi,ValueContainer:gi,IndicatorsContainer:pi,ClearIndicator:_i,Group:di}),[])}function Ei(){const[i,e]=Nt("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return m.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:i,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[i,e])}function Ci(i,e,t,n){const[s,r]=m.useState(void 0);return m.useEffect(()=>{if(!n)return;const a=new xi(n,i);return r(a),()=>{a.destroy(),r(void 0)}},[n,i]),m.useEffect(()=>{s&&(s.searchTypingDelay=e)},[s,e]),m.useEffect(()=>{s&&(s.maxResultsPerSource=t)},[s,t]),s}function Pi(i){const[e,t]=m.useReducer((o,l)=>{switch(l.kind){case"input":return{...o,query:l.query,selectedOption:null};case"select-option":return{...o,selectedOption:l.option,query:l.option.label};case"load-results":return{...o,search:{kind:"loading"}};case"accept-results":return{...o,search:{kind:"ready",results:l.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=m.useRef(),s=B(o=>{if(!i){n.current=void 0,t({kind:"accept-results",results:[]});return}Ce.isDebug()&&Ce.debug(`Starting new search for query ${JSON.stringify(o)}.`),t({kind:"load-results"});const l=n.current=Fi(i,o).then(c=>{n.current===l&&t({kind:"accept-results",results:c})})}),r=m.useCallback(o=>{t({kind:"select-option",option:o})},[]),a=m.useCallback(o=>{t({kind:"input",query:o}),s(o)},[s]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:r,onInputChanged:a}}async function Fi(i,e){let t;try{t=await i.search(e)}catch(n){jt(n)||Ce.error("Search failed",n),t=[]}return Li(t)}function Li(i){return i.map((t,n)=>({label:t.label,options:t.results.map(s=>({value:`${n}-${s.id}`,label:s.label,source:t.source,result:s}))}))}const Xt="@open-pioneer/selection",Ii=ze.bind(void 0,Xt),Xe=q.bind(void 0,Xt),Re=ve("selection:SelectionController"),Ti=1e4;var pe,ye,_e,Le,Zt;class ki{constructor(e){x(this,Le);x(this,pe);x(this,ye);x(this,_e);const{mapModel:t,onError:n,maxResults:s=Ti}=e;w(this,pe,t),w(this,ye,s),w(this,_e,n)}destroy(){}async select(e,t){if(t)return await ie(this,Le,Zt).call(this,e,t)}}pe=new WeakMap,ye=new WeakMap,_e=new WeakMap,Le=new WeakSet,Zt=async function(e,t){const n=v(this,pe).olMap.getView().getProjection();try{Re.debug(`Starting selection on source '${e.label}'`);const s=v(this,ye);let r=await e.select({type:"extent",extent:t},{maxResults:s,mapProjection:n,signal:new AbortController().signal});return r.length>s&&(r=r.slice(0,s)),Re.debug(`Found ${r.length} results on source '${e.label}'`),{source:e,results:r}}catch(s){Re.error(`selection from source ${e.label} failed`,s),v(this,_e).call(this);return}};const Qt="selection-active",es="selection-inactive";function Pe(i){const e=i.getViewport();e.classList.remove(es),e.classList.add(Qt)}function J(i,e=!0){const t=i.getViewport();t.classList.remove(Qt),e||t.classList.add(es)}function ts(i,e){const t=document.createElement("div");t.className="selection-tooltip printing-hide",t.role="tooltip";const n=document.createElement("span");n.textContent=e,t.appendChild(n);const s=new ke({element:t,offset:[15,0],positioning:"center-left"}),r=i.on("pointermove",a=>{s.setPosition(a.coordinate)});return i.addOverlay(s),{overlay:s,element:t,destroy(){i.removeOverlay(s),s.dispose(),F(r)},setText(a){n.textContent=a}}}class Ai{tooltip;olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;onClick;eventKey;constructor(e,t,n,s){this.tooltip=ts(e,t),this.olMap=e,this.tooltipMessage=t,this.tooltipDisabledMessage=n,this.onClick=this.getEventHandlerFunction(s),this.eventKey=this.olMap.on("singleclick",this.onClick),Pe(e)}destroy(){this.tooltip.destroy(),F(this.eventKey),J(this.olMap,!0)}setActive(e){this.isActive!==e&&(e?(this.tooltip.setText(this.tooltipMessage),Pe(this.olMap),this.isActive=!0):(F(this.eventKey),this.tooltip.setText(this.tooltipDisabledMessage),J(this.olMap),this.isActive=!1))}getEventHandlerFunction(e){const n=this.olMap;return r=>{const a=r.coordinate,o=n.getPixelFromCoordinate(a),c=[[o[0]-5,o[1]-5],[o[0]-5,o[1]+5],[o[0]+5,o[1]+5],[o[0]+5,o[1]-5],[o[0]-5,o[1]-5]].map(h=>n.getCoordinateFromPixel(h)),d=new le([c]);e(d)}}}class ji{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,n,s){const r=this.initViewport(e);this.interactionResources.push(this.createDragBox(e,s,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources)),this.tooltip=ts(e,t),this.olMap=e,this.tooltipMessage=t,this.tooltipDisabledMessage=n}initViewport(e){Pe(e);const t=e.getViewport();return t.oncontextmenu=n=>(n.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()}),J(this.olMap,!0)}setActive(e){this.isActive!==e&&(e?(this.interactionResources.forEach(t=>this.olMap.addInteraction(t.interaction)),this.tooltip.setText(this.tooltipMessage),Pe(this.olMap),this.isActive=!0):(this.interactionResources.forEach(t=>this.olMap.removeInteraction(t.interaction)),this.tooltip.setText(this.tooltipDisabledMessage),J(this.olMap),this.isActive=!1))}createDragBox(e,t,n,s){const r=new at({className:"selection-drag-box",condition:Hs});return e.addInteraction(r),r.on("boxend",function(){t(r.getGeometry())}),{interaction:r,destroy(){e.removeInteraction(r),s.splice(s.indexOf(this)),r.dispose(),J(e),n.oncontextmenu=null}}}createDrag(e,t,n){const s=function(o){return o.originalEvent.button==2},r=new lt({condition:s});return e.addInteraction(r),{interaction:r,destroy(){e.removeInteraction(r),n.splice(n.indexOf(this)),r.dispose(),J(e),t.oncontextmenu=null}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof at)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof lt)}}const Ni={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},wr=i=>{const e=Xe(),{sources:t,availableSelectionMethods:n,onSelectionComplete:s,onSelectionSourceChanged:r}=i,{containerProps:a}=$("selection",i),o=e.formatMessage({id:"sourceNotAvailable"}),[l,c]=Ri(t,r),d=is(l,o),h="extent",[f,g]=m.useState(h);m.useEffect(()=>{let S=n??h;S=Array.isArray(S)&&S.length>0?S[0]:S,g(S)},[n]);const p=m.useMemo(()=>!!(n&&Array.isArray(n)&&n.length>1),[n]),_=U(i),{onExtentSelected:M}=Gi(_.map,t,l,s),L=Hi(),[I,T]=m.useState(!1);Vi(f,_.map,e,M,d.kind==="available",!!l);const O=m.useMemo(()=>t.map(S=>({label:S.label,value:S})),[t]),E=m.useMemo(()=>O.find(Se=>Se.value===l)||null,[O,l]),D=B(S=>{c(S?.value)}),as=B(S=>{!I&&S.key==="Enter"&&T(!0)});return u.jsxs(Ys,{...a,spacing:2,children:[p&&u.jsxs(ce,{children:[u.jsx(de,{children:e.formatMessage({id:"selectionMethod"})}),u.jsxs(Ee,{gap:2,children:[u.jsx(ht,{icon:u.jsx(an,{}),label:e.formatMessage({id:"EXTENT"}),onClick:()=>g("extent"),isActive:f==="extent"}),u.jsx(ht,{icon:u.jsx(Yn,{}),label:e.formatMessage({id:"POINT"}),onClick:()=>g("point"),isActive:f==="point"})]})]}),u.jsxs(ce,{children:[u.jsx(de,{children:e.formatMessage({id:"selectSource"})}),u.jsx(Rt,{className:"selection-source react-select",...Ni,options:O,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:E,onChange:D,components:{Option:Oi,SingleValue:Di},isOptionDisabled:()=>!1,getOptionLabel:S=>{const Se=S.label,Ze=ns(S.value,o);return Ze.kind=="available"?Se:Se+" "+Ze.reason},ariaLiveMessages:{guidance:()=>"",onChange:S=>S.action=="select-option"||S.action=="initial-input-focus"?S.label+" "+e.formatMessage({id:"selected"}):"",onFilter:()=>"",onFocus:()=>""},chakraStyles:L,onKeyDown:as,menuIsOpen:I,onMenuOpen:()=>T(!0),onMenuClose:()=>T(!1)})]})]})};function Oi(i){const{value:e}=i.data,{isAvailable:t,content:n}=ss(e,!1);return u.jsx(N.Option,{...i,isDisabled:!t,className:"selection-source-option",children:n})}function Di(i){const{value:e}=i.data,{isAvailable:t,content:n}=ss(e,!0),s=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return u.jsx(N.SingleValue,{...i,isDisabled:!t,className:s,children:n})}function Ri(i,e){const[t,n]=m.useState(()=>i[0]);m.useEffect(()=>{t&&!i.includes(t)&&n(void 0)},[i,t]);const s=m.useRef(void 0);return m.useEffect(()=>{t!==s.current&&(s.current=t,e?.({source:t}))},[t,e]),[t,n]}function ss(i,e){const t=Xe(),n=i?.label,s=t.formatMessage({id:"sourceNotAvailable"}),r=is(i,s);return{isAvailable:r.kind==="available",content:u.jsxs(ct,{direction:"row",alignItems:"center",grow:1,children:[!e&&u.jsx(ct,{grow:1,children:n}),r.kind==="unavailable"&&u.jsx(P,{ml:2,children:u.jsx(Js,{label:r.reason,placement:"right",openDelay:500,children:u.jsx(V.span,{children:u.jsx(Xs,{as:on,color:"red",className:"warning-icon","aria-label":r.reason})})})}),e&&n]})}}function Gi(i,e,t,n){const s=Ii("notifier.NotificationService"),r=Xe(),[a,o]=m.useState(void 0);m.useEffect(()=>{if(!i)return;const c=new ki({mapModel:i,onError(){s.notify({level:"error",message:r.formatMessage({id:"selectionFailed"})})}});return o(c),()=>{c.destroy()}},[i,s,e,r]);const l=B(async c=>{if(!a||!t)return;const d=await a.select(t,c.getExtent());d&&n?.(d)});return{controller:a,onExtentSelected:l}}function ns(i,e){const t=i.status??"available",n=typeof t=="string"?{kind:t}:t;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function is(i,e){return W(()=>i?ns(i,e):{kind:"unavailable",reason:e},[i,e])}function Vi(i,e,t,n,s,r){function a(o){switch(o){case"extent":return ji;case"point":return Ai;default:throw new Error(`Unknown selection kind: ${o}`)}}m.useEffect(()=>{if(!e)return;const o=r?t.formatMessage({id:"disabledTooltip"}):t.formatMessage({id:"noSourceTooltip"}),l=a(i),c=new l(e.olMap,t.formatMessage({id:`tooltip.${i}`}),o,n);return c.setActive(s),()=>{c?.destroy()}},[e,t,n,s,r,i])}function Hi(){const[i,e]=Nt("colors",["background_body","border"],["#ffffff","#ffffff"]);return m.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:i})}),[i,e])}const rs="@open-pioneer/printing",os=ze.bind(void 0,rs),Bi=q.bind(void 0,rs),$i="map";class Ui{olMap;i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,t,n){this.olMap=e,this.printingService=t,this.i18n=n}destroy(){this.reset()}setViewPadding(e){this.viewPadding=e}async handleMapExport(e){if(this.olMap)try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const t=this.printMap.getCanvas();if(t)e.fileFormat=="png"?await this.exportMapInPNG(t,e):await this.exportMapInPDF(t,e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=sn(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(e){const t=e.title||"",n=e.title||$i;return{title:t,fileName:n}}async exportMapInPNG(e,t){const n=document.createElement("canvas");n.width=e.width,n.height=e.height+50,n.style.backgroundColor="#fff";const s=n.getContext("2d");if(!s)throw new Error("2d canvas rendering context not available");const{title:r,fileName:a}=this.getTitleAndFileName(t);s.fillStyle="#fff",s.fillRect(0,0,n.width,n.height),s.font="20px bold sans-serif",s.textAlign="center",s.fillStyle="#000";const o=n.width/2;s.fillText(r,o,20),s.drawImage(e,0,50);const l=document.createElement("a");l.setAttribute("download",a+".png");const c=nn(n);if(!c)throw new Error("Failed to get image data URL");l.href=c,l.click()}async exportMapInPDF(e,t){const{jsPDF:n}=await ln(async()=>{const{jsPDF:L}=await import("./BGpV6sNzKbKC.js");return{jsPDF:L}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),s=new n({orientation:"landscape",unit:"mm",format:"a4"}),r=s.internal.pageSize.getWidth(),a=s.internal.pageSize.getHeight(),o=15,l=20,c=a-l;s.setFontSize(20);const{title:d,fileName:h}=this.getTitleAndFileName(t);s.text(d,r/2,o,{align:"center"});const f=e.width/e.height;let g=c,p=g*f;p>=r&&(p=r,g=p/f);const _=(r-p)/2,M=l+(c-g)/2;s.addImage(e,"",_,M,p,g),s.save(h+".pdf")}}const Wi=ve("printing"),br=i=>{const e=Bi(),{viewPadding:t="auto"}=i,{containerProps:n}=$("printing",i),[s,r]=m.useState("pdf"),[a,o]=m.useState(""),[l,c]=m.useState(!1),d=os("notifier.NotificationService"),{map:h}=U(i),f=zi(h,e,t);function g(_){(_==="png"||_==="pdf")&&r(_)}function p(){l||!f||(c(!0),f.handleMapExport({title:a,fileFormat:s}).catch(_=>{const M=e.formatMessage({id:"printingFailed"});d.notify({level:"error",message:M}),Wi.error("Failed to print the map",_)}).finally(()=>{c(!1)}))}return u.jsx(P,{...n,children:u.jsxs(P,{as:"form",m:2,alignItems:"center",onSubmit:_=>{_.preventDefault(),p()},children:[u.jsxs(ce,{as:Ee,mb:2,children:[u.jsx(de,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),u.jsx(Ye,{placeholder:e.formatMessage({id:"input.placeholder"}),value:a,onChange:_=>{o(_.target.value)},autoFocus:!0})]}),u.jsxs(ce,{as:Ee,mb:2,children:[u.jsx(de,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),u.jsxs(Je,{value:s,onChange:_=>g(_.target.value),className:"printing-select",children:[u.jsx("option",{value:"png",children:"PNG"}),u.jsx("option",{value:"pdf",children:"PDF"})]})]}),u.jsx(At,{isLoading:l,loadingText:e.formatMessage({id:"printingMap"}),disabled:l,mt:2,p:2,className:"printing-export-button",type:"submit",width:"100%",children:e.formatMessage({id:"export"})})]})})};function zi(i,e,t){const n=os("printing.PrintingService"),[s,r]=m.useState(void 0);return m.useEffect(()=>{if(!i)return;const a=new Ui(i.olMap,n,{overlayText:e.formatMessage({id:"printingMap"})});return r(a),()=>{a.destroy(),r(void 0)}},[i,e,n]),m.useEffect(()=>{s?.setViewPadding(t)},[s,t]),s}export{mr as C,hr as E,Ye as I,_r as L,xr as M,fr as N,ke as O,br as P,$t as S,vr as T,gr as V,ur as W,pr as a,yr as b,Sr as c,Mr as d,wr as e,Je as f};
