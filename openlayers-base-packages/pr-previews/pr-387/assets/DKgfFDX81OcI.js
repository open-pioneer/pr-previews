import{r as c,j as o,G as se,H as oe,l as j,J as E,a6 as v,g as w,h as S,C as ae,b as O,F as R,B as b,q as re}from"./J_WxYcBzn5mw.js";import{u as ne,b3 as ie,k as T,r as D,aZ as le,i as ce,g as k,h as B,e as de}from"./DxJrGzLGIgSO.js";import{B as ue}from"./D5SQLjy-_82v.js";import{u as g}from"./Bsm_k7AFhNln.js";import{f as F,F as pe}from"./B2FYvygtgI3E.js";import{u as C,c as I,P as me,a as he,b as xe}from"./DVfhPCZEmrQW.js";import{S as V,I as fe}from"./CH-qNRSPhMHS.js";import{C as ge,a as ye,b as be,M as _}from"./C8cP88sgBYZM.js";import{c as je}from"./uuuD2LZFgwH5.js";import{C as ve}from"./CejOUL_G37Oz.js";import{T as A}from"./D3XN4wcwGfw6.js";import{L as we}from"./XBL9D10fr7gH.js";import{M as Ce}from"./LWD6knZ_CBe3.js";const Ie=e=>{const{condition:t,message:s}=e},Le=e=>e!=null&&parseInt(e.toString(),10)>0,G={exit:{height:{duration:.2,ease:v.ease},opacity:{duration:.3,ease:v.ease}},enter:{height:{duration:.3,ease:v.ease},opacity:{duration:.4,ease:v.ease}}},Ne={exit:({animateOpacity:e,startingHeight:t,transition:s,transitionEnd:a,delay:r})=>({...e&&{opacity:Le(t)?1:0},height:t,transitionEnd:a?.exit,transition:s?.exit??E.exit(G.exit,r)}),enter:({animateOpacity:e,endingHeight:t,transition:s,transitionEnd:a,delay:r})=>({...e&&{opacity:1},height:t,transitionEnd:a?.enter,transition:s?.enter??E.enter(G.enter,r)})},$=c.forwardRef((e,t)=>{const{in:s,unmountOnExit:a,animateOpacity:r=!0,startingHeight:n=0,endingHeight:l="auto",style:i,className:d,transition:p,transitionEnd:u,animatePresenceProps:m,...h}=e,[x,L]=c.useState(!1);c.useEffect(()=>{const te=setTimeout(()=>{L(!0)});return()=>clearTimeout(te)},[]),Ie({condition:Number(n)>0&&!!a,message:"startingHeight and unmountOnExit are mutually exclusive. You can't use them together"});const N=parseFloat(n.toString())>0,f={startingHeight:n,endingHeight:l,animateOpacity:r,transition:x?p:{enter:{duration:0}},transitionEnd:{enter:u?.enter,exit:a?u?.exit:{...u?.exit,display:N?"block":"none"}}},P=a?s:!0,ee=s||a?"enter":"exit";return o.jsx(se,{...m,initial:!1,custom:f,children:P&&o.jsx(oe.div,{ref:t,...h,className:j("chakra-collapse",d),style:{overflow:"hidden",display:"block",...i},custom:f,variants:Ne,initial:a?"exit":!1,animate:ee,exit:"exit"})})});$.displayName="Collapse";const M=(e,t)=>t?`${e}.${t}, ${t}`:void 0;function z(e){const{bg:t,bgColor:s,backgroundColor:a,shadow:r,boxShadow:n,shadowColor:l,...i}=e,{getArrowProps:d,getArrowInnerProps:p}=C(),u=I(),m=t??s??a,h=r??n;return o.jsx(w.div,{...d(),className:"chakra-popover__arrow-positioner",children:o.jsx(w.div,{className:j("chakra-popover__arrow",e.className),...p(i),__css:{"--popper-arrow-shadow-color":M("colors",l),"--popper-arrow-bg":M("colors",m),"--popper-arrow-shadow":M("shadows",h),...u.arrow}})})}z.displayName="PopoverArrow";const Y=S(function(t,s){const{getBodyProps:a}=C(),r=I();return o.jsx(w.div,{...a(t,s),className:j("chakra-popover__body",t.className),__css:r.body})});Y.displayName="PopoverBody";const q=S(function(t,s){const{onClose:a}=C(),r=I();return o.jsx(ae,{size:"sm",onClick:a,className:j("chakra-popover__close-btn",t.className),__css:r.closeButton,ref:s,...t})});q.displayName="PopoverCloseButton";const J=S(function(t,s){const{getHeaderProps:a}=C(),r=I();return o.jsx(w.header,{...a(t,s),className:j("chakra-popover__header",t.className),__css:r.header})});J.displayName="PopoverHeader";function Pe(e){return"parentLayer"in e}function ot(e){return"olLayer"in e}const Me=je({d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",displayName:"ChevronRightIcon"}),Se="@open-pioneer/toc",y=ne.bind(void 0,Se),K=c.createContext(void 0),Te=K.Provider;function Z(){const e=c.useContext(K);if(!e)throw new Error("Internal error: TocModel not found in context.");return e}function Ae(e){return e.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function Ee(e){return g(()=>{const t=e.layers.getOperationalLayers({sortByDisplayOrder:!0})??[];return t.reverse(),t},[e])}function ke(e){return g(()=>{const t=e.children?.getItems({sortByDisplayOrder:!0});return t?.reverse(),t},[e])}function Q(e){return g(()=>(Pe(e)?e.parentLayer:e).loadState,[e])}function Be(e){const{layer:t,title:s,description:a,intl:r}=e,n=!!a,l=r.formatMessage({id:"descriptionLabel"}),i=Q(t)!=="error";return n&&o.jsxs(me,{placement:"bottom-start",children:[o.jsx(he,{children:o.jsx(O,{isDisabled:!i,className:"toc-layer-item-details-button","aria-label":l,borderRadius:"full",iconSpacing:0,padding:0,variant:"ghost",leftIcon:o.jsx(F,{})})}),o.jsx(R,{children:o.jsxs(xe,{className:"toc-layer-item-details",overflowY:"auto",maxHeight:"400",children:[o.jsx(z,{}),o.jsx(q,{mt:1}),o.jsx(J,{children:s}),o.jsx(Y,{children:a})]})})]})}const _e=c.memo(function(t){const{layer:s}=t,a=y(),[r,n,l]=He(s),i=g(()=>r.isExpanded,[r]),d=l?l.collapsibleGroups:!1,p=c.useId(),u=ke(s),m=Q(s)!=="error",h=a.formatMessage({id:"layerNotAvailable"}),{title:x,description:L,isVisible:N}=g(()=>({title:s.title,description:s.description,isVisible:s.visible}),[s]);let f;return u?.length&&(f=o.jsx(W,{layers:u,ml:4,"aria-label":a.formatMessage({id:"childgroupLabel"},{title:x})})),o.jsxs(b,{as:"li",className:ie("toc-layer-item",`layer-${Ae(s.id)}`),children:[o.jsxs(T,{className:"toc-layer-item-content",width:"100%",flexDirection:"row",align:"center",justifyContent:"space-between",gap:2,minHeight:10,children:[d&&o.jsx(Ge,{layerTitle:x,layerGroupId:p,expanded:i,onClick:()=>r.setExpanded(!i),hasNestedChildren:!!f}),o.jsx(ve,{"aria-label":x+(m?"":" "+h),isChecked:N,isDisabled:!m,onChange:P=>U(s,P.target.checked,l.autoShowParents),children:x}),!m&&o.jsx(re,{className:"toc-layer-item-content-tooltip",label:h,placement:"right",openDelay:500,children:o.jsx("span",{children:o.jsx(pe,{className:"toc-layer-item-content-icon",color:"red","aria-label":h})})}),o.jsx(V,{}),o.jsx(Be,{layer:s,title:x,description:L,intl:a})]}),f&&o.jsx($,{in:i,id:p,className:"toc-collapsible-item",children:f})]})});function Ge(e){const{layerTitle:t,layerGroupId:s,expanded:a,onClick:r,hasNestedChildren:n}=e,l=y();return o.jsx(fe,{variant:"ghost",borderRadius:"full",padding:0,className:"toc-layer-item-collapse-button",onClick:r,icon:a?o.jsx(ge,{}):o.jsx(Me,{}),"aria-label":a?l.formatMessage({id:"group.collapse"},{title:t}):l.formatMessage({id:"group.expand"},{title:t}),"aria-expanded":a,"aria-controls":s,visibility:n?"visible":"hidden"})}function He(e){const t=Z(),s=g(()=>t.options,[t]),a=c.useMemo(()=>{const r=D(!s.initiallyCollapsed);return{layerId:e.id,get isExpanded(){return r.value},setExpanded(n){r.value=n}}},[e,s.initiallyCollapsed]);return c.useEffect(()=>(t.registerItem(a),()=>t.unregisterItem(a)),[t,a]),[a,t,s]}function U(e,t,s){e.setVisible(t),t&&s&&e.parent&&U(e.parent,!0,!0)}const Oe=c.memo(function(t){const{map:s,"aria-label":a}=t,r=y(),n=Ee(s);return n.length?o.jsx(W,{layers:n,"aria-label":a}):o.jsx(A,{className:"toc-missing-layers","aria-label":a,children:r.formatMessage({id:"missingLayers"})})}),W=c.memo(function(t){const{layers:s,...a}=t,r=c.useMemo(()=>s.map(n=>o.jsx(_e,{layer:n},n.id)),[s]);return o.jsx(b,{children:o.jsx(we,{as:"ul",className:"toc-layer-list",listStyleType:"none",role:"group",...a,children:r})})}),Re=c.memo(function(t){const s=y(),a=Z(),r=g(()=>a.options.collapsibleGroups,[a]),{map:n,showHideAllLayers:l=!0,showCollapseAllGroups:i=r}=t,d=r&&i;return(l||d)&&o.jsx(b,{className:"toc-tools",children:o.jsxs(Ce,{placement:"bottom-start",children:[o.jsx(ye,{as:O,className:"toc-tools-button","aria-label":s.formatMessage({id:"toolsLabel"}),borderRadius:"full",iconSpacing:0,padding:3,variant:"ghost",leftIcon:o.jsx(F,{})}),o.jsx(R,{children:o.jsxs(be,{className:"tools-menu",children:[l&&o.jsx(_,{"aria-label":s.formatMessage({id:"tools.hideAllLayers"}),onClick:()=>{De(n)},children:s.formatMessage({id:"tools.hideAllLayers"})}),d&&o.jsx(_,{"aria-label":s.formatMessage({id:"tools.collapseAllGroups"}),onClick:()=>{Fe(a)},children:s.formatMessage({id:"tools.collapseAllGroups"})})]})})]})})});function De(e){const t=s=>{s.setVisible(!1);const a=s.children?.getItems();if(a)for(const r of a)t(r)};e?.layers.getOperationalLayers().forEach(s=>{t(s)})}function Fe(e){e.getItems().forEach(t=>t.setExpanded(!1))}const X=2,at=e=>{const t=y(),{containerProps:s}=le("toc",e),a=ce(e);let r;switch(a.kind){case"loading":r=null;break;case"rejected":r=o.jsx(A,{className:"toc-error",children:t.formatMessage({id:"error"})});break;case"resolved":{const n=a.map;r=o.jsx(Ve,{...e,map:n});break}}return o.jsx(T,{...s,direction:"column",gap:X,children:r})};function Ve(e){const{map:t,showTools:s=!1,toolsConfig:a,showBasemapSwitcher:r=!0,basemapSwitcherProps:n}=e,l=y(),i=$e(e),d=c.useId(),p=r&&o.jsx(b,{className:"toc-basemap-switcher",children:o.jsx(k,{title:o.jsx(B,{id:d,size:"sm",mb:X,children:l.formatMessage({id:"basemapsLabel"})}),children:o.jsx(ue,{map:t,"aria-labelledby":d,...n})})}),u=o.jsx(b,{className:"toc-operational-layers",children:o.jsx(k,{title:o.jsx(B,{size:"sm",mb:2,children:o.jsxs(T,{children:[o.jsx(A,{my:3,children:l.formatMessage({id:"operationalLayerLabel"})}),o.jsx(V,{}),s&&o.jsx(Re,{map:t,...a})]})}),children:o.jsx(Oe,{map:t,"aria-label":l.formatMessage({id:"operationalLayerLabel"})})})});return o.jsxs(Te,{value:i,children:[p,u]})}function $e(e){const t=c.useRef(e),{model:s,options:a}=c.useMemo(()=>{const r=D(H(t.current.autoShowParents,t.current.collapsibleGroups,t.current.initiallyCollapsed)),n=de();return{model:{get options(){return r.value},getItem(i){return n.get(i)},getItems(){return Array.from(n.values())},registerItem(i){if(n.has(i.layerId))throw new Error(`Item with layerId '${i.layerId}' already registered.`);n.set(i.layerId,i)},unregisterItem(i){if(n.get(i.layerId)!==i)throw new Error(`Item with layerId '${i.layerId}' not registered.`);n.delete(i.layerId)}},options:r}},[]);return c.useEffect(()=>{a.value=H(e.autoShowParents,e.collapsibleGroups,e.initiallyCollapsed)},[a,e.autoShowParents,e.collapsibleGroups,e.initiallyCollapsed]),s}function H(e,t,s){return{autoShowParents:e??!0,collapsibleGroups:t??!1,initiallyCollapsed:s??!1}}export{z as P,at as T,Y as a,ot as i};
