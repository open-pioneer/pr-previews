const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CIihL14E4dRF.js","./CmsKOCeNyeyo.js","./J_WxYcBzn5mw.js"])))=>i.map(i=>d[i]);
var ut=Object.defineProperty;var Le=r=>{throw TypeError(r)};var dt=(r,e,t)=>e in r?ut(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>dt(r,typeof e!="symbol"?e+"":e,t),ve=(r,e,t)=>e.has(r)||Le("Cannot "+t);var d=(r,e,t)=>(ve(r,e,"read from private field"),t?t.call(r):e.get(r)),p=(r,e,t)=>e.has(r)?Le("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),v=(r,e,t,s)=>(ve(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),G=(r,e,t)=>(ve(r,e,"access private method"),t);import{aE as ht,b7 as ft,b8 as gt,b9 as mt,aP as pt,aX as yt,ba as vt,bb as _t,J as St,bc as wt,j as k,a_ as Ve,a as fe,r as Ee,b as xe,a$ as Ce,bd as Ge,aL as Mt,be as bt,b0 as Et,u as Z,aZ as Q,i as ee,b3 as ge,bf as xt,am as ie,bg as Ct,bh as Pt,c as oe,ax as U,F as Se,C as Lt,f as $e,bi as Ie,bj as It,bk as Fe,k as Oe}from"./DxJrGzLGIgSO.js";import{c as te,d as Ue,j as l,B as I,s as ke,r as h,b as Be,g as se,C as Ft,t as Ot,i as We,v as ze,V as kt,q as Tt,I as jt}from"./J_WxYcBzn5mw.js";import{G as Ke}from"./DVfhPCZEmrQW.js";import{a as Nt}from"./B-tmLLQVIv8F.js";import{D as Je}from"./pccCAfj1dKBV.js";import{M as At,W as Rt,c as qe,I as Dt}from"./C8oAoy9cLnkg.js";import{i as Ht}from"./DKgfFDX81OcI.js";import{u as H}from"./Bsm_k7AFhNln.js";import{L as Vt}from"./XBL9D10fr7gH.js";import{I as Gt,c as $t,a as Ut}from"./zG30NV9IEVc6.js";import{T as ae}from"./D3XN4wcwGfw6.js";import{L as we}from"./C8eT9SIUWJMh.js";import{F as le}from"./BWb0wtYlb2uY.js";import{F as ce}from"./CvnLF8f4wA4h.js";import{H as Me}from"./acHtOUjA-7Il.js";import{u as D}from"./BYfhXZxVx1YD.js";import{c as C,s as Xe}from"./D5SQLjy-_82v.js";import{c as Bt}from"./uuuD2LZFgwH5.js";import{F as Wt}from"./B2FYvygtgI3E.js";import{_ as zt}from"./CmsKOCeNyeyo.js";const w={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class me extends ht{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+ft,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(w.ELEMENT,this.handleElementChanged),this.addChangeListener(w.MAP,this.handleMapChanged),this.addChangeListener(w.OFFSET,this.handleOffsetChanged),this.addChangeListener(w.POSITION,this.handlePositionChanged),this.addChangeListener(w.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(w.ELEMENT)}getId(){return this.id}getMap(){return this.get(w.MAP)||null}getOffset(){return this.get(w.OFFSET)}getPosition(){return this.get(w.POSITION)}getPositioning(){return this.get(w.POSITIONING)}handleElementChanged(){gt(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),mt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=pt(e,yt.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(w.ELEMENT,e)}setMap(e){this.set(w.MAP,e)}setOffset(e){this.set(w.OFFSET,e)}setPosition(e){this.set(w.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(w.POSITION))return;const s=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),i=this.getRect(n,[vt(n),_t(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!St(s,i)){const a=i[0]-s[0],c=s[2]-i[2],f=i[1]-s[1],g=s[3]-i[3],y=[0,0];if(a<0?y[0]=a-o:c<0&&(y[0]=Math.abs(c)+o),f<0?y[1]=f-o:g<0&&(y[1]=Math.abs(g)+o),y[0]!==0||y[1]!==0){const b=t.getView().getCenterInternal(),_=t.getPixelFromCoordinateInternal(b);if(!_)return;const M=[_[0]+y[0],_[1]+y[1]],m=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(M),duration:m.duration,easing:m.easing})}}}getRect(e,t){const s=e.getBoundingClientRect(),n=s.left+window.pageXOffset,i=s.top+window.pageYOffset;return[n,i,n+t[0],i+t[1]]}setPositioning(e){this.set(w.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const s=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(s,n)}updateRenderedPosition(e,t){const s=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px";let c="0%",f="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?c="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(c="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?f="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(f="-50%");const g=`translate(${c}, ${f}) translate(${o}, ${a})`;this.rendered.transform_!=g&&(this.rendered.transform_=g,s.transform=g)}getOptions(){return this.options}}const Cn=wt;async function Kt(r,e,t,s){const i=s.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),o=await r.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${i}>`}});if(!o||!o.ok||o.status!==201)throw new Error("Request failed: "+o.status);const a=o.headers.get("location");if(!a)throw new Error("Request failed: no Location response header");const c=a.substring(a.lastIndexOf("/")+1);return Promise.resolve(c)}async function Jt(r,e,t,s,n){const o=n.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),a=new URL(`${e.toString()}/${t}`),c=await r.fetch(a,{method:"PATCH",body:JSON.stringify({type:"Feature",properties:{},geometry:s}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${o}>`}});if(!c||!c.ok||c.status!==204)throw new Error("Request failed: "+c.status);return Promise.resolve(t)}function Ye(r,e){const t=document.createElement("div");t.className="editing-tooltip editing-tooltip-hidden",t.role="tooltip";const s=document.createElement("span");s.textContent=e,t.appendChild(s);const n=new me({element:t,offset:[15,0],positioning:"center-left"}),i=r.on("pointermove",o=>{o.dragging||n.setPosition(o.coordinate)});return r.addOverlay(n),{destroy(){k(i),r.removeOverlay(n)},setVisible(o){t.classList.toggle("editing-tooltip-hidden",!o)},setText(o){s.textContent=o}}}function Ze(r){let e=Te(r.polygon);Array.isArray(e)&&(e=e[0]);let t=Te(r.vertex);Array.isArray(t)&&(t=t[0]);const s=[];return e&&s.push(e),t&&(t.setGeometry(qt),s.push(t)),s}const qt=r=>{if(r){const e=r.getGeometry();if(e&&e.getType()==="Polygon"){const t=e.getCoordinates()[0];if(t)return new Nt(t)}}},Te=r=>{const e=new Ve,s=new fe({style:r}).getStyleFunction();if(!s)throw new Error("can't retrieve style function");const n=s(e,1);if(!n)throw new Error("can't retrieve styles from feature style function");return Array.isArray(n)&&n.length?n.length>1?n:n[0]:n},Xt=te("editing:EditingCreateWorkflowImpl");var L;class Yt{constructor(e){p(this,L);u(this,"_httpService");u(this,"_intl");u(this,"_map");u(this,"_polygonStyle");u(this,"_vertexStyle");u(this,"_state");u(this,"_editLayerURL");u(this,"_featureId");u(this,"_editingSource");u(this,"_editingLayer");u(this,"_drawInteraction");u(this,"_olMap");u(this,"_tooltip");u(this,"_enterHandler");u(this,"_escapeHandler");u(this,"_error");u(this,"_interactionListener");u(this,"_mapListener");this._httpService=e.httpService,this._intl=e.intl,this._polygonStyle=e.polygonStyle,this._vertexStyle=e.vertexStyle,this._map=e.map,this._olMap=e.map.olMap,this._state=Ee("active:initialized"),this._editLayerURL=e.ogcApiFeatureLayerUrl,this._editingSource=new xe,this._editingLayer=new fe({source:this._editingSource,zIndex:Ce,properties:{name:"editing-layer"}}),this._drawInteraction=new Je({source:this._editingSource,type:"Polygon",style:Ze({polygon:this._polygonStyle,vertex:this._vertexStyle})}),this._tooltip=Ye(this._olMap,this._intl.formatMessage({id:"create.tooltip.begin"})),this._enterHandler=t=>{if((t.code==="Enter"||t.code==="NumpadEnter")&&t.target===this._olMap.getTargetElement()){const s=this._drawInteraction.getOverlay().getSource()?.getFeatures()??[];s[0]&&s[0].getGeometry().getCoordinates()[0].length>4&&this.triggerSave()}},this._escapeHandler=t=>{t.code==="Escape"&&t.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state.value}_setState(e){this._state.value=e}_save(e){this._setState("active:saving");const t=this._editLayerURL,s=e.getGeometry();if(!s){this._destroy(),this._error=new Error("no geometry available"),d(this,L)?.reject(this._error);return}const n=this._olMap.getView().getProjection(),o=new Ke({dataProjection:n}).writeGeometryObject(s,{rightHanded:!0,decimals:10});this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),Kt(this._httpService,t,o,n).then(a=>{this._featureId=a,this._destroy(),d(this,L)?.resolve({featureId:this._featureId})}).catch(a=>{Xt.error(a),this._destroy(),this._error=new Error("Failed to save feature",{cause:a}),d(this,L)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._drawInteraction);const e=Ge(()=>{const n=this._map.container;if(n)return n.addEventListener("keydown",this._enterHandler,!1),n.addEventListener("keydown",this._escapeHandler,!1),()=>{n.removeEventListener("keydown",this._enterHandler),n.removeEventListener("keydown",this._escapeHandler)}});this._tooltip.setVisible(!0);const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.continue"}))}),s=this._drawInteraction.on("drawend",n=>{const i=n.feature;if(!i){this._destroy(),this._error=new Error("no feature available"),d(this,L)?.reject(this._error);return}this._save(i)});this._interactionListener.push(t,s),this._mapListener.push(e)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.begin"})),this._setState("active:initialized")}stop(){this._destroy(),d(this,L)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.forEach(e=>{k(e)}),this._mapListener.forEach(e=>{e.destroy()}),this._setState("destroyed")}triggerSave(){this._drawInteraction.finishDrawing()}whenComplete(){return this._state.value==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(d(this,L)??v(this,L,Ue())).promise}}L=new WeakMap;var E;class Zt{constructor(e){p(this,E);u(this,"_httpService");u(this,"_intl");u(this,"_map");u(this,"_polygonStyle");u(this,"_vertexStyle");u(this,"_state");u(this,"_editLayerURL");u(this,"_featureId");u(this,"_initialFeature");u(this,"_editFeature");u(this,"_editingSource");u(this,"_editingLayer");u(this,"_modifyInteraction");u(this,"_olMap");u(this,"_tooltip");u(this,"_enterHandler");u(this,"_escapeHandler");u(this,"_error");u(this,"_interactionListener");u(this,"_mapListener");this._httpService=e.httpService,this._intl=e.intl,this._polygonStyle=e.polygonStyle,this._vertexStyle=e.vertexStyle,this._map=e.map,this._olMap=e.map.olMap,this._state=Ee("active:initialized"),this._editLayerURL=e.ogcApiFeatureLayerUrl,this._initialFeature=e.feature.clone(),this._initialFeature.setId(e.feature.getId()),this._editFeature=e.feature.clone(),this._editFeature.setId(e.feature.getId()),this._editFeature.setStyle(Ze({polygon:this._polygonStyle,vertex:this._vertexStyle})),this._editingSource=new xe({features:new Mt([this._editFeature])}),this._editingLayer=new fe({source:this._editingSource,zIndex:Ce,properties:{name:"editing-layer"}}),this._modifyInteraction=new At({source:this._editingSource}),this._tooltip=Ye(this._olMap,this._intl.formatMessage({id:"create.tooltip.deselect"})),this._enterHandler=t=>{if((t.code==="Enter"||t.code==="NumpadEnter")&&t.target===this._olMap.getTargetElement()){const s=this._editingSource.getFeatures()[0];if(!s)throw Error("no updated feature found");this._save(s)}},this._escapeHandler=t=>{t.code==="Escape"&&t.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getModifyInteraction(){return this._modifyInteraction}getState(){return this._state.value}_setState(e){this._state.value=e}_save(e){this._setState("active:saving");const t=this._editLayerURL;if(this._featureId=e.getId()?.toString(),!this._featureId){this._destroy(),this._error=new Error("no feature id available"),d(this,E)?.reject(this._error);return}const s=e?.getGeometry();if(!s){this._destroy(),this._error=new Error("no geometry available"),d(this,E)?.reject(this._error);return}const n=this._olMap.getView().getProjection(),o=new Ke({dataProjection:n}).writeGeometryObject(s,{rightHanded:!0,decimals:10});this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),Jt(this._httpService,t,this._featureId,o,n).then(a=>{this._destroy(),d(this,E)?.resolve({featureId:a})}).catch(a=>{this._destroy(),this._error=new Error("Failed to save feature",{cause:a}),d(this,E)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._modifyInteraction);const e=this._editingSource.getFeatures()[0];if(e&&!e.getId()?.toString()){this._destroy(),this._error=new Error("no feature id available"),d(this,E)?.reject(this._error);return}const t=Ge(()=>{const i=this._map.container;if(i)return i.addEventListener("keydown",this._enterHandler,!1),i.addEventListener("keydown",this._escapeHandler,!1),()=>{i.removeEventListener("keydown",this._enterHandler),i.removeEventListener("keydown",this._escapeHandler)}});this._tooltip.setVisible(!0);const s=this._map.olMap.on("click",i=>{const o=i.coordinate,a=i.originalEvent.altKey,c=this._editingSource.getFeaturesAtCoordinate(o);a||c.length===0&&this.triggerSave()}),n=this._modifyInteraction.on("modifystart",()=>{this._setState("active:drawing")});this._interactionListener.push(s,n),this._mapListener.push(t)}reset(){const e=this._initialFeature.getGeometry()?.clone(),t=this._editingSource.getFeatures()[0];if(!t)throw Error("no updated feature found");t.setGeometry(e),this._setState("active:initialized")}stop(){this._destroy(),d(this,E)?.resolve(void 0)}_destroy(){this._editingSource.clear(),this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),this._interactionListener.forEach(e=>{k(e)}),this._mapListener.forEach(e=>{e.destroy()}),this._setState("destroyed")}triggerSave(){const e=this._editingSource.getFeatures()[0];if(!e)throw Error("no updated feature found");this._save(e)}whenComplete(){return this._state.value==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(d(this,E)??v(this,E,Ue())).promise}}E=new WeakMap;class Pn{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}createFeature(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const s=e.id;let n=this._workflows.get(s);if(n)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return n=new Yt({map:e,ogcApiFeatureLayerUrl:t,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(s,n),this._connectToWorkflowDestroyEvent(n,s),n}updateFeature(e,t,s){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const n=e.id;let i=this._workflows.get(n);if(i)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return i=new Zt({map:e,ogcApiFeatureLayerUrl:t,feature:s,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(n,i),this._connectToWorkflowDestroyEvent(i,n),i}stop(e){const t=this._workflows.get(e);t&&t.stop()}reset(e){const t=this._workflows.get(e);if(t)t.reset();else throw new Error("No workflow found for mapId: "+e)}_connectToWorkflowDestroyEvent(e,t){const s=bt(()=>[e.getState()],([n])=>{n==="destroyed"&&(this._workflows.get(t)===e&&this._workflows.delete(t),s.destroy())})}}var j,O,B,W,z,be;class Qt{constructor(e,t,s){p(this,z);u(this,"label");p(this,j,Ee({kind:"available"}));p(this,O);p(this,B);p(this,W);this.label=t,v(this,O,e),v(this,W,s),G(this,z,be).call(this),v(this,B,d(this,O).on("change:visible",()=>{G(this,z,be).call(this)}))}destroy(){k(d(this,B))}get status(){return d(this,j).value}async select(e,t){if(e.type!=="extent")throw new Error(`Unsupported selection kind: ${e.type}`);if(d(this,j).value.kind!=="available"||d(this,O).getSource()===null)return[];const s=[];d(this,O).getSource().forEachFeatureIntersectingExtent(e.extent,o=>{if(!o.getGeometry())return;const a={...o.getProperties()};delete a.geometries;const c={id:o.getId()?.toString()||Et(),geometry:o.getGeometry(),properties:a};s.push(c)});const n=s.filter(o=>o!=null);return n.length>t.maxResults?n.slice(0,t.maxResults):n}}j=new WeakMap,O=new WeakMap,B=new WeakMap,W=new WeakMap,z=new WeakSet,be=function(){const t=d(this,O).getVisible()?{kind:"available"}:{kind:"unavailable",reason:d(this,W)};t.kind!==d(this,j).value.kind&&(d(this,j).value=t)};var K;class Ln{constructor({intl:e}){p(this,K);v(this,K,e)}createSelectionSource(e){return new Qt(e.vectorLayer,e.label,d(this,K).formatMessage({id:"layerNotVisibleReason"}))}}K=new WeakMap;const es=Bt({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"}),ts="@open-pioneer/legend",Qe=Z.bind(void 0,ts),In=r=>{const{showBaseLayers:e=!1}=r,{containerProps:t}=Q("legend",r),{map:s}=ee(r);return l.jsx(I,{...t,children:s?l.jsx(ss,{map:s,showBaseLayers:e}):null})};function ss(r){const{map:e,showBaseLayers:t}=r,n=rs(e).map(i=>l.jsx(et,{layer:i,showBaseLayers:t},i.id));return l.jsx(Vt,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:n})}function et(r){const{layer:e,showBaseLayers:t}=r,s=H(()=>e.visible,[e]),n=is(e);if(!s||!t&&Ht(e)&&tt(e))return;const i=[];return n?.length&&n.forEach(o=>{i.push(l.jsx(et,{layer:o,showBaseLayers:t},o.id))}),l.jsxs(l.Fragment,{children:[l.jsx(ns,{layer:e,showBaseLayers:t}),i]})}function ns(r){const e=Qe(),{layer:t,showBaseLayers:s}=r,n=tt(t),i=os(t),o=H(()=>t.legend,[t]);let a;return i?.Component?a=l.jsx(i.Component,{layer:t}):i?.imageUrl?a=l.jsx(je,{layer:t,imageUrl:i.imageUrl}):o&&(a=l.jsx(je,{layer:t,imageUrl:o})),a?l.jsxs(I,{as:"li",className:ge("legend-item",`layer-${as(t.id)}`),children:[s&&n?l.jsx(ae,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,a]}):void 0}function je(r){const e=Qe(),{layer:t,imageUrl:s}=r;return l.jsxs(I,{children:[l.jsx(ae,{children:t.title}),l.jsx(Gt,{maxW:"none",maxH:"none",src:s,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:l.jsx(I,{children:l.jsxs(ae,{children:[l.jsx(Rt,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function rs(r){return H(()=>{const e=r.layers.getAllLayers({sortByDisplayOrder:!0})??[];return e.reverse(),e},[r])}function is(r){return H(()=>{const e=r.sublayers?.getSublayers({sortByDisplayOrder:!0});if(e)return e.reverse(),e},[r])}function os(r){return H(()=>r.attributes.legend,[r])}function tt(r){return!("parentLayer"in r)&&r.isBaseLayer}function as(r){return r.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const ls="@open-pioneer/measurement",cs=Z.bind(void 0,ls);class us{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;activeMeasurement;predefinedMeasurements=new Map;finishedMeasurements=new Set;helpTooltip;resources=[];measurementChangedHandler;constructor(e,t){this.olMap=e,this.messages=t;const s=this.source=new xe;this.layer=new fe({source:s,zIndex:Ce,properties:{name:"measurement-layer"}}),e.addLayer(this.layer);const n=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){k(n)}});const i=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",i),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",i)}}),this.helpTooltip=hs(this.olMap)}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.activeMeasurement=ke(this.activeMeasurement);for(const e of this.finishedMeasurements)e.destroy();this.finishedMeasurements.clear(),this.helpTooltip.destroy(),this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose(),this.measurementChangedHandler=void 0,this.predefinedMeasurements.clear()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setMeasurementSourceChangedHandler(e){this.measurementChangedHandler=e}setPredefinedMeasurements(e){this.updatePredefinedMeasurements(e)}setActiveFeatureStyle(e){const t=xt(e);this.activeFeatureStyle=(s,...n)=>{const i=s?.getGeometry()?.getType();if(i==="Polygon"||i==="LineString"||i==="Point")return t(s,...n)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){const e=this.source.getFeatures();this.source.clear(),e.forEach(t=>{this.raiseMeasurementsChangeEvent("remove-measurement",t)}),this.predefinedMeasurements.clear();for(const t of this.finishedMeasurements)t.destroy();this.finishedMeasurements.clear()}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",s=this.draw=new Je({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(s);let n,i;s.on("drawstart",o=>{const a=o.feature;a&&(n=this.activeMeasurement=new Ne("active",a,this),i=a.getGeometry()?.on("change",()=>{n?.updateTooltipContent(),n?.updateTooltipPosition()}))}),s.on("drawend",()=>{if(n&&n===this.activeMeasurement){const o=n;o.updateState("finished"),this.finishedMeasurements.add(o),this.raiseMeasurementsChangeEvent("add-measurement",o.feature),this.activeMeasurement=n=void 0}n=void 0,i&&k(i)}),s.on("drawabort",()=>{n&&(n.destroy(),n===this.activeMeasurement&&(this.activeMeasurement=void 0),n=void 0),i&&k(i)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.activeMeasurement=ke(this.activeMeasurement)}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,s=gs(this.messages,this.activeMeasurement);t.setText(s),t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}updatePredefinedMeasurements(e){const t=e.filter(n=>!this.predefinedMeasurements.has(n)),s=[];for(const n of this.predefinedMeasurements.keys())e.includes(n)||s.push(n);t.forEach(n=>{const i=new Ve(n);this.source.addFeature(i);const o=new Ne("finished",i,this);this.finishedMeasurements.add(o),this.predefinedMeasurements.set(n,o),this.raiseMeasurementsChangeEvent("add-measurement",i)}),s.forEach(n=>{const i=this.predefinedMeasurements.get(n);i&&(this.source.removeFeature(i.feature),this.finishedMeasurements.delete(i),i.destroy(),this.raiseMeasurementsChangeEvent("remove-measurement",i.feature)),this.predefinedMeasurements.delete(n)})}raiseMeasurementsChangeEvent(e,t){const s=t.getGeometry();this.measurementChangedHandler&&s&&this.measurementChangedHandler({kind:e,geometry:(s instanceof ie,s)})}}class Ne{controller;feature;_state;tooltip;constructor(e,t,s){this.controller=s,this._state=e,this.feature=t,this.tooltip=fs(this.olMap),this.updateTooltipContent(),this.updateTooltipPosition(),this.tooltip.setActive(e==="active")}destroy(){this.tooltip.destroy()}get state(){return this._state}updateState(e){this._state!==e&&(this._state=e,this.tooltip.setActive(e==="active"))}updateTooltipContent(){const e=this.feature.getGeometry();if(!e)return;const t=this.olMap.getView().getProjection();let s;e instanceof ie?s=ms(e,t,this.messages):e instanceof we&&(s=ps(e,t,this.messages)),s&&this.tooltip.setHtml(s)}updateTooltipPosition(){const e=this.feature.getGeometry();if(!e)return;let t;if(e instanceof ie)t=e.getInteriorPoint().getCoordinates()||null;else if(e instanceof we)t=e.getLastCoordinate()||null;else return;this.tooltip.overlay.setPosition(t)}get olMap(){return this.controller.olMap}get messages(){return this.controller.messages}}const Ae=[0,-15],ds=[0,-7];function hs(r){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const s=new me({element:e,offset:[15,0],positioning:"center-left"});return r.addOverlay(s),{overlay:s,element:e,destroy(){r.removeOverlay(s)},setText(n){t.textContent=n},setHtml(n){t.innerHTML=n}}}function fs(r){const e=document.createElement("div");e.role="tooltip",e.className="measurement-tooltip measurement-active-tooltip printing-hide";const t=document.createElement("span");e.appendChild(t);const s=new me({element:e,offset:Ae,positioning:"bottom-center",stopEvent:!1,insertFirst:!1});return r.addOverlay(s),{overlay:s,element:e,destroy(){r.removeOverlay(s)},setActive(n){n?(e.className="measurement-tooltip measurement-active-tooltip printing-hide",s.setOffset(Ae)):(e.className="measurement-tooltip measurement-finished-tooltip",s.setOffset(ds))},setText(n){t.textContent=n},setHtml(n){t.innerHTML=n}}}function gs(r,e){if(e){const t=e.feature.getGeometry();if(t instanceof ie||t instanceof we)return r.getContinueMessage()}return r.getHelpMessage()}function ms(r,e,t){const s=Ct(r,{projection:e});let n;return s>=1e6?n=`${t.formatNumber(s/1e6)} km<sup>2</sup>`:n=`${t.formatNumber(s)} m<sup>2</sup>`,n}function ps(r,e,t){const s=Pt(r,{projection:e});let n;return s>=1e3?n=`${t.formatNumber(s/1e3)} km`:n=`${t.formatNumber(s)} m`,n}const Fn=r=>{const e=cs(),{containerProps:t}=Q("measurement",r),[s,n]=h.useState("distance"),i=g=>e.formatMessage({id:g}),o=ee(r),a=ys(o.map,r,e);h.useEffect(()=>{if(a)return a.startMeasurement(s),()=>{a.stopMeasurement()}},[a,s]);function c(g){if(g==="distance"||g==="area")n(g);else throw new Error(`Unexpected measurement type: '${g}'.`)}function f(){a?.clearMeasurements()}return l.jsxs(I,{...t,children:[l.jsx(ae,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),l.jsx(le,{mb:4,alignItems:"center",children:l.jsxs(Me,{mb:2,children:[l.jsx(ce,{mb:1,children:i("measurementLabel")}),l.jsxs(qe,{value:s,onChange:g=>c(g.target.value),className:"measurement-select",children:[l.jsx("option",{value:"distance",children:i("distance")}),l.jsx("option",{value:"area",children:i("area")})]})]})}),l.jsx(Be,{padding:2,className:"measurement-delete-button",onClick:f,width:"100%",children:i("deleteMeasurementLabel")})]})};function ys(r,e,t){const{activeFeatureStyle:s,finishedFeatureStyle:n,onMeasurementsChange:i,predefinedMeasurements:o}=e,[a,c]=h.useState(void 0);return h.useEffect(()=>{if(!r)return;const f=new us(r.olMap,{getContinueMessage(){return t.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return t.formatMessage({id:"tooltips.help"})},formatNumber(g){return t.formatNumber(g,{maximumFractionDigits:2})}});return c(f),()=>{f.destroy(),c(void 0)}},[r,t]),h.useEffect(()=>{a?.setActiveFeatureStyle(s??vs())},[a,s]),h.useEffect(()=>{a?.setFinishedFeatureStyle(n??_s())},[a,n]),h.useEffect(()=>{a?.setMeasurementSourceChangedHandler(i)},[a,i]),h.useEffect(()=>{a?.setPredefinedMeasurements(o??[])},[a,o]),a}function vs(){return[new oe({stroke:new U({color:"#fff",lineDash:[10,10],width:5})}),new oe({fill:new Se({color:"rgba(0,0,0,0.15)"}),stroke:new U({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new Lt({radius:5,stroke:new U({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new Se({color:"rgba(255, 255, 255, 0.2)"})})})]}function _s(){return[new oe({stroke:new U({color:"#fff",width:5})}),new oe({stroke:new U({color:"#0b96fc",width:3}),fill:new Se({color:"rgba(11,150,252,0.15)"})})]}const Ss="@open-pioneer/search",pe=Z.bind(void 0,Ss);function ws(r){const e=r.selectProps.inputValue.length>0,t={...r,className:ge(r.className,{"search-invisible":!e})};return l.jsx(C.Menu,{...t,children:r.children})}function Ms(r){const e=r.data.label,t={...r.innerProps,"aria-label":e,role:"group"};return l.jsx(C.Group,{...r,innerProps:t})}function bs(r){const t=pe().formatMessage({id:"noOptionsText"});return l.jsx(C.NoOptionsMessage,{...r,children:l.jsx(se.span,{className:"search-no-match",children:t})})}function Es(r){const t=pe().formatMessage({id:"loadingText"});return l.jsx(C.LoadingMessage,{...r,children:l.jsx(se.span,{className:"search-loading-text",children:t})})}function xs({children:r,...e}){const t={...e,className:ge(e.className,"search-value-container")};return l.jsxs(C.ValueContainer,{...t,children:[!!r&&l.jsx(es,{style:{position:"absolute",left:8}}),r]})}function Cs(r){const e={...r,isHidden:!1};return l.jsx(C.Input,{...e})}function Ps(r){return null}function Ls(r){return l.jsxs(C.IndicatorsContainer,{...r,children:[r.children,!r.selectProps.isLoading&&r.selectProps.inputValue&&l.jsx(Is,{selectProps:r.selectProps,clearValue:r.clearValue})]})}function Is(r){const t=pe().formatMessage({id:"ariaLabel.clearButton"}),s=n=>{n.preventDefault(),n.stopPropagation(),r.clearValue()};return l.jsx(Ft,{role:"button",size:"md",mr:1,"aria-label":t,onClick:s,onTouchEnd:s,onMouseDown:n=>n.preventDefault()})}function Fs(r){return null}function Os(r){const e=r.selectProps.inputValue,t=r.data.label,s={...r,className:ge(r.className,"search-option")};return l.jsx(C.Option,{...s,children:l.jsx(se.div,{className:"search-option-label",children:e.trim().length>0?ks(t,e):t})})}function ks(r,e){const t=r.toLowerCase().indexOf(e.toLowerCase());return t>=0?l.jsxs(l.Fragment,{children:[r.substring(0,t),l.jsx(se.span,{className:"search-highlighted-match",children:r.substring(t,t+e.length)},"highlighted"),r.substring(t+e.length)]}):r}const Re=te("search:SearchController"),De=200,He=5;var J,N,A,R,x,de,st;class Ts{constructor(e,t){p(this,de);p(this,J);p(this,N,[]);p(this,A,He);p(this,R,De);p(this,x);v(this,J,e),v(this,N,t)}destroy(){d(this,x)?.abort(),v(this,x,void 0)}async search(e){if(d(this,x)?.abort(),v(this,x,void 0),!e)return[];const t=v(this,x,new AbortController);try{return await js(t.signal,d(this,R)),t.signal.aborted&&(Re.debug(`search canceled with ${e}`),Ot()),(await Promise.all(d(this,N).map(n=>G(this,de,st).call(this,n,e,t.signal)))).filter(n=>n!=null)}finally{d(this,x)===t&&v(this,x,void 0)}}get searchTypingDelay(){return d(this,R)}set searchTypingDelay(e){v(this,R,e??De)}get maxResultsPerSource(){return d(this,A)}set maxResultsPerSource(e){v(this,A,e??He)}get sources(){return d(this,N)}}J=new WeakMap,N=new WeakMap,A=new WeakMap,R=new WeakMap,x=new WeakMap,de=new WeakSet,st=async function(e,t,s){const n=e.label,i=d(this,J).olMap.getView().getProjection();try{const o=d(this,A);let a=await e.search(t,{maxResults:o,signal:s,mapProjection:i});return a.length>o&&(a=a.slice(0,o)),{label:n,source:e,results:a}}catch(o){We(o)||Re.error(`search for source ${n} failed`,o);return}};async function js(r,e){r.aborted||await new Promise(t=>{const s=()=>{r.removeEventListener("abort",s),clearTimeout(n),t()};r.addEventListener("abort",s);const n=setTimeout(s,e)})}const ue=te("search:Search"),On=r=>{const{sources:e,searchTypingDelay:t,maxResultsPerGroup:s,onSelect:n,onClear:i}=r,{containerProps:o}=Q("search",r),{map:a}=ee(r),c=pe(),f=Ds(e,t,s,a),{input:g,search:y,selectedOption:b,onInputChanged:_,onResultConfirmed:M}=Hs(f),m=Rs(),T=Ns(c),V=As(),ye=D((P,ne)=>{ne.action==="input-change"&&_(P)}),S=D((P,ne)=>{switch(ne.action){case"select-option":P&&(M(P),n?.({source:P.source,result:P.result}));break;case"clear":_(""),F.current?.blur(),F.current?.focus(),i?.();break;default:ue.debug(`Unhandled action type '${ne.action}'.`);break}}),F=h.useRef(null);return l.jsx(I,{...o,children:l.jsx(Xe,{className:"search-component",classNamePrefix:"react-select",ref:F,inputValue:g,onInputChange:ye,"aria-label":c.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:T,tagColorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:m,isClearable:!0,placeholder:r.placeholder??c.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:y.kind==="loading",options:y.kind==="ready"?y.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:V,onChange:S,value:b,menuPosition:"fixed"})})};function Ns(r){return h.useMemo(()=>({onFocus:()=>"",onChange:()=>"",guidance:()=>`${r.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[r])}function As(){return h.useMemo(()=>({Menu:ws,Input:Cs,SingleValue:Ps,Option:Os,NoOptionsMessage:bs,LoadingMessage:Es,ValueContainer:xs,IndicatorsContainer:Ls,ClearIndicator:Fs,Group:Ms}),[])}function Rs(){const[r,e,t]=ze("colors",["trails.100","trails.50","trails.500"],["#d5e5ec","#eaf2f5","#1A202C"]);return h.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:r,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e},_selected:{backgroundColor:t}}),dropdownIndicator:n=>({...n,display:"none"})}),[r,e,t])}function Ds(r,e,t,s){const[n,i]=h.useState(void 0);return h.useEffect(()=>{if(!s)return;const o=new Ts(s,r);return i(o),()=>{o.destroy(),i(void 0)}},[s,r]),h.useEffect(()=>{n&&(n.searchTypingDelay=e)},[n,e]),h.useEffect(()=>{n&&(n.maxResultsPerSource=t)},[n,t]),n}function Hs(r){const[e,t]=h.useReducer((a,c)=>{switch(c.kind){case"input":return{...a,query:c.query,selectedOption:null};case"select-option":return{...a,selectedOption:c.option,query:c.option.label};case"load-results":return{...a,search:{kind:"loading"}};case"accept-results":return{...a,search:{kind:"ready",results:c.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),s=h.useRef(),n=D(a=>{if(!r){s.current=void 0,t({kind:"accept-results",results:[]});return}ue.isDebug()&&ue.debug(`Starting new search for query ${JSON.stringify(a)}.`),t({kind:"load-results"});const c=s.current=Vs(r,a).then(f=>{s.current===c&&t({kind:"accept-results",results:f})})}),i=h.useCallback(a=>{t({kind:"select-option",option:a})},[]),o=h.useCallback(a=>{t({kind:"input",query:a}),n(a)},[n]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:i,onInputChanged:o}}async function Vs(r,e){let t;try{t=await r.search(e)}catch(s){We(s)||ue.error("Search failed",s),t=[]}return Gs(t)}function Gs(r){return r.map((t,s)=>({label:t.label,options:t.results.map(n=>({value:`${s}-${n.id}`,label:n.label,source:t.source,result:n}))}))}const nt="@open-pioneer/selection",$s=$e.bind(void 0,nt),Pe=Z.bind(void 0,nt),$="selection-active",re="selection-inactive";class Us{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,s,n){const i=this.initViewport(e);this.interactionResources.push(this.createDragBox(e,n,i,this.interactionResources)),this.interactionResources.push(this.createDrag(e,i,this.interactionResources)),this.tooltip=this.createHelpTooltip(e,t),this.olMap=e,this.tooltipMessage=t,this.tooltipDisabledMessage=s}initViewport(e){const t=e.getViewport();return t.classList.add($),t.oncontextmenu=s=>(s.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(s=>this.olMap.addInteraction(s.interaction)),this.tooltip.setText(this.tooltipMessage),t.classList.remove(re),t.classList.add($),this.isActive=!0):(this.interactionResources.forEach(s=>this.olMap.removeInteraction(s.interaction)),this.tooltip.setText(this.tooltipDisabledMessage),t.classList.remove($),t.classList.add(re),this.isActive=!1)}createDragBox(e,t,s,n){const i=new Ie({className:"selection-drag-box",condition:It});return e.addInteraction(i),i.on("boxend",function(){t(i.getGeometry())}),{interaction:i,destroy(){e.removeInteraction(i),n.splice(n.indexOf(this)),i.dispose(),s.classList.remove($),s.classList.remove(re),s.oncontextmenu=null}}}createDrag(e,t,s){const n=function(a){return a.originalEvent.button==2},i=new Fe({condition:n});return e.addInteraction(i),{interaction:i,destroy(){e.removeInteraction(i),s.splice(s.indexOf(this)),i.dispose(),t.classList.remove($),t.classList.remove(re),t.oncontextmenu=null}}}createHelpTooltip(e,t){const s=document.createElement("div");s.className="selection-tooltip printing-hide",s.role="tooltip";const n=document.createElement("span");n.textContent=t,s.appendChild(n);const i=new me({element:s,offset:[15,0],positioning:"center-left"}),o=e.on("pointermove",a=>{i.setPosition(a.coordinate)});return e.addOverlay(i),{overlay:i,element:s,destroy(){e.removeOverlay(i),i.dispose(),k(o)},setText(a){n.textContent=a}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Ie)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Fe)}}const _e=te("selection:SelectionController"),Bs=1e4;var q,X,Y,he,rt;class Ws{constructor(e){p(this,he);p(this,q);p(this,X);p(this,Y);const{mapModel:t,onError:s,maxResults:n=Bs}=e;v(this,q,t),v(this,X,n),v(this,Y,s)}destroy(){}async select(e,t){if(t)return await G(this,he,rt).call(this,e,t)}}q=new WeakMap,X=new WeakMap,Y=new WeakMap,he=new WeakSet,rt=async function(e,t){const s=d(this,q).olMap.getView().getProjection();try{_e.debug(`Starting selection on source '${e.label}'`);const n=d(this,X);let i=await e.select({type:"extent",extent:t},{maxResults:n,mapProjection:s,signal:new AbortController().signal});return i.length>n&&(i=i.slice(0,n)),_e.debug(`Found ${i.length} results on source '${e.label}'`),{source:e,results:i}}catch(n){_e.error(`selection from source ${e.label} failed`,n),d(this,Y).call(this);return}};const zs={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},kn=r=>{const e=Pe(),{sources:t,onSelectionComplete:s,onSelectionSourceChanged:n}=r,{containerProps:i}=Q("selection",r),o=e.formatMessage({id:"sourceNotAvailable"}),[a,c]=qs(t,n),f=at(a,o),g=ee(r),{onExtentSelected:y}=Xs(g.map,t,a,s),b=Zs(),[_,M]=h.useState(!1);Ys(g.map,e,y,f.kind==="available",!!a);const m=h.useMemo(()=>t.map(S=>({label:S.label,value:S})),[t]),T=h.useMemo(()=>m.find(F=>F.value===a)||null,[m,a]),V=D(S=>{c(S?.value)}),ye=D(S=>{!_&&S.key==="Enter"&&M(!0)});return l.jsx(kt,{...i,spacing:2,children:l.jsxs(le,{children:[l.jsx(ce,{children:e.formatMessage({id:"selectSource"})}),l.jsx(Xe,{className:"selection-source react-select",...zs,options:m,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:T,onChange:V,components:{Option:Ks,SingleValue:Js},isOptionDisabled:()=>!1,getOptionLabel:S=>{const F=S.label,P=ot(S.value,o);return P.kind=="available"?F:F+" "+P.reason},ariaLiveMessages:{guidance:()=>"",onChange:S=>S.action=="select-option"||S.action=="initial-input-focus"?S.label+" "+e.formatMessage({id:"selected"}):"",onFilter:()=>"",onFocus:()=>""},chakraStyles:b,onKeyDown:ye,menuIsOpen:_,onMenuOpen:()=>M(!0),onMenuClose:()=>M(!1)})]})})};function Ks(r){const{value:e}=r.data,{isAvailable:t,content:s}=it(e,!1);return l.jsx(C.Option,{...r,isDisabled:!t,className:"selection-source-option",children:s})}function Js(r){const{value:e}=r.data,{isAvailable:t,content:s}=it(e,!0),n=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return l.jsx(C.SingleValue,{...r,isDisabled:!t,className:n,children:s})}function qs(r,e){const[t,s]=h.useState(()=>r[0]);h.useEffect(()=>{t&&!r.includes(t)&&s(void 0)},[r,t]);const n=h.useRef(void 0);return h.useEffect(()=>{t!==n.current&&(n.current=t,e?.({source:t}))},[t,e]),[t,s]}function it(r,e){const t=Pe(),s=r?.label,n=t.formatMessage({id:"sourceNotAvailable"}),i=at(r,n);return{isAvailable:i.kind==="available",content:l.jsxs(Oe,{direction:"row",alignItems:"center",grow:1,children:[!e&&l.jsx(Oe,{grow:1,children:s}),i.kind==="unavailable"&&l.jsx(I,{ml:2,children:l.jsx(Tt,{label:i.reason,placement:"right",openDelay:500,children:l.jsx(se.span,{children:l.jsx(jt,{as:Wt,color:"red",className:"warning-icon","aria-label":i.reason})})})}),e&&s]})}}function Xs(r,e,t,s){const n=$s("notifier.NotificationService"),i=Pe(),[o,a]=h.useState(void 0);h.useEffect(()=>{if(!r)return;const f=new Ws({mapModel:r,onError(){n.notify({level:"error",message:i.formatMessage({id:"selectionFailed"})})}});return a(f),()=>{f.destroy()}},[r,n,e,i]);const c=D(async f=>{if(!o||!t)return;const g=await o.select(t,f.getExtent());g&&s?.(g)});return{controller:o,onExtentSelected:c}}function ot(r,e){const t=r.status??"available",s=typeof t=="string"?{kind:t}:t;return s.kind==="available"?s:{kind:"unavailable",reason:s.reason??e}}function at(r,e){return H(()=>r?ot(r,e):{kind:"unavailable",reason:e},[r,e])}function Ys(r,e,t,s,n){h.useEffect(()=>{if(!r)return;const i=n?e.formatMessage({id:"disabledTooltip"}):e.formatMessage({id:"noSourceTooltip"}),o=new Us(r.olMap,e.formatMessage({id:"tooltip"}),i,t);return o.setActive(s),()=>{o?.destroy()}},[r,e,t,s,n])}function Zs(){const[r,e]=ze("colors",["background_body","border"],["#ffffff","#ffffff"]);return h.useMemo(()=>({control:s=>({...s,cursor:"pointer"}),indicatorSeparator:s=>({...s,borderColor:e}),dropdownIndicator:s=>({...s,backgroundColor:r})}),[r,e])}const lt="@open-pioneer/printing",ct=$e.bind(void 0,lt),Qs=Z.bind(void 0,lt),en="map";class tn{olMap;i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,t,s){this.olMap=e,this.printingService=t,this.i18n=s}destroy(){this.reset()}setViewPadding(e){this.viewPadding=e}async handleMapExport(e){if(this.olMap)try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const t=this.printMap.getCanvas();if(t)e.fileFormat=="png"?await this.exportMapInPNG(t,e):await this.exportMapInPDF(t,e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=$t(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(e){const t=e.title||"",s=e.title||en;return{title:t,fileName:s}}async exportMapInPNG(e,t){const s=document.createElement("canvas");s.width=e.width,s.height=e.height+50,s.style.backgroundColor="#fff";const n=s.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:i,fileName:o}=this.getTitleAndFileName(t);n.fillStyle="#fff",n.fillRect(0,0,s.width,s.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const a=s.width/2;n.fillText(i,a,20),n.drawImage(e,0,50);const c=document.createElement("a");c.setAttribute("download",o+".png");const f=Ut(s);if(!f)throw new Error("Failed to get image data URL");c.href=f,c.click()}async exportMapInPDF(e,t){const{jsPDF:s}=await zt(async()=>{const{jsPDF:V}=await import("./CIihL14E4dRF.js");return{jsPDF:V}},__vite__mapDeps([0,1,2]),import.meta.url),n=new s({orientation:"landscape",unit:"mm",format:"a4"}),i=n.internal.pageSize.getWidth(),o=n.internal.pageSize.getHeight(),a=15,c=20,f=o-c;n.setFontSize(20);const{title:g,fileName:y}=this.getTitleAndFileName(t);n.text(g,i/2,a,{align:"center"});const b=e.width/e.height;let _=f,M=_*b;M>=i&&(M=i,_=M/b);const m=(i-M)/2,T=c+(f-_)/2;n.addImage(e,"",m,T,M,_),n.save(y+".pdf")}}const sn=te("printing"),Tn=r=>{const e=Qs(),{viewPadding:t="auto"}=r,{containerProps:s}=Q("printing",r),[n,i]=h.useState("pdf"),[o,a]=h.useState(""),[c,f]=h.useState(!1),g=ct("notifier.NotificationService"),{map:y}=ee(r),b=nn(y,e,t);function _(m){(m==="png"||m==="pdf")&&i(m)}function M(){c||!b||(f(!0),b.handleMapExport({title:o,fileFormat:n}).catch(m=>{const T=e.formatMessage({id:"printingFailed"});g.notify({level:"error",message:T}),sn.error("Failed to print the map",m)}).finally(()=>{f(!1)}))}return l.jsx(I,{...s,children:l.jsxs(I,{as:"form",m:2,alignItems:"center",onSubmit:m=>{m.preventDefault(),M()},children:[l.jsxs(le,{as:Me,mb:2,children:[l.jsx(ce,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),l.jsx(Dt,{placeholder:e.formatMessage({id:"input.placeholder"}),value:o,onChange:m=>{a(m.target.value)},autoFocus:!0})]}),l.jsxs(le,{as:Me,mb:2,children:[l.jsx(ce,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),l.jsxs(qe,{value:n,onChange:m=>_(m.target.value),className:"printing-select",children:[l.jsx("option",{value:"png",children:"PNG"}),l.jsx("option",{value:"pdf",children:"PDF"})]})]}),l.jsx(Be,{isLoading:c,loadingText:e.formatMessage({id:"printingMap"}),disabled:c,mt:2,p:2,className:"printing-export-button",type:"submit",width:"100%",children:e.formatMessage({id:"export"})})]})})};function nn(r,e,t){const s=ct("printing.PrintingService"),[n,i]=h.useState(void 0);return h.useEffect(()=>{if(!r)return;const o=new tn(r.olMap,s,{overlayText:e.formatMessage({id:"printingMap"})});return i(o),()=>{o.destroy(),i(void 0)}},[r,e,s]),h.useEffect(()=>{n?.setViewPadding(t)},[n,t]),n}export{Pn as E,In as L,Fn as M,me as O,Tn as P,On as S,Ln as V,Cn as W,kn as a};
